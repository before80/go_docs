<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=zh-cn class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=alternate type=application/rss+xml href=https://before80.github.io/go_docs/styleGuide/uber/index.xml><meta name=robots content="index, follow"><link rel="shortcut icon" href=/go_docs/favicons/favicon.ico><link rel=apple-touch-icon href=/go_docs/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/go_docs/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/go_docs/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/go_docs/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/go_docs/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/go_docs/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/go_docs/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/go_docs/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/go_docs/favicons/android-192x192.png sizes=192x192><title>Uber Go 风格指南 | Go 中文档集</title><meta name=description content="Powerful, extensible, and feature-packed frontend toolkit. Build and customize with Sass, utilize prebuilt grid system and components, and bring projects to life with powerful JavaScript plugins."><meta property="og:title" content="Uber Go 风格指南"><meta property="og:description" content="Powerful, extensible, and feature-packed frontend toolkit. Build and customize with Sass, utilize prebuilt grid system and components, and bring projects to life with powerful JavaScript plugins."><meta property="og:type" content="website"><meta property="og:url" content="https://before80.github.io/go_docs/styleGuide/uber/"><meta itemprop=name content="Uber Go 风格指南"><meta itemprop=description content="Powerful, extensible, and feature-packed frontend toolkit. Build and customize with Sass, utilize prebuilt grid system and components, and bring projects to life with powerful JavaScript plugins."><meta name=twitter:card content="summary"><meta name=twitter:title content="Uber Go 风格指南"><meta name=twitter:description content="Powerful, extensible, and feature-packed frontend toolkit. Build and customize with Sass, utilize prebuilt grid system and components, and bring projects to life with powerful JavaScript plugins."><link rel=preload href=/go_docs/scss/main.min.2412d9ce8d59c0bc460230f66fb6de2f724f349b5e83810ed8155cc1ecc54c1e.css as=style><link href=/go_docs/scss/main.min.2412d9ce8d59c0bc460230f66fb6de2f724f349b5e83810ed8155cc1ecc54c1e.css rel=stylesheet integrity><link href=/go_docs/css/extra.css rel=stylesheet><link href=/go_docs/css/tocbot.css rel=stylesheet><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@docsearch/css@3.6.0 integrity="sha512-AyDFDkYyALC5qoao077IqAOV7UC4oKCBTp+mJfjIt306AIRoBxoEZYDo0kAx/R7RbT+3EYEky1po/F1w1eQt7g==" crossorigin=anonymous></head><body class=td-section><header><nav class="td-navbar navbar-dark js-navbar-scroll" data-bs-theme=dark><div class="container-fluid flex-column flex-md-row"><a class=navbar-brand href=/go_docs/><span class="navbar-brand__logo navbar-logo"><svg id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 500 500" style="enable-background:new 0 0 500 500"><g><path style="fill:#fff" d="M116.8525 421.9722c-5.7041.0-10.3442-4.3127-10.3442-9.6129V88.183c0-5.3002 4.6401-9.6117 10.3442-9.6117H320.858c3.0347.0 9.3959.5498 11.7506 2.6302l.3545.3442 58.905 63.2912c2.3101 2.491 2.9202 8.4928 2.9202 11.3184v256.2039c0 5.3002-4.6407 9.6129-10.3436 9.6129H116.8525z"/><g><g><g><path style="fill:#767676" d="M384.4445 423.2066H116.852c-6.3839.0-11.5786-4.8658-11.5786-10.8474V88.1831c0-5.9804 5.1947-10.8461 11.5786-10.8461h204.0062c.377.0 9.2786.0329 12.568 2.9389l.3947.3833 58.9508 63.337c3.2135 3.4652 3.2514 11.7924 3.2514 12.1593v256.2036C396.0231 418.3408 390.8284 423.2066 384.4445 423.2066zM116.5079 411.9189c.0848.0278.1999.0531.3441.0531h267.5925c.1442.0.2581-.0253.3441-.0531V156.1556c-.0076-.9033-.3593-3.7347-.7034-5.0037l-57.6527-61.9416c-1.4651-.3176-4.4533-.6389-5.5742-.6389H116.852c-.143.0-.2594.024-.3441.0531V411.9189zm267.4533-261.149zM327.0321 89.371v.0013V89.371z"/></g></g></g><g><g><path style="fill:#5b7fc0" d="M189.0874 210.1754l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4473C177.5953 212.627 183.0601 210.1742 189.0874 210.1754zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 234.1722 197.0804 232.033z"/><path style="opacity:.3;fill:#fff" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/><g><defs><path id="SVGID_1_" d="M194.7376 237.6875c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 234.2399 196.1861 236.239 194.7376 237.6875z"/></defs><clipPath id="SVGID_2_"><use xlink:href="#SVGID_1_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_2_);fill:#fff" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/><path style="opacity:.13;clip-path:url(#SVGID_2_);fill:#020202" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/></g><g><defs><path id="SVGID_3_" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/></defs><clipPath id="SVGID_4_"><use xlink:href="#SVGID_3_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_4_);fill:#5b7fc0" d="M172.6595 215.6045c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8475-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 209.1953 176.6171 211.647 172.6595 215.6045z"/></g></g><rect x="198.8952" y="225.1043" style="fill:#5b7fc0" width="122.6266" height="13.8671"/></g><g><path style="fill:#d95140" d="M189.0874 155.7611l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.0249 2.454-11.4897 6.4116-15.4473C177.5953 158.2128 183.0601 155.7599 189.0874 155.7611zm7.993 21.8577c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.2508 181.7667 197.0816 179.758 197.0804 177.6188z"/><path style="opacity:.3;fill:#fff" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zm7.9941 21.8613c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/><g><defs><path id="SVGID_5_" d="M194.7376 183.2733c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 179.8256 196.1861 181.8248 194.7376 183.2733z"/></defs><clipPath id="SVGID_6_"><use xlink:href="#SVGID_5_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_6_);fill:#fff" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/><path style="opacity:.13;clip-path:url(#SVGID_6_);fill:#020202" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/></g><g><defs><path id="SVGID_7_" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zm7.9941 21.8613c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/></defs><clipPath id="SVGID_8_"><use xlink:href="#SVGID_7_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_8_);fill:#d95140" d="M172.6595 161.1903c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 154.7811 176.6171 157.2327 172.6595 161.1903z"/></g><rect x="198.8952" y="170.69" style="fill:#d95140" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#56a55c" d="M189.5379 264.6147l.0012-.0012c7.7751.0012 15.0294 4.1862 18.932 10.9235 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032-5.8394.0-11.3281-2.2733-15.458-6.4032-4.13-4.13-6.4032-9.6186-6.4056-15.4628.0012-6.0249 2.454-11.4897 6.4116-15.4472C178.0458 267.0663 183.5105 264.6135 189.5379 264.6147zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6538 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.7013 290.6202 197.5321 288.6115 197.5309 286.4723z"/><path style="opacity:.3;fill:#fff" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/><g><defs><path id="SVGID_9_" d="M195.1881 292.1268c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9941 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.5344 288.6792 196.6366 290.6783 195.1881 292.1268z"/></defs><clipPath id="SVGID_10_"><use xlink:href="#SVGID_9_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_10_);fill:#fff" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/><path style="opacity:.13;clip-path:url(#SVGID_10_);fill:#020202" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/></g><g><defs><path id="SVGID_11_" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/></defs><clipPath id="SVGID_12_"><use xlink:href="#SVGID_11_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_12_);fill:#56a55c" d="M173.11 270.0439c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7325-11.1497-10.9151-18.926-10.9151C182.5311 263.6346 177.0676 266.0863 173.11 270.0439z"/></g></g><rect x="199.3456" y="279.5436" style="fill:#56a55c" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#f1bc42" d="M189.0874 318.7208l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3305-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4472C177.5953 321.1724 183.0601 318.7196 189.0874 318.7208zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 342.7176 197.0804 340.5784z"/><path style="opacity:.3;fill:#fff" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/><g><defs><path id="SVGID_13_" d="M194.7376 346.2329c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 342.7853 196.1861 344.7844 194.7376 346.2329z"/></defs><clipPath id="SVGID_14_"><use xlink:href="#SVGID_13_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_14_);fill:#fff" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/><path style="opacity:.13;clip-path:url(#SVGID_14_);fill:#020202" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/></g><g><defs><path id="SVGID_15_" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/></defs><clipPath id="SVGID_16_"><use xlink:href="#SVGID_15_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_16_);fill:#f1bc42" d="M172.6595 324.15c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8474-1.0151-7.6327-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 317.7407 176.6171 320.1924 172.6595 324.15z"/></g></g><rect x="198.8952" y="333.6497" style="fill:#f1bc42" width="122.6266" height="13.8671"/></g></g></svg></span><span class=navbar-brand__name>Go 中文档集</span></a><div class="td-navbar-nav-scroll ms-md-auto" id=main_navbar><ul class=navbar-nav><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=javascript:; id=show-timer style=color:#fe4512f5!important></a></li><li class=nav-item><a class=nav-link href=/go_docs/refs/><span>参考</span></a></li><li class=nav-item><a class=nav-link href=/go_docs/comm/><span>对比</span></a></li><li class=nav-item><a class=nav-link href=/go_docs/tools/><span>工具</span></a></li><li class=nav-item><a class=nav-link href=/go_docs/langSpec/><span>语规</span></a></li><li class=nav-item><a class="nav-link active" href=/go_docs/styleGuide/><span>编规</span></a></li><li class=nav-item><a class=nav-link href=/go_docs/example/><span>示例</span></a></li><li class=nav-item><a class=nav-link href=/go_docs/asu/><span>汇总</span></a></li><li class=nav-item><a class=nav-link href=/go_docs/fx/><span>分析</span></a></li><li class=nav-item><a class=nav-link href=/go_docs/docs/><span>文档</span></a></li><li class=nav-item><a class=nav-link href=/go_docs/cmd/><span>go命令</span></a></li><li class=nav-item><a class=nav-link href=/go_docs/stdLib/><span>标准库</span></a></li><li class=nav-item><a class=nav-link href=/go_docs/thirdPkg/><span>第三方包</span></a></li><li class=nav-item><a class=nav-link href=/go_docs/delve/><span>delve</span></a></li><li class=nav-item><a class=nav-link href=/go_docs/rod/><span>rod</span></a></li><li class=nav-item><a class=nav-link href=/go_docs/goframe/><span>goframe</span></a></li><li class=nav-item><a class=nav-link href=/go_docs/gorm/><span>gorm</span></a></li><li class=nav-item><a class=nav-link href=/go_docs/echo/><span>echo</span></a></li><li class=nav-item><a class=nav-link href=/go_docs/fiber/><span>fiber</span></a></li><li class=nav-item><a class=nav-link href=/go_docs/buffalo/><span>buffalo</span></a></li><li class=nav-item><a class=nav-link href=/go_docs/beego/><span>beego</span></a></li><li class=nav-item><a class=nav-link href=/go_docs/goBlog/><span>官博</span></a></li><li class=nav-item><a class=nav-link href=/go_docs/proposal/><span>提案</span></a></li><li class="td-light-dark-menu nav-item dropdown"><svg xmlns="http://www.w3.org/2000/svg" class="d-none"><symbol id="check2" viewBox="0 0 16 16"><path d="M13.854 3.646a.5.5.0 010 .708l-7 7a.5.5.0 01-.708.0l-3.5-3.5a.5.5.0 11.708-.708L6.5 10.293l6.646-6.647a.5.5.0 01.708.0z"/></symbol><symbol id="circle-half" viewBox="0 0 16 16"><path d="M8 15A7 7 0 108 1v14zm0 1A8 8 0 118 0a8 8 0 010 16z"/></symbol><symbol id="moon-stars-fill" viewBox="0 0 16 16"><path d="M6 .278a.768.768.0 01.08.858 7.208 7.208.0 00-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527.0 1.04-.055 1.533-.16a.787.787.0 01.81.316.733.733.0 01-.031.893A8.349 8.349.0 018.344 16C3.734 16 0 12.286.0 7.71.0 4.266 2.114 1.312 5.124.06A.752.752.0 016 .278z"/><path d="M10.794 3.148a.217.217.0 01.412.0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217.0 010 .412l-1.162.387A1.734 1.734.0 0011.593 7.69l-.387 1.162a.217.217.0 01-.412.0l-.387-1.162A1.734 1.734.0 009.31 6.593l-1.162-.387a.217.217.0 010-.412l1.162-.387a1.734 1.734.0 001.097-1.097l.387-1.162zM13.863.099a.145.145.0 01.274.0l.258.774c.115.346.386.617.732.732l.774.258a.145.145.0 010 .274l-.774.258a1.156 1.156.0 00-.732.732l-.258.774a.145.145.0 01-.274.0l-.258-.774a1.156 1.156.0 00-.732-.732l-.774-.258a.145.145.0 010-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"/></symbol><symbol id="sun-fill" viewBox="0 0 16 16"><path d="M8 12a4 4 0 100-8 4 4 0 000 8zM8 0a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 0zm0 13a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 13zm8-5a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2a.5.5.0 01.5.5zM3 8a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2A.5.5.0 013 8zm10.657-5.657a.5.5.0 010 .707l-1.414 1.415a.5.5.0 11-.707-.708l1.414-1.414a.5.5.0 01.707.0zm-9.193 9.193a.5.5.0 010 .707L3.05 13.657a.5.5.0 01-.707-.707l1.414-1.414a.5.5.0 01.707.0zm9.193 2.121a.5.5.0 01-.707.0l-1.414-1.414a.5.5.0 01.707-.707l1.414 1.414a.5.5.0 010 .707zM4.464 4.465a.5.5.0 01-.707.0L2.343 3.05a.5.5.0 11.707-.707l1.414 1.414a.5.5.0 010 .708z"/></symbol></svg><button class="btn btn-link nav-link dropdown-toggle d-flex align-items-center" id=bd-theme type=button aria-expanded=false data-bs-toggle=dropdown data-bs-display=static aria-label="Toggle theme (auto)"><svg class="bi my-1 theme-icon-active"><use href="#circle-half"/></svg></button><ul class="dropdown-menu dropdown-menu-end" aria-labelledby=bd-theme-text><li><button type=button class="dropdown-item d-flex align-items-center" data-bs-theme-value=light aria-pressed=false><svg class="bi me-2 opacity-50"><use href="#sun-fill"/></svg>
Light<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li><li><button type=button class="dropdown-item d-flex align-items-center" data-bs-theme-value=dark aria-pressed=false><svg class="bi me-2 opacity-50"><use href="#moon-stars-fill"/></svg>
Dark<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li><li><button type=button class="dropdown-item d-flex align-items-center active" data-bs-theme-value=auto aria-pressed=true><svg class="bi me-2 opacity-50"><use href="#circle-half"/></svg>
Auto<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li></ul></li></ul></div><div class="d-none d-lg-block"><div class=td-search><div class=td-search--algolia id=docsearch-1></div></div></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><form class="td-sidebar__search d-flex align-items-center"><div class=td-search><div class=td-search--algolia id=docsearch-0></div></div><button class="btn btn-link td-sidebar__toggle d-md-none p-0 ms-3 fas fa-bars" type=button data-bs-toggle=collapse data-bs-target=#td-section-nav aria-controls=td-section-nav aria-expanded=false aria-label="Toggle section navigation"></button></form><nav class="td-sidebar-nav collapse foldable-nav" id=td-section-nav><ul class="td-sidebar-nav__section pe-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-go_docsstyleguide-li><a href=/go_docs/styleGuide/ title=编码规范 class="align-left ps-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-go_docsstyleguide><span>编规</span></a><ul class=ul-1><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id=m-go_docsstyleguideuber-li><input type=checkbox id=m-go_docsstyleguideuber-check checked>
<label for=m-go_docsstyleguideuber-check><a href=/go_docs/styleGuide/uber/ class="align-left ps-0 active td-sidebar-link td-sidebar-link__section" id=m-go_docsstyleguideuber><span class=td-sidebar-nav-active-item>Uber Go 风格指南</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-go_docsstyleguidegoogle-li><input type=checkbox id=m-go_docsstyleguidegoogle-check>
<label for=m-go_docsstyleguidegoogle-check><a href=/go_docs/styleGuide/google/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-go_docsstyleguidegoogle><span>Go 风格</span></a></label><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-go_docsstyleguidegooglebestpractices-li><input type=checkbox id=m-go_docsstyleguidegooglebestpractices-check>
<label for=m-go_docsstyleguidegooglebestpractices-check><a href=/go_docs/styleGuide/google/bestPractices/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-go_docsstyleguidegooglebestpractices><span>最佳实践</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-go_docsstyleguidegoogledecisions-li><input type=checkbox id=m-go_docsstyleguidegoogledecisions-check>
<label for=m-go_docsstyleguidegoogledecisions-check><a href=/go_docs/styleGuide/google/decisions/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-go_docsstyleguidegoogledecisions><span>决策</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-go_docsstyleguidegoogleguide-li><input type=checkbox id=m-go_docsstyleguidegoogleguide-check>
<label for=m-go_docsstyleguidegoogleguide-check><a href=/go_docs/styleGuide/google/guide/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-go_docsstyleguidegoogleguide><span>指南</span></a></label></li></ul></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ms-2 pb-1 pt-2 mb-0"><a href=https://before80.github.io/go_docs/comm/coffee class="td-page-meta--view td-page-meta__view" style=color:#2bf518!important target=_blank rel=noopener><i class="fa-solid fa-mug-hot fa-fw"></i> 请作者喝杯咖啡吧</a>
<a href=https://github.com/before80/go_docs/tree/main/content/styleGuide/uber/_index.md class="td-page-meta--view td-page-meta__view" target=_blank rel=noopener><i class="fa-solid fa-file-lines fa-fw"></i> 查看页面源码</a>
<a href=https://github.com/before80/go_docs/edit/main/content/styleGuide/uber/_index.md class="td-page-meta--edit td-page-meta__edit" target=_blank rel=noopener><i class="fa-solid fa-pen-to-square fa-fw"></i> 编辑此页</a>
<a href="https://github.com/before80/go_docs/new/main/content/styleGuide/uber?filename=change-me.md&amp;value=---%0Atitle%3A+%22Long+Page+Title%22%0AlinkTitle%3A+%22Short+Nav+Title%22%0Aweight%3A+100%0Adescription%3A+%3E-%0A+++++Page+description+for+heading+and+indexes.%0A---%0A%0A%23%23+Heading%0A%0AEdit+this+template+to+create+your+new+page.%0A%0A%2A+Give+it+a+good+name%2C+ending+in+%60.md%60+-+e.g.+%60getting-started.md%60%0A%2A+Edit+the+%22front+matter%22+section+at+the+top+of+the+page+%28weight+controls+how+its+ordered+amongst+other+pages+in+the+same+directory%3B+lowest+number+first%29.%0A%2A+Add+a+good+commit+message+at+the+bottom+of+the+page+%28%3C80+characters%3B+use+the+extended+description+field+for+more+detail%29.%0A%2A+Create+a+new+branch+so+you+can+preview+your+new+file+and+request+a+review+via+Pull+Request.%0A" class="td-page-meta--child td-page-meta__child" target=_blank rel=noopener><i class="fa-solid fa-pen-to-square fa-fw"></i> 添加子页面</a>
<a href="https://github.com/before80/go_docs/issues/new?title=Uber%20Go%20%e9%a3%8e%e6%a0%bc%e6%8c%87%e5%8d%97" class="td-page-meta--issue td-page-meta__issue" target=_blank rel=noopener><i class="fa-solid fa-list-check fa-fw"></i> 提交文档问题</a>
<a href=https://github.com/before80/go_docs/issues/new class="td-page-meta--project td-page-meta__project-issue" target=_blank rel=noopener><i class="fa-solid fa-list-check fa-fw"></i> 提交项目问题</a></div><div class=td-toc><nav id=TableOfContents><ul><li><a href=#uber-go-style-guide---uber-go-风格指南>Uber Go Style Guide - Uber Go 风格指南</a><ul><li><a href=#introduction-简介>Introduction 简介</a></li><li><a href=#guidelines-指南>Guidelines 指南</a><ul><li><a href=#pointers-to-interfaces-指向接口的指针>Pointers to Interfaces 指向接口的指针</a></li><li><a href=#verify-interface-compliance-验证接口合规性>Verify Interface Compliance 验证接口合规性</a></li><li><a href=#receivers-and-interfaces>Receivers and Interfaces</a></li><li><a href=#zero-value-mutexes-are-valid-零值互斥锁有效>Zero-value Mutexes are Valid 零值互斥锁有效</a></li><li><a href=#copy-slices-and-maps-at-boundaries-在边界处复制切片和映射>Copy Slices and Maps at Boundaries 在边界处复制切片和映射</a><ul><li><a href=#receiving-slices-and-maps-接收切片和映射>Receiving Slices and Maps 接收切片和映射</a></li><li><a href=#returning-slices-and-maps-返回切片和映射>Returning Slices and Maps 返回切片和映射</a></li></ul></li><li><a href=#defer-to-clean-up-推迟清理>Defer to Clean Up 推迟清理</a></li><li><a href=#channel-size-is-one-or-none-通道大小为一或无>Channel Size is One or None 通道大小为一或无</a></li><li><a href=#start-enums-at-one-从一处开始枚举>Start Enums at One 从一处开始枚举</a></li><li><a href=#use-time-to-handle-time-使用-time-处理时间>Use <code>"time"</code> to handle time 使用 <code>"time"</code> 处理时间</a><ul><li><a href=#use-timetime-for-instants-of-time-对时间瞬间使用-timetime>Use <code>time.Time</code> for instants of time 对时间瞬间使用 <code>time.Time</code></a></li><li><a href=#use-timeduration-for-periods-of-time-使用-timeduration-表示时间段>Use <code>time.Duration</code> for periods of time 使用 <code>time.Duration</code> 表示时间段</a></li><li><a href=#use-timetime-and-timeduration-with-external-systems-与外部系统一起使用-timetime-和-timeduration>Use <code>time.Time</code> and <code>time.Duration</code> with external systems 与外部系统一起使用 <code>time.Time</code> 和 <code>time.Duration</code></a></li></ul></li><li><a href=#errors-错误>Errors 错误</a><ul><li><a href=#error-types-错误类型>Error Types 错误类型</a></li><li><a href=#error-wrapping-错误包装>Error Wrapping 错误包装</a></li><li><a href=#error-naming-错误命名>Error Naming 错误命名</a></li><li><a href=#handle-errors-once-一次处理错误>Handle Errors Once 一次处理错误</a></li></ul></li><li><a href=#handle-type-assertion-failures-处理类型断言失败>Handle Type Assertion Failures 处理类型断言失败</a></li><li><a href=#dont-panic-不要恐慌>Don’t Panic 不要恐慌</a></li><li><a href=#use-gouberorgatomic-使用-gouberorgatomic>Use go.uber.org/atomic 使用 go.uber.org/atomic</a></li><li><a href=#avoid-mutable-globals-避免可变全局变量>Avoid Mutable Globals 避免可变全局变量</a></li><li><a href=#avoid-embedding-types-in-public-structs-避免在公共结构中嵌入类型>Avoid Embedding Types in Public Structs 避免在公共结构中嵌入类型</a></li><li><a href=#avoid-using-built-in-names-避免使用内置名称>Avoid Using Built-In Names 避免使用内置名称</a></li><li><a href=#avoid-init-避免-init>Avoid <code>init()</code> 避免 <code>init()</code></a></li><li><a href=#exit-in-main-在-main-中退出>Exit in Main 在 Main 中退出</a><ul><li><a href=#exit-once-退出一次>Exit Once 退出一次</a></li></ul></li><li><a href=#use-field-tags-in-marshaled-structs-在编组结构中使用字段标记>Use field tags in marshaled structs 在编组结构中使用字段标记</a></li><li><a href=#dont-fire-and-forget-goroutines-不要使用即用即弃的-goroutine>Don’t fire-and-forget goroutines 不要使用即用即弃的 goroutine</a><ul><li><a href=#wait-for-goroutines-to-exit-等待-goroutine-退出>Wait for goroutines to exit 等待 Goroutine 退出</a></li><li><a href=#no-goroutines-in-init-init-中没有协程>No goroutines in <code>init()</code> <code>init()</code> 中没有协程</a></li></ul></li></ul></li><li><a href=#performance-性能>Performance 性能</a><ul><li><a href=#prefer-strconv-over-fmt-优先使用-strconv-而非-fmt>Prefer strconv over fmt 优先使用 strconv 而非 fmt</a></li><li><a href=#avoid-repeated-string-to-byte-conversions-避免重复的字符串到字节的转换>Avoid repeated string-to-byte conversions 避免重复的字符串到字节的转换</a></li><li><a href=#prefer-specifying-container-capacity-优先指定容器容量>Prefer Specifying Container Capacity 优先指定容器容量</a><ul><li><a href=#specifying-map-capacity-hints-指定映射容量提示>Specifying Map Capacity Hints 指定映射容量提示</a></li><li><a href=#specifying-slice-capacity-指定切片容量>Specifying Slice Capacity 指定切片容量</a></li></ul></li></ul></li><li><a href=#style-样式>Style 样式</a><ul><li><a href=#avoid-overly-long-lines-避免过长的行>Avoid overly long lines 避免过长的行</a></li><li><a href=#be-consistent-保持一致>Be Consistent 保持一致</a></li><li><a href=#group-similar-declarations-对类似声明进行分组>Group Similar Declarations 对类似声明进行分组</a></li><li><a href=#import-group-ordering-导入组排序>Import Group Ordering 导入组排序</a></li><li><a href=#package-names-包名称>Package Names 包名称</a></li><li><a href=#function-names-函数名称>Function Names 函数名称</a></li><li><a href=#import-aliasing-导入别名>Import Aliasing 导入别名</a></li><li><a href=#function-grouping-and-ordering-函数分组和排序>Function Grouping and Ordering 函数分组和排序</a></li><li><a href=#reduce-nesting-减少嵌套>Reduce Nesting 减少嵌套</a></li><li><a href=#unnecessary-else-不必要的-else>Unnecessary Else 不必要的 Else</a></li><li><a href=#top-level-variable-declarations-顶级变量声明>Top-level Variable Declarations 顶级变量声明</a></li><li><a href=#prefix-unexported-globals-with-_-前缀未导出的全局变量为-_>Prefix Unexported Globals with _ 前缀未导出的全局变量为 _</a></li><li><a href=#embedding-in-structs-嵌入到结构中>Embedding in Structs 嵌入到结构中</a></li><li><a href=#local-variable-declarations-局部变量声明>Local Variable Declarations 局部变量声明</a></li><li><a href=#nil-is-a-valid-slice-nil-是一个有效的切片>nil is a valid slice nil 是一个有效的切片</a></li><li><a href=#reduce-scope-of-variables-减少变量的作用域>Reduce Scope of Variables 减少变量的作用域</a></li><li><a href=#avoid-naked-parameters-避免裸参数>Avoid Naked Parameters 避免裸参数</a></li><li><a href=#use-raw-string-literals-to-avoid-escaping-使用原始字符串字面量避免转义>Use Raw String Literals to Avoid Escaping 使用原始字符串字面量避免转义</a></li><li><a href=#initializing-structs-初始化结构体>Initializing Structs 初始化结构体</a><ul><li><a href=#use-field-names-to-initialize-structs-使用字段名初始化结构体>Use Field Names to Initialize Structs 使用字段名初始化结构体</a></li><li><a href=#omit-zero-value-fields-in-structs-在结构体中省略零值字段>Omit Zero Value Fields in Structs 在结构体中省略零值字段</a></li><li><a href=#use-var-for-zero-value-structs-使用-var-表示零值结构>Use <code>var</code> for Zero Value Structs 使用 <code>var</code> 表示零值结构</a></li><li><a href=#initializing-struct-references-初始化结构引用>Initializing Struct References 初始化结构引用</a></li></ul></li><li><a href=#initializing-maps-初始化映射>Initializing Maps 初始化映射</a></li><li><a href=#format-strings-outside-printf-printf-之外的格式字符串>Format Strings outside Printf Printf 之外的格式字符串</a></li><li><a href=#naming-printf-style-functions-命名-printf-样式函数>Naming Printf-style Functions 命名 Printf 样式函数</a></li></ul></li><li><a href=#patterns-模式>Patterns 模式</a><ul><li><a href=#test-tables-测试表>Test Tables 测试表</a><ul><li><a href=#avoid-unnecessary-complexity-in-table-tests-避免在表测试中出现不必要的复杂性>Avoid Unnecessary Complexity in Table Tests 避免在表测试中出现不必要的复杂性</a></li><li><a href=#parallel-tests-并行测试>Parallel Tests 并行测试</a></li></ul></li><li><a href=#functional-options-功能选项>Functional Options 功能选项</a></li></ul></li><li><a href=#linting>Linting</a><ul><li><a href=#lint-runners-lint-运行程序>Lint Runners Lint 运行程序</a></li></ul></li></ul></li></ul></nav></div></aside><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><nav aria-label=breadcrumb class=td-breadcrumbs><ol class=breadcrumb><li class=breadcrumb-item><a href=/go_docs/styleGuide/>编规</a></li><li class="breadcrumb-item active" aria-current=page>Uber Go 风格指南</li></ol></nav><div class=td-content><h1>Uber Go 风格指南</h1><header class=article-meta><p class=reading-time><i class="fa-solid fa-clock" style=color:#e90 aria-hidden=true></i>&nbsp; <span style=font-size:3rem;color:#006400 id=advice-reading-time>50 </span>分钟阅读 &nbsp;</p></header><h1 id=uber-go-style-guide---uber-go-风格指南>Uber Go Style Guide - Uber Go 风格指南</h1><blockquote><p>原文： <a href=https://github.com/uber-go/guide/blob/master/style.md>https://github.com/uber-go/guide/blob/master/style.md</a></p></blockquote><h2 id=introduction-简介>Introduction 简介</h2><p>Styles are the conventions that govern our code. The term style is a bit of a misnomer, since these conventions cover far more than just source file formatting—gofmt handles that for us.</p><p>​ 风格是我们代码遵循的惯例。术语风格有点名不副实，因为这些惯例涵盖的范围远不止源文件格式——gofmt 会为我们处理这些。</p><p>The goal of this guide is to manage this complexity by describing in detail the Dos and Don’ts of writing Go code at Uber. These rules exist to keep the code base manageable while still allowing engineers to use Go language features productively.</p><p>​ 本指南的目的是通过详细描述在 Uber 编写 Go 代码的注意事项来管理这种复杂性。这些规则的存在是为了保持代码库的可管理性，同时仍允许工程师高效地使用 Go 语言特性。</p><p>This guide was originally created by <a href=https://github.com/prashantv>Prashant Varanasi</a> and <a href=https://github.com/nomis52>Simon Newton</a> as a way to bring some colleagues up to speed with using Go. Over the years it has been amended based on feedback from others.</p><p>​ 这份指南最初由 Prashant Varanasi 和 Simon Newton 创建，目的是让一些同事快速了解如何使用 Go。多年来，它根据他人的反馈进行了修改。</p><p>This documents idiomatic conventions in Go code that we follow at Uber. A lot of these are general guidelines for Go, while others extend upon external resources:</p><p>​ 本文档记录了我们在 Uber 遵循的 Go 代码中的惯用约定。其中许多是 Go 的一般准则，而其他一些则扩展了外部资源：</p><ol><li><a href=https://golang.org/doc/effective_go.html>Effective Go
有效的 Go</a></li><li><a href=https://github.com/golang/go/wiki/CommonMistakes>Go Common Mistakes
常见的 Go 错误</a></li><li><a href=https://github.com/golang/go/wiki/CodeReviewComments>Go Code Review Comments
Go 代码审查评论</a></li></ol><p>We aim for the code samples to be accurate for the two most recent minor versions of Go <a href=https://go.dev/doc/devel/release>releases</a>.</p><p>​ 我们的目标是让代码示例适用于最近两个次要版本的 Go 版本。</p><p>All code should be error-free when run through <code>golint</code> and <code>go vet</code>. We recommend setting up your editor to:</p><p>​ 通过 <code>golint</code> 和 <code>go vet</code> 运行时，所有代码都应无错误。我们建议将编辑器设置为：</p><ul><li>Run <code>goimports</code> on save
保存时运行 <code>goimports</code></li><li>Run <code>golint</code> and <code>go vet</code> to check for errors
运行 <code>golint</code> 和 <code>go vet</code> 以检查错误</li></ul><p>You can find information in editor support for Go tools here: <a href=https://github.com/golang/go/wiki/IDEsAndTextEditorPlugins>https://github.com/golang/go/wiki/IDEsAndTextEditorPlugins</a></p><p>​ 您可以在此处找到有关 Go 工具的编辑器支持信息：https://github.com/golang/go/wiki/IDEsAndTextEditorPlugins</p><h2 id=guidelines-指南>Guidelines 指南</h2><h3 id=pointers-to-interfaces-指向接口的指针>Pointers to Interfaces 指向接口的指针</h3><p>You almost never need a pointer to an interface. You should be passing interfaces as values—the underlying data can still be a pointer.</p><p>​ 您几乎不需要指向接口的指针。您应该将接口作为值传递——底层数据仍然可以是指针。</p><p>An interface is two fields:</p><p>​ 接口是两个字段：</p><ol><li>A pointer to some type-specific information. You can think of this as “type.”
指向某些类型特定信息的指针。您可以将其视为“类型”。</li><li>Data pointer. If the data stored is a pointer, it’s stored directly. If the data stored is a value, then a pointer to the value is stored.
数据指针。如果存储的数据是指针，则直接存储。如果存储的数据是值，则存储指向该值的指针。</li></ol><p>If you want interface methods to modify the underlying data, you must use a pointer.</p><p>​ 如果希望接口方法修改底层数据，则必须使用指针。</p><h3 id=verify-interface-compliance-验证接口合规性>Verify Interface Compliance 验证接口合规性</h3><p>Verify interface compliance at compile time where appropriate. This includes:</p><p>​ 在适当的时候在编译时验证接口合规性。这包括：</p><ul><li>Exported types that are required to implement specific interfaces as part of their API contract
作为其 API 契约的一部分，需要实现特定接口的导出类型</li><li>Exported or unexported types that are part of a collection of types implementing the same interface
作为实现相同接口的类型集合的一部分的已导出或未导出的类型</li><li>Other cases where violating an interface would break users
违反接口会破坏用户的情况</li></ul><div class=highlight><div style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">26
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Bad
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>type</span> <span style=color:#aa89ea>Handler</span> <span style=color:#76a9f9>struct</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#8a93a5;font-style:italic>// ...
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>func</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>h</span> <span style=color:#54b1c7>*</span><span style=color:#aa89ea>Handler</span><span style=color:#abb2bf>)</span> <span style=color:#00b1f7>ServeHTTP</span><span style=color:#abb2bf>(</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>w</span> <span style=color:#aa89ea>http</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>ResponseWriter</span><span style=color:#abb2bf>,</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>r</span> <span style=color:#54b1c7>*</span><span style=color:#aa89ea>http</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>Request</span><span style=color:#abb2bf>,</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#54b1c7>...</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Good
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>type</span> <span style=color:#aa89ea>Handler</span> <span style=color:#76a9f9>struct</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#8a93a5;font-style:italic>// ...
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>var</span> <span style=color:#aa89ea>_</span> <span style=color:#aa89ea>http</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>Handler</span> <span style=color:#abb2bf>=</span> <span style=color:#abb2bf>(</span><span style=color:#54b1c7>*</span><span style=color:#aa89ea>Handler</span><span style=color:#abb2bf>)(</span><span style=color:#e5c07b>nil</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>func</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>h</span> <span style=color:#54b1c7>*</span><span style=color:#aa89ea>Handler</span><span style=color:#abb2bf>)</span> <span style=color:#00b1f7>ServeHTTP</span><span style=color:#abb2bf>(</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>w</span> <span style=color:#aa89ea>http</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>ResponseWriter</span><span style=color:#abb2bf>,</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>r</span> <span style=color:#54b1c7>*</span><span style=color:#aa89ea>http</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>Request</span><span style=color:#abb2bf>,</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#8a93a5;font-style:italic>// ...
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#abb2bf>}</span>
</span></span></code></pre></td></tr></table></div></div><p>The statement <code>var _ http.Handler = (*Handler)(nil)</code> will fail to compile if <code>*Handler</code> ever stops matching the <code>http.Handler</code> interface.</p><p>​ 如果 <code>*Handler</code> 停止匹配 <code>http.Handler</code> 接口，则语句 <code>var _ http.Handler = (*Handler)(nil)</code> 将无法编译。</p><p>The right hand side of the assignment should be the zero value of the asserted type. This is <code>nil</code> for pointer types (like <code>*Handler</code>), slices, and maps, and an empty struct for struct types.</p><p>​ 赋值的右侧应该是断言类型的零值。对于指针类型（如 <code>*Handler</code> ）、切片和映射，这是 <code>nil</code> ，对于结构类型，这是空结构。 接收者和接口</p><div class=highlight><div style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">13
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#76a9f9>type</span> <span style=color:#aa89ea>LogHandler</span> <span style=color:#76a9f9>struct</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>h</span>   <span style=color:#aa89ea>http</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>Handler</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>log</span> <span style=color:#54b1c7>*</span><span style=color:#aa89ea>zap</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>Logger</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>var</span> <span style=color:#aa89ea>_</span> <span style=color:#aa89ea>http</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>Handler</span> <span style=color:#abb2bf>=</span> <span style=color:#aa89ea>LogHandler</span><span style=color:#abb2bf>{}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>func</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>h</span> <span style=color:#aa89ea>LogHandler</span><span style=color:#abb2bf>)</span> <span style=color:#00b1f7>ServeHTTP</span><span style=color:#abb2bf>(</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>w</span> <span style=color:#aa89ea>http</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>ResponseWriter</span><span style=color:#abb2bf>,</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>r</span> <span style=color:#54b1c7>*</span><span style=color:#aa89ea>http</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>Request</span><span style=color:#abb2bf>,</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#8a93a5;font-style:italic>// ...
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#abb2bf>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=receivers-and-interfaces>Receivers and Interfaces</h3><p>Methods with value receivers can be called on pointers as well as values. Methods with pointer receivers can only be called on pointers or <a href=https://golang.org/ref/spec#Method_values>addressable values</a>.</p><p>​ 具有值接收者的方法可以调用指针和值。具有指针接收者的方法只能调用指针或可寻址值。</p><p>For example,</p><p>​ 例如，</p><div class=highlight><div style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">33
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#76a9f9>type</span> <span style=color:#aa89ea>S</span> <span style=color:#76a9f9>struct</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>data</span> <span style=color:#e5c07b>string</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>func</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>s</span> <span style=color:#aa89ea>S</span><span style=color:#abb2bf>)</span> <span style=color:#00b1f7>Read</span><span style=color:#abb2bf>()</span> <span style=color:#e5c07b>string</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>return</span> <span style=color:#aa89ea>s</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>data</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>func</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>s</span> <span style=color:#54b1c7>*</span><span style=color:#aa89ea>S</span><span style=color:#abb2bf>)</span> <span style=color:#00b1f7>Write</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>str</span> <span style=color:#e5c07b>string</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>s</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>data</span> <span style=color:#abb2bf>=</span> <span style=color:#aa89ea>str</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// We cannot get pointers to values stored in maps, because they are not
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// addressable values.
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#aa89ea>sVals</span> <span style=color:#54b1c7>:=</span> <span style=color:#76a9f9>map</span><span style=color:#abb2bf>[</span><span style=color:#e5c07b>int</span><span style=color:#abb2bf>]</span><span style=color:#aa89ea>S</span><span style=color:#abb2bf>{</span><span style=color:#d19a66>1</span><span style=color:#abb2bf>:</span> <span style=color:#abb2bf>{</span><span style=color:#98c379>&#34;A&#34;</span><span style=color:#abb2bf>}}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// We can call Read on values stored in the map because Read
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// has a value receiver, which does not require the value to
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// be addressable.
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#aa89ea>sVals</span><span style=color:#abb2bf>[</span><span style=color:#d19a66>1</span><span style=color:#abb2bf>].</span><span style=color:#00b1f7>Read</span><span style=color:#abb2bf>()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// We cannot call Write on values stored in the map because Write
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// has a pointer receiver, and it&#39;s not possible to get a pointer
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// to a value stored in a map.
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>//
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>//  sVals[1].Write(&#34;test&#34;)
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>sPtrs</span> <span style=color:#54b1c7>:=</span> <span style=color:#76a9f9>map</span><span style=color:#abb2bf>[</span><span style=color:#e5c07b>int</span><span style=color:#abb2bf>]</span><span style=color:#54b1c7>*</span><span style=color:#aa89ea>S</span><span style=color:#abb2bf>{</span><span style=color:#d19a66>1</span><span style=color:#abb2bf>:</span> <span style=color:#abb2bf>{</span><span style=color:#98c379>&#34;A&#34;</span><span style=color:#abb2bf>}}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// You can call both Read and Write if the map stores pointers,
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// because pointers are intrinsically addressable.
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#aa89ea>sPtrs</span><span style=color:#abb2bf>[</span><span style=color:#d19a66>1</span><span style=color:#abb2bf>].</span><span style=color:#00b1f7>Read</span><span style=color:#abb2bf>()</span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>sPtrs</span><span style=color:#abb2bf>[</span><span style=color:#d19a66>1</span><span style=color:#abb2bf>].</span><span style=color:#00b1f7>Write</span><span style=color:#abb2bf>(</span><span style=color:#98c379>&#34;test&#34;</span><span style=color:#abb2bf>)</span>
</span></span></code></pre></td></tr></table></div></div><p>Similarly, an interface can be satisfied by a pointer, even if the method has a value receiver.</p><p>​ 同样，即使方法具有值接收者，接口也可以由指针满足。</p><div class=highlight><div style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">24
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#76a9f9>type</span> <span style=color:#aa89ea>F</span> <span style=color:#76a9f9>interface</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#00b1f7>f</span><span style=color:#abb2bf>()</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>type</span> <span style=color:#aa89ea>S1</span> <span style=color:#76a9f9>struct</span><span style=color:#abb2bf>{}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>func</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>s</span> <span style=color:#aa89ea>S1</span><span style=color:#abb2bf>)</span> <span style=color:#00b1f7>f</span><span style=color:#abb2bf>()</span> <span style=color:#abb2bf>{}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>type</span> <span style=color:#aa89ea>S2</span> <span style=color:#76a9f9>struct</span><span style=color:#abb2bf>{}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>func</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>s</span> <span style=color:#54b1c7>*</span><span style=color:#aa89ea>S2</span><span style=color:#abb2bf>)</span> <span style=color:#00b1f7>f</span><span style=color:#abb2bf>()</span> <span style=color:#abb2bf>{}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>s1Val</span> <span style=color:#54b1c7>:=</span> <span style=color:#aa89ea>S1</span><span style=color:#abb2bf>{}</span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>s1Ptr</span> <span style=color:#54b1c7>:=</span> <span style=color:#54b1c7>&amp;</span><span style=color:#aa89ea>S1</span><span style=color:#abb2bf>{}</span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>s2Val</span> <span style=color:#54b1c7>:=</span> <span style=color:#aa89ea>S2</span><span style=color:#abb2bf>{}</span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>s2Ptr</span> <span style=color:#54b1c7>:=</span> <span style=color:#54b1c7>&amp;</span><span style=color:#aa89ea>S2</span><span style=color:#abb2bf>{}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>var</span> <span style=color:#aa89ea>i</span> <span style=color:#aa89ea>F</span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>i</span> <span style=color:#abb2bf>=</span> <span style=color:#aa89ea>s1Val</span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>i</span> <span style=color:#abb2bf>=</span> <span style=color:#aa89ea>s1Ptr</span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>i</span> <span style=color:#abb2bf>=</span> <span style=color:#aa89ea>s2Ptr</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// The following doesn&#39;t compile, since s2Val is a value, and there is no value receiver for f.
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>//   i = s2Val
</span></span></span></code></pre></td></tr></table></div></div><p>Effective Go has a good write up on <a href=https://golang.org/doc/effective_go.html#pointers_vs_values>Pointers vs. Values</a>.</p><p>​ Effective Go 对指针与值进行了很好的撰写。</p><h3 id=zero-value-mutexes-are-valid-零值互斥锁有效>Zero-value Mutexes are Valid 零值互斥锁有效</h3><p>The zero-value of <code>sync.Mutex</code> and <code>sync.RWMutex</code> is valid, so you almost never need a pointer to a mutex.</p><p>​ <code>sync.Mutex</code> 和 <code>sync.RWMutex</code> 的零值有效，因此您几乎不需要指向互斥体的指针。</p><div class=highlight><div style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">6
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Bad
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#aa89ea>mu</span> <span style=color:#54b1c7>:=</span> <span style=color:#e5c07b>new</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>sync</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>Mutex</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>mu</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Lock</span><span style=color:#abb2bf>()</span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Good
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>var</span> <span style=color:#aa89ea>mu</span> <span style=color:#aa89ea>sync</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>Mutex</span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>mu</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Lock</span><span style=color:#abb2bf>()</span>
</span></span></code></pre></td></tr></table></div></div><p>If you use a struct by pointer, then the mutex should be a non-pointer field on it. Do not embed the mutex on the struct, even if the struct is not exported.</p><p>​ 如果您通过指针使用结构体，那么互斥体应该是非指针字段。即使结构体未导出，也不要将互斥体嵌入到结构体中。</p><div class=highlight><div style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">38
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Bad
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>type</span> <span style=color:#aa89ea>SMap</span> <span style=color:#76a9f9>struct</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>sync</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>Mutex</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>data</span> <span style=color:#76a9f9>map</span><span style=color:#abb2bf>[</span><span style=color:#e5c07b>string</span><span style=color:#abb2bf>]</span><span style=color:#e5c07b>string</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>func</span> <span style=color:#00b1f7>NewSMap</span><span style=color:#abb2bf>()</span> <span style=color:#54b1c7>*</span><span style=color:#aa89ea>SMap</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>return</span> <span style=color:#54b1c7>&amp;</span><span style=color:#aa89ea>SMap</span><span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>data</span><span style=color:#abb2bf>:</span> <span style=color:#e5c07b>make</span><span style=color:#abb2bf>(</span><span style=color:#76a9f9>map</span><span style=color:#abb2bf>[</span><span style=color:#e5c07b>string</span><span style=color:#abb2bf>]</span><span style=color:#e5c07b>string</span><span style=color:#abb2bf>),</span>
</span></span><span style=display:flex><span>  <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>func</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>m</span> <span style=color:#54b1c7>*</span><span style=color:#aa89ea>SMap</span><span style=color:#abb2bf>)</span> <span style=color:#00b1f7>Get</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>k</span> <span style=color:#e5c07b>string</span><span style=color:#abb2bf>)</span> <span style=color:#e5c07b>string</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>m</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Lock</span><span style=color:#abb2bf>()</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>defer</span> <span style=color:#aa89ea>m</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Unlock</span><span style=color:#abb2bf>()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>return</span> <span style=color:#aa89ea>m</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>data</span><span style=color:#abb2bf>[</span><span style=color:#aa89ea>k</span><span style=color:#abb2bf>]</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Good
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>type</span> <span style=color:#aa89ea>SMap</span> <span style=color:#76a9f9>struct</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>mu</span> <span style=color:#aa89ea>sync</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>Mutex</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>data</span> <span style=color:#76a9f9>map</span><span style=color:#abb2bf>[</span><span style=color:#e5c07b>string</span><span style=color:#abb2bf>]</span><span style=color:#e5c07b>string</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>func</span> <span style=color:#00b1f7>NewSMap</span><span style=color:#abb2bf>()</span> <span style=color:#54b1c7>*</span><span style=color:#aa89ea>SMap</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>return</span> <span style=color:#54b1c7>&amp;</span><span style=color:#aa89ea>SMap</span><span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>data</span><span style=color:#abb2bf>:</span> <span style=color:#e5c07b>make</span><span style=color:#abb2bf>(</span><span style=color:#76a9f9>map</span><span style=color:#abb2bf>[</span><span style=color:#e5c07b>string</span><span style=color:#abb2bf>]</span><span style=color:#e5c07b>string</span><span style=color:#abb2bf>),</span>
</span></span><span style=display:flex><span>  <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>func</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>m</span> <span style=color:#54b1c7>*</span><span style=color:#aa89ea>SMap</span><span style=color:#abb2bf>)</span> <span style=color:#00b1f7>Get</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>k</span> <span style=color:#e5c07b>string</span><span style=color:#abb2bf>)</span> <span style=color:#e5c07b>string</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>m</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>mu</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Lock</span><span style=color:#abb2bf>()</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>defer</span> <span style=color:#aa89ea>m</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>mu</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Unlock</span><span style=color:#abb2bf>()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>return</span> <span style=color:#aa89ea>m</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>data</span><span style=color:#abb2bf>[</span><span style=color:#aa89ea>k</span><span style=color:#abb2bf>]</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=copy-slices-and-maps-at-boundaries-在边界处复制切片和映射>Copy Slices and Maps at Boundaries 在边界处复制切片和映射</h3><p>Slices and maps contain pointers to the underlying data so be wary of scenarios when they need to be copied.</p><p>​ 切片和映射包含指向基础数据的指针，因此在需要复制它们时要小心。</p><h4 id=receiving-slices-and-maps-接收切片和映射>Receiving Slices and Maps 接收切片和映射</h4><p>Keep in mind that users can modify a map or slice you received as an argument if you store a reference to it.</p><p>​ 请记住，如果您存储对映射或切片的引用，则用户可以修改您作为参数接收的映射或切片。</p><div class=highlight><div style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">21
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Bad
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>func</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>d</span> <span style=color:#54b1c7>*</span><span style=color:#aa89ea>Driver</span><span style=color:#abb2bf>)</span> <span style=color:#00b1f7>SetTrips</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>trips</span> <span style=color:#abb2bf>[]</span><span style=color:#aa89ea>Trip</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>d</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>trips</span> <span style=color:#abb2bf>=</span> <span style=color:#aa89ea>trips</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>trips</span> <span style=color:#54b1c7>:=</span> <span style=color:#54b1c7>...</span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>d1</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>SetTrips</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>trips</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Did you mean to modify d1.trips?
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#aa89ea>trips</span><span style=color:#abb2bf>[</span><span style=color:#d19a66>0</span><span style=color:#abb2bf>]</span> <span style=color:#abb2bf>=</span> <span style=color:#54b1c7>...</span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Good
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>func</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>d</span> <span style=color:#54b1c7>*</span><span style=color:#aa89ea>Driver</span><span style=color:#abb2bf>)</span> <span style=color:#00b1f7>SetTrips</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>trips</span> <span style=color:#abb2bf>[]</span><span style=color:#aa89ea>Trip</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>d</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>trips</span> <span style=color:#abb2bf>=</span> <span style=color:#e5c07b>make</span><span style=color:#abb2bf>([]</span><span style=color:#aa89ea>Trip</span><span style=color:#abb2bf>,</span> <span style=color:#e5c07b>len</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>trips</span><span style=color:#abb2bf>))</span>
</span></span><span style=display:flex><span>  <span style=color:#e5c07b>copy</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>d</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>trips</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>trips</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>trips</span> <span style=color:#54b1c7>:=</span> <span style=color:#54b1c7>...</span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>d1</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>SetTrips</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>trips</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// We can now modify trips[0] without affecting d1.trips.
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#aa89ea>trips</span><span style=color:#abb2bf>[</span><span style=color:#d19a66>0</span><span style=color:#abb2bf>]</span> <span style=color:#abb2bf>=</span> <span style=color:#54b1c7>...</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=returning-slices-and-maps-返回切片和映射>Returning Slices and Maps 返回切片和映射</h4><p>Similarly, be wary of user modifications to maps or slices exposing internal state.</p><p>​ 同样，要小心用户对映射或切片的修改，这些修改会公开内部状态。</p><div class=highlight><div style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">36
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Bad
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>type</span> <span style=color:#aa89ea>Stats</span> <span style=color:#76a9f9>struct</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>mu</span> <span style=color:#aa89ea>sync</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>Mutex</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>counters</span> <span style=color:#76a9f9>map</span><span style=color:#abb2bf>[</span><span style=color:#e5c07b>string</span><span style=color:#abb2bf>]</span><span style=color:#e5c07b>int</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Snapshot returns the current stats.
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>func</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>s</span> <span style=color:#54b1c7>*</span><span style=color:#aa89ea>Stats</span><span style=color:#abb2bf>)</span> <span style=color:#00b1f7>Snapshot</span><span style=color:#abb2bf>()</span> <span style=color:#76a9f9>map</span><span style=color:#abb2bf>[</span><span style=color:#e5c07b>string</span><span style=color:#abb2bf>]</span><span style=color:#e5c07b>int</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>s</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>mu</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Lock</span><span style=color:#abb2bf>()</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>defer</span> <span style=color:#aa89ea>s</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>mu</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Unlock</span><span style=color:#abb2bf>()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>return</span> <span style=color:#aa89ea>s</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>counters</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// snapshot is no longer protected by the mutex, so any
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// access to the snapshot is subject to data races.
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#aa89ea>snapshot</span> <span style=color:#54b1c7>:=</span> <span style=color:#aa89ea>stats</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Snapshot</span><span style=color:#abb2bf>()</span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Good
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>type</span> <span style=color:#aa89ea>Stats</span> <span style=color:#76a9f9>struct</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>mu</span> <span style=color:#aa89ea>sync</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>Mutex</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>counters</span> <span style=color:#76a9f9>map</span><span style=color:#abb2bf>[</span><span style=color:#e5c07b>string</span><span style=color:#abb2bf>]</span><span style=color:#e5c07b>int</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>func</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>s</span> <span style=color:#54b1c7>*</span><span style=color:#aa89ea>Stats</span><span style=color:#abb2bf>)</span> <span style=color:#00b1f7>Snapshot</span><span style=color:#abb2bf>()</span> <span style=color:#76a9f9>map</span><span style=color:#abb2bf>[</span><span style=color:#e5c07b>string</span><span style=color:#abb2bf>]</span><span style=color:#e5c07b>int</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>s</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>mu</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Lock</span><span style=color:#abb2bf>()</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>defer</span> <span style=color:#aa89ea>s</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>mu</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Unlock</span><span style=color:#abb2bf>()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>result</span> <span style=color:#54b1c7>:=</span> <span style=color:#e5c07b>make</span><span style=color:#abb2bf>(</span><span style=color:#76a9f9>map</span><span style=color:#abb2bf>[</span><span style=color:#e5c07b>string</span><span style=color:#abb2bf>]</span><span style=color:#e5c07b>int</span><span style=color:#abb2bf>,</span> <span style=color:#e5c07b>len</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>s</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>counters</span><span style=color:#abb2bf>))</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>for</span> <span style=color:#aa89ea>k</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>v</span> <span style=color:#54b1c7>:=</span> <span style=color:#76a9f9>range</span> <span style=color:#aa89ea>s</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>counters</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>result</span><span style=color:#abb2bf>[</span><span style=color:#aa89ea>k</span><span style=color:#abb2bf>]</span> <span style=color:#abb2bf>=</span> <span style=color:#aa89ea>v</span>
</span></span><span style=display:flex><span>  <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>return</span> <span style=color:#aa89ea>result</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Snapshot is now a copy.
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#aa89ea>snapshot</span> <span style=color:#54b1c7>:=</span> <span style=color:#aa89ea>stats</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Snapshot</span><span style=color:#abb2bf>()</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=defer-to-clean-up-推迟清理>Defer to Clean Up 推迟清理</h3><p>Use defer to clean up resources such as files and locks.</p><p>​ 使用 defer 清理资源，例如文件和锁。</p><div class=highlight><div style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">26
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Bad
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#aa89ea>p</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Lock</span><span style=color:#abb2bf>()</span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>if</span> <span style=color:#aa89ea>p</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>count</span> <span style=color:#abb2bf>&lt;</span> <span style=color:#d19a66>10</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>p</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Unlock</span><span style=color:#abb2bf>()</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>return</span> <span style=color:#aa89ea>p</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>count</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>p</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>count</span><span style=color:#54b1c7>++</span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>newCount</span> <span style=color:#54b1c7>:=</span> <span style=color:#aa89ea>p</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>count</span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>p</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Unlock</span><span style=color:#abb2bf>()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>return</span> <span style=color:#aa89ea>newCount</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// easy to miss unlocks due to multiple returns
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Good
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#aa89ea>p</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Lock</span><span style=color:#abb2bf>()</span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>defer</span> <span style=color:#aa89ea>p</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Unlock</span><span style=color:#abb2bf>()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>if</span> <span style=color:#aa89ea>p</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>count</span> <span style=color:#abb2bf>&lt;</span> <span style=color:#d19a66>10</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>return</span> <span style=color:#aa89ea>p</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>count</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>p</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>count</span><span style=color:#54b1c7>++</span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>return</span> <span style=color:#aa89ea>p</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>count</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// more readable
</span></span></span></code></pre></td></tr></table></div></div><p>Defer has an extremely small overhead and should be avoided only if you can prove that your function execution time is in the order of nanoseconds. The readability win of using defers is worth the miniscule cost of using them. This is especially true for larger methods that have more than simple memory accesses, where the other computations are more significant than the <code>defer</code>.</p><p>​ 延迟的开销极小，只有当您可以证明函数执行时间以纳秒为单位时才应避免使用延迟。使用延迟的可读性优势值得付出极小的使用成本。对于具有不止简单内存访问的较大方法尤其如此，其中其他计算比 <code>defer</code> 更重要。</p><h3 id=channel-size-is-one-or-none-通道大小为一或无>Channel Size is One or None 通道大小为一或无</h3><p>Channels should usually have a size of one or be unbuffered. By default, channels are unbuffered and have a size of zero. Any other size must be subject to a high level of scrutiny. Consider how the size is determined, what prevents the channel from filling up under load and blocking writers, and what happens when this occurs.</p><p>​ 通道通常应大小为一或无缓冲。默认情况下，通道无缓冲且大小为零。任何其他大小都必须经过严格审查。考虑如何确定大小，防止通道在负载下填满并阻塞写入器，以及发生这种情况时会发生什么。</p><div class=highlight><div style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Bad
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Ought to be enough for anybody!
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#aa89ea>c</span> <span style=color:#54b1c7>:=</span> <span style=color:#e5c07b>make</span><span style=color:#abb2bf>(</span><span style=color:#76a9f9>chan</span> <span style=color:#e5c07b>int</span><span style=color:#abb2bf>,</span> <span style=color:#d19a66>64</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Good
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Size of one
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#aa89ea>c</span> <span style=color:#54b1c7>:=</span> <span style=color:#e5c07b>make</span><span style=color:#abb2bf>(</span><span style=color:#76a9f9>chan</span> <span style=color:#e5c07b>int</span><span style=color:#abb2bf>,</span> <span style=color:#d19a66>1</span><span style=color:#abb2bf>)</span> <span style=color:#8a93a5;font-style:italic>// or
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Unbuffered channel, size of zero
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#aa89ea>c</span> <span style=color:#54b1c7>:=</span> <span style=color:#e5c07b>make</span><span style=color:#abb2bf>(</span><span style=color:#76a9f9>chan</span> <span style=color:#e5c07b>int</span><span style=color:#abb2bf>)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=start-enums-at-one-从一处开始枚举>Start Enums at One 从一处开始枚举</h3><p>The standard way of introducing enumerations in Go is to declare a custom type and a <code>const</code> group with <code>iota</code>. Since variables have a 0 default value, you should usually start your enums on a non-zero value.</p><p>​ 在 Go 中引入枚举的标准方法是声明一个自定义类型和一个带有 <code>iota</code> 的 <code>const</code> 组。由于变量的默认值为 0，因此您通常应从非零值开始枚举。</p><div class=highlight><div style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">20
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Bad
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>type</span> <span style=color:#aa89ea>Operation</span> <span style=color:#e5c07b>int</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>const</span> <span style=color:#abb2bf>(</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>Add</span> <span style=color:#aa89ea>Operation</span> <span style=color:#abb2bf>=</span> <span style=color:#e5c07b>iota</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>Subtract</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>Multiply</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Add=0, Subtract=1, Multiply=2
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Good
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>type</span> <span style=color:#aa89ea>Operation</span> <span style=color:#e5c07b>int</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>const</span> <span style=color:#abb2bf>(</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>Add</span> <span style=color:#aa89ea>Operation</span> <span style=color:#abb2bf>=</span> <span style=color:#e5c07b>iota</span> <span style=color:#54b1c7>+</span> <span style=color:#d19a66>1</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>Subtract</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>Multiply</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Add=1, Subtract=2, Multiply=3
</span></span></span></code></pre></td></tr></table></div></div><p>There are cases where using the zero value makes sense, for example when the zero value case is the desirable default behavior.</p><p>​ 在某些情况下，使用零值是有意义的，例如当零值情况是理想的默认行为时。</p><div class=highlight><div style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#76a9f9>type</span> <span style=color:#aa89ea>LogOutput</span> <span style=color:#e5c07b>int</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>const</span> <span style=color:#abb2bf>(</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>LogToStdout</span> <span style=color:#aa89ea>LogOutput</span> <span style=color:#abb2bf>=</span> <span style=color:#e5c07b>iota</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>LogToFile</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>LogToRemote</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// LogToStdout=0, LogToFile=1, LogToRemote=2
</span></span></span></code></pre></td></tr></table></div></div><h3 id=use-time-to-handle-time-使用-time-处理时间>Use <code>"time"</code> to handle time 使用 <code>"time"</code> 处理时间</h3><p>Time is complicated. Incorrect assumptions often made about time include the following.</p><p>​ 时间很复杂。关于时间经常做出的错误假设包括以下内容。</p><ol><li>A day has 24 hours
一天有 24 小时</li><li>An hour has 60 minutes
一小时有 60 分钟</li><li>A week has 7 days
一周有 7 天</li><li>A year has 365 days
一年有 365 天</li><li><a href=https://infiniteundo.com/post/25326999628/falsehoods-programmers-believe-about-time>And a lot more
等等</a></li></ol><p>For example, <em>1</em> means that adding 24 hours to a time instant will not always yield a new calendar day.</p><p>​ 例如，1 表示将 24 小时添加到时间瞬间并不总是会产生新的日历日。</p><p>Therefore, always use the <a href=https://golang.org/pkg/time/><code>"time"</code></a> package when dealing with time because it helps deal with these incorrect assumptions in a safer, more accurate manner.</p><p>​ 因此，在处理时间时始终使用 <code>"time"</code> 包，因为它有助于以更安全、更准确的方式处理这些错误假设。</p><h4 id=use-timetime-for-instants-of-time-对时间瞬间使用-timetime>Use <code>time.Time</code> for instants of time 对时间瞬间使用 <code>time.Time</code></h4><p>Use <a href=https://golang.org/pkg/time/#Time><code>time.Time</code></a> when dealing with instants of time, and the methods on <code>time.Time</code> when comparing, adding, or subtracting time.</p><p>​ 在处理时间瞬间时使用 <code>time.Time</code> ，并在比较、添加或减去时间时使用 <code>time.Time</code> 上的方法。</p><div class=highlight><div style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Bad
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>func</span> <span style=color:#00b1f7>isActive</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>now</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>start</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>stop</span> <span style=color:#e5c07b>int</span><span style=color:#abb2bf>)</span> <span style=color:#e5c07b>bool</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>return</span> <span style=color:#aa89ea>start</span> <span style=color:#54b1c7>&lt;=</span> <span style=color:#aa89ea>now</span> <span style=color:#54b1c7>&amp;&amp;</span> <span style=color:#aa89ea>now</span> <span style=color:#abb2bf>&lt;</span> <span style=color:#aa89ea>stop</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Good
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>func</span> <span style=color:#00b1f7>isActive</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>now</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>start</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>stop</span> <span style=color:#aa89ea>time</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>Time</span><span style=color:#abb2bf>)</span> <span style=color:#e5c07b>bool</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>return</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>start</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Before</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>now</span><span style=color:#abb2bf>)</span> <span style=color:#54b1c7>||</span> <span style=color:#aa89ea>start</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Equal</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>now</span><span style=color:#abb2bf>))</span> <span style=color:#54b1c7>&amp;&amp;</span> <span style=color:#aa89ea>now</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Before</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>stop</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=use-timeduration-for-periods-of-time-使用-timeduration-表示时间段>Use <code>time.Duration</code> for periods of time 使用 <code>time.Duration</code> 表示时间段</h4><p>Use <a href=https://golang.org/pkg/time/#Duration><code>time.Duration</code></a> when dealing with periods of time.</p><p>​ 处理时间段时，请使用 <code>time.Duration</code> 。</p><div class=highlight><div style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">18
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Bad
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>func</span> <span style=color:#00b1f7>poll</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>delay</span> <span style=color:#e5c07b>int</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>for</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#8a93a5;font-style:italic>// ...
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>    <span style=color:#aa89ea>time</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Sleep</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>time</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Duration</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>delay</span><span style=color:#abb2bf>)</span> <span style=color:#54b1c7>*</span> <span style=color:#aa89ea>time</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>Millisecond</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>  <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00b1f7>poll</span><span style=color:#abb2bf>(</span><span style=color:#d19a66>10</span><span style=color:#abb2bf>)</span> <span style=color:#8a93a5;font-style:italic>// was it seconds or milliseconds?
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Good
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>func</span> <span style=color:#00b1f7>poll</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>delay</span> <span style=color:#aa89ea>time</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>Duration</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>for</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#8a93a5;font-style:italic>// ...
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>    <span style=color:#aa89ea>time</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Sleep</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>delay</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>  <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00b1f7>poll</span><span style=color:#abb2bf>(</span><span style=color:#d19a66>10</span><span style=color:#54b1c7>*</span><span style=color:#aa89ea>time</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>Second</span><span style=color:#abb2bf>)</span>
</span></span></code></pre></td></tr></table></div></div><p>Going back to the example of adding 24 hours to a time instant, the method we use to add time depends on intent. If we want the same time of the day, but on the next calendar day, we should use <a href=https://golang.org/pkg/time/#Time.AddDate><code>Time.AddDate</code></a>. However, if we want an instant of time guaranteed to be 24 hours after the previous time, we should use <a href=https://golang.org/pkg/time/#Time.Add><code>Time.Add</code></a>.</p><p>​ 回到将 24 小时添加到时间戳的示例，我们用于添加时间的方法取决于意图。如果我们想要同一天的相同时间，但位于下一个日历日，我们应该使用 <code>Time.AddDate</code> 。但是，如果我们想要一个时间戳，保证在之前的时间之后 24 小时，我们应该使用 <code>Time.Add</code> 。</p><pre tabindex=0><code>newDay := t.AddDate(0 /* years */, 0 /* months */, 1 /* days */)
maybeNewDay := t.Add(24 * time.Hour)
</code></pre><h4 id=use-timetime-and-timeduration-with-external-systems-与外部系统一起使用-timetime-和-timeduration>Use <code>time.Time</code> and <code>time.Duration</code> with external systems 与外部系统一起使用 <code>time.Time</code> 和 <code>time.Duration</code></h4><p>Use <code>time.Duration</code> and <code>time.Time</code> in interactions with external systems when possible. For example:</p><p>​ 尽可能在与外部系统的交互中使用 <code>time.Duration</code> 和 <code>time.Time</code> 。例如：</p><ul><li>Command-line flags: <a href=https://golang.org/pkg/flag/><code>flag</code></a> supports <code>time.Duration</code> via <a href=https://golang.org/pkg/time/#ParseDuration><code>time.ParseDuration</code></a>
命令行标志： <code>flag</code> 通过 <code>time.ParseDuration</code> 支持 <code>time.Duration</code></li><li>JSON: <a href=https://golang.org/pkg/encoding/json/><code>encoding/json</code></a> supports encoding <code>time.Time</code> as an <a href=https://tools.ietf.org/html/rfc3339>RFC 3339</a> string via its <a href=https://golang.org/pkg/time/#Time.UnmarshalJSON><code>UnmarshalJSON</code> method</a>
JSON: <code>encoding/json</code> 通过其 <code>UnmarshalJSON</code> 方法支持将 <code>time.Time</code> 编码为 RFC 3339 字符串</li><li>SQL: <a href=https://golang.org/pkg/database/sql/><code>database/sql</code></a> supports converting <code>DATETIME</code> or <code>TIMESTAMP</code> columns into <code>time.Time</code> and back if the underlying driver supports it
SQL: <code>database/sql</code> 支持将 <code>DATETIME</code> 或 <code>TIMESTAMP</code> 列转换为 <code>time.Time</code> ，反之亦然（如果底层驱动程序支持）</li><li>YAML: <a href=https://godoc.org/gopkg.in/yaml.v2><code>gopkg.in/yaml.v2</code></a> supports <code>time.Time</code> as an <a href=https://tools.ietf.org/html/rfc3339>RFC 3339</a> string, and <code>time.Duration</code> via <a href=https://golang.org/pkg/time/#ParseDuration><code>time.ParseDuration</code></a>.
YAML: <code>gopkg.in/yaml.v2</code> 支持 <code>time.Time</code> 作为 RFC 3339 字符串，以及通过 <code>time.ParseDuration</code> 支持 <code>time.Duration</code> 。</li></ul><p>When it is not possible to use <code>time.Duration</code> in these interactions, use <code>int</code> or <code>float64</code> and include the unit in the name of the field.</p><p>​ 如果在这些交互中无法使用 <code>time.Duration</code> ，请使用 <code>int</code> 或 <code>float64</code> ，并将单位包含在字段名称中。</p><p>For example, since <code>encoding/json</code> does not support <code>time.Duration</code>, the unit is included in the name of the field.</p><p>​ 例如，由于 <code>encoding/json</code> 不支持 <code>time.Duration</code> ，因此将单位包含在字段名称中。</p><div class=highlight><div style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">10
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Bad
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// {&#34;interval&#34;: 2}
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>type</span> <span style=color:#aa89ea>Config</span> <span style=color:#76a9f9>struct</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>Interval</span> <span style=color:#e5c07b>int</span> <span style=color:#98c379>`json:&#34;interval&#34;`</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Good
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// {&#34;intervalMillis&#34;: 2000}
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>type</span> <span style=color:#aa89ea>Config</span> <span style=color:#76a9f9>struct</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>IntervalMillis</span> <span style=color:#e5c07b>int</span> <span style=color:#98c379>`json:&#34;intervalMillis&#34;`</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span></code></pre></td></tr></table></div></div><p>When it is not possible to use <code>time.Time</code> in these interactions, unless an alternative is agreed upon, use <code>string</code> and format timestamps as defined in <a href=https://tools.ietf.org/html/rfc3339>RFC 3339</a>. This format is used by default by <a href=https://golang.org/pkg/time/#Time.UnmarshalText><code>Time.UnmarshalText</code></a> and is available for use in <code>Time.Format</code> and <code>time.Parse</code> via <a href=https://golang.org/pkg/time/#RFC3339><code>time.RFC3339</code></a>.</p><p>​ 如果在这些交互中无法使用 <code>time.Time</code> ，除非另行达成一致，请使用 <code>string</code> ，并将时间戳格式化为 RFC 3339 中定义的格式。此格式默认由 <code>Time.UnmarshalText</code> 使用，并且可通过 <code>time.RFC3339</code> 在 <code>Time.Format</code> 和 <code>time.Parse</code> 中使用。</p><p>Although this tends to not be a problem in practice, keep in mind that the <code>"time"</code> package does not support parsing timestamps with leap seconds (<a href=https://github.com/golang/go/issues/8728>8728</a>), nor does it account for leap seconds in calculations (<a href=https://github.com/golang/go/issues/15190>15190</a>). If you compare two instants of time, the difference will not include the leap seconds that may have occurred between those two instants.</p><p>​ 尽管在实践中这往往不是问题，但请记住， <code>"time"</code> 包不支持解析带闰秒的时间戳 ( 8728)，也不在计算中考虑闰秒 ( 15190)。如果您比较两个时间点，则差值不会包括在这两个时间点之间可能发生的闰秒。</p><h3 id=errors-错误>Errors 错误</h3><h4 id=error-types-错误类型>Error Types 错误类型</h4><p>There are few options for declaring errors. Consider the following before picking the option best suited for your use case.</p><p>​ 声明错误的方法很少。在选择最适合您的用例的选项之前，请考虑以下几点。</p><ul><li>Does the caller need to match the error so that they can handle it? If yes, we must support the <a href=https://golang.org/pkg/errors/#Is><code>errors.Is</code></a> or <a href=https://golang.org/pkg/errors/#As><code>errors.As</code></a> functions by declaring a top-level error variable or a custom type.
调用者是否需要匹配错误以便能够处理错误？如果是，我们必须通过声明顶级错误变量或自定义类型来支持 <code>errors.Is</code> 或 <code>errors.As</code> 函数。</li><li>Is the error message a static string, or is it a dynamic string that requires contextual information? For the former, we can use <a href=https://golang.org/pkg/errors/#New><code>errors.New</code></a>, but for the latter we must use <a href=https://golang.org/pkg/fmt/#Errorf><code>fmt.Errorf</code></a> or a custom error type.
错误消息是静态字符串还是需要上下文信息的动态字符串？对于前者，我们可以使用 <code>errors.New</code> ，但对于后者，我们必须使用 <code>fmt.Errorf</code> 或自定义错误类型。</li><li>Are we propagating a new error returned by a downstream function? If so, see the <a href=https://github.com/uber-go/guide/blob/master/style.md#error-wrapping>section on error wrapping</a>.
我们是否正在传播下游函数返回的新错误？如果是，请参阅错误包装部分。</li></ul><table><thead><tr><th>Error matching? 错误匹配？</th><th>Error Message 错误消息</th><th>Guidance 指导</th></tr></thead><tbody><tr><td>No</td><td>static 静态</td><td><a href=https://golang.org/pkg/errors/#New><code>errors.New</code></a></td></tr><tr><td>No</td><td>dynamic 动态</td><td><a href=https://golang.org/pkg/fmt/#Errorf><code>fmt.Errorf</code></a></td></tr><tr><td>Yes</td><td>static 静态</td><td>top-level <code>var</code> with <a href=https://golang.org/pkg/errors/#New><code>errors.New</code></a> 顶级 <code>var</code> 与 <code>errors.New</code></td></tr><tr><td>Yes</td><td>dynamic 动态</td><td>custom <code>error</code> type 自定义 <code>error</code> 类型</td></tr></tbody></table><p>For example, use <a href=https://golang.org/pkg/errors/#New><code>errors.New</code></a> for an error with a static string. Export this error as a variable to support matching it with <code>errors.Is</code> if the caller needs to match and handle this error.</p><p>​ 例如，对于具有静态字符串的错误，请使用 <code>errors.New</code> 。将此错误导出为变量，以支持与 <code>errors.Is</code> 匹配，如果调用方需要匹配并处理此错误。</p><div class=highlight><div style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">31
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// No error matching
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// package foo
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>func</span> <span style=color:#00b1f7>Open</span><span style=color:#abb2bf>()</span> <span style=color:#e5c07b>error</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>return</span> <span style=color:#aa89ea>errors</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>New</span><span style=color:#abb2bf>(</span><span style=color:#98c379>&#34;could not open&#34;</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// package bar
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>if</span> <span style=color:#aa89ea>err</span> <span style=color:#54b1c7>:=</span> <span style=color:#aa89ea>foo</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Open</span><span style=color:#abb2bf>();</span> <span style=color:#aa89ea>err</span> <span style=color:#54b1c7>!=</span> <span style=color:#e5c07b>nil</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#8a93a5;font-style:italic>// Can&#39;t handle the error.
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>  <span style=color:#e5c07b>panic</span><span style=color:#abb2bf>(</span><span style=color:#98c379>&#34;unknown error&#34;</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Error matching
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// package foo
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>var</span> <span style=color:#aa89ea>ErrCouldNotOpen</span> <span style=color:#abb2bf>=</span> <span style=color:#aa89ea>errors</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>New</span><span style=color:#abb2bf>(</span><span style=color:#98c379>&#34;could not open&#34;</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>func</span> <span style=color:#00b1f7>Open</span><span style=color:#abb2bf>()</span> <span style=color:#e5c07b>error</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>return</span> <span style=color:#aa89ea>ErrCouldNotOpen</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// package bar
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>if</span> <span style=color:#aa89ea>err</span> <span style=color:#54b1c7>:=</span> <span style=color:#aa89ea>foo</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Open</span><span style=color:#abb2bf>();</span> <span style=color:#aa89ea>err</span> <span style=color:#54b1c7>!=</span> <span style=color:#e5c07b>nil</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>if</span> <span style=color:#aa89ea>errors</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Is</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>err</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>foo</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>ErrCouldNotOpen</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#8a93a5;font-style:italic>// handle the error
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>  <span style=color:#abb2bf>}</span> <span style=color:#76a9f9>else</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#e5c07b>panic</span><span style=color:#abb2bf>(</span><span style=color:#98c379>&#34;unknown error&#34;</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>  <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span></code></pre></td></tr></table></div></div><p>For an error with a dynamic string, use <a href=https://golang.org/pkg/fmt/#Errorf><code>fmt.Errorf</code></a> if the caller does not need to match it, and a custom <code>error</code> if the caller does need to match it.</p><p>​ 对于具有动态字符串的错误，如果调用方不需要匹配它，请使用 <code>fmt.Errorf</code> ；如果调用方确实需要匹配它，请使用自定义 <code>error</code> 。</p><div class=highlight><div style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">39
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// No error matching
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// package foo
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>func</span> <span style=color:#00b1f7>Open</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>file</span> <span style=color:#e5c07b>string</span><span style=color:#abb2bf>)</span> <span style=color:#e5c07b>error</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>return</span> <span style=color:#aa89ea>fmt</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Errorf</span><span style=color:#abb2bf>(</span><span style=color:#98c379>&#34;file %q not found&#34;</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>file</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// package bar
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>if</span> <span style=color:#aa89ea>err</span> <span style=color:#54b1c7>:=</span> <span style=color:#aa89ea>foo</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Open</span><span style=color:#abb2bf>(</span><span style=color:#98c379>&#34;testfile.txt&#34;</span><span style=color:#abb2bf>);</span> <span style=color:#aa89ea>err</span> <span style=color:#54b1c7>!=</span> <span style=color:#e5c07b>nil</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#8a93a5;font-style:italic>// Can&#39;t handle the error.
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>  <span style=color:#e5c07b>panic</span><span style=color:#abb2bf>(</span><span style=color:#98c379>&#34;unknown error&#34;</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Error matching
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// package foo
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>type</span> <span style=color:#aa89ea>NotFoundError</span> <span style=color:#76a9f9>struct</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>File</span> <span style=color:#e5c07b>string</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>func</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>e</span> <span style=color:#54b1c7>*</span><span style=color:#aa89ea>NotFoundError</span><span style=color:#abb2bf>)</span> <span style=color:#00b1f7>Error</span><span style=color:#abb2bf>()</span> <span style=color:#e5c07b>string</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>return</span> <span style=color:#aa89ea>fmt</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Sprintf</span><span style=color:#abb2bf>(</span><span style=color:#98c379>&#34;file %q not found&#34;</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>e</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>File</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>func</span> <span style=color:#00b1f7>Open</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>file</span> <span style=color:#e5c07b>string</span><span style=color:#abb2bf>)</span> <span style=color:#e5c07b>error</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>return</span> <span style=color:#54b1c7>&amp;</span><span style=color:#aa89ea>NotFoundError</span><span style=color:#abb2bf>{</span><span style=color:#aa89ea>File</span><span style=color:#abb2bf>:</span> <span style=color:#aa89ea>file</span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// package bar
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>if</span> <span style=color:#aa89ea>err</span> <span style=color:#54b1c7>:=</span> <span style=color:#aa89ea>foo</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Open</span><span style=color:#abb2bf>(</span><span style=color:#98c379>&#34;testfile.txt&#34;</span><span style=color:#abb2bf>);</span> <span style=color:#aa89ea>err</span> <span style=color:#54b1c7>!=</span> <span style=color:#e5c07b>nil</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>var</span> <span style=color:#aa89ea>notFound</span> <span style=color:#54b1c7>*</span><span style=color:#aa89ea>NotFoundError</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>if</span> <span style=color:#aa89ea>errors</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>As</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>err</span><span style=color:#abb2bf>,</span> <span style=color:#54b1c7>&amp;</span><span style=color:#aa89ea>notFound</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#8a93a5;font-style:italic>// handle the error
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>  <span style=color:#abb2bf>}</span> <span style=color:#76a9f9>else</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#e5c07b>panic</span><span style=color:#abb2bf>(</span><span style=color:#98c379>&#34;unknown error&#34;</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>  <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span></code></pre></td></tr></table></div></div><p>Note that if you export error variables or types from a package, they will become part of the public API of the package.</p><p>​ 请注意，如果您从包中导出错误变量或类型，它们将成为包的公共 API 的一部分。</p><h4 id=error-wrapping-错误包装>Error Wrapping 错误包装</h4><p>There are three main options for propagating errors if a call fails:</p><p>​ 如果调用失败，有三种主要选项可用于传播错误：</p><ul><li>return the original error as-is
按原样返回原始错误</li><li>add context with <code>fmt.Errorf</code> and the <code>%w</code> verb
使用 <code>fmt.Errorf</code> 和 <code>%w</code> 动词添加上下文</li><li>add context with <code>fmt.Errorf</code> and the <code>%v</code> verb
使用 <code>fmt.Errorf</code> 和 <code>%v</code> 动词添加上下文</li></ul><p>Return the original error as-is if there is no additional context to add. This maintains the original error type and message. This is well suited for cases when the underlying error message has sufficient information to track down where it came from.</p><p>​ 如果没有要添加的其他上下文，请按原样返回原始错误。这将保留原始错误类型和消息。当基础错误消息有足够的信息来跟踪其来源时，这非常适合。</p><p>Otherwise, add context to the error message where possible so that instead of a vague error such as “connection refused”, you get more useful errors such as “call service foo: connection refused”.</p><p>​ 否则，尽可能为错误消息添加上下文，以便您获得“连接被拒绝”等更有用的错误，而不是“连接被拒绝”等模糊的错误。</p><p>Use <code>fmt.Errorf</code> to add context to your errors, picking between the <code>%w</code> or <code>%v</code> verbs based on whether the caller should be able to match and extract the underlying cause.</p><p>​ 使用 <code>fmt.Errorf</code> 为错误添加上下文，根据调用者是否能够匹配并提取根本原因，在 <code>%w</code> 或 <code>%v</code> 动词之间进行选择。</p><ul><li>Use <code>%w</code> if the caller should have access to the underlying error. This is a good default for most wrapped errors, but be aware that callers may begin to rely on this behavior. So for cases where the wrapped error is a known <code>var</code> or type, document and test it as part of your function’s contract.
如果调用者应该有权访问基础错误，请使用 <code>%w</code> 。对于大多数包装错误来说，这是一个很好的默认值，但请注意，调用者可能会开始依赖此行为。因此，对于包装错误是已知的 <code>var</code> 或类型的情况，请将其作为函数契约的一部分进行记录和测试。</li><li>Use <code>%v</code> to obfuscate the underlying error. Callers will be unable to match it, but you can switch to <code>%w</code> in the future if needed.
使用 <code>%v</code> 混淆基础错误。调用者将无法匹配它，但您可以在需要时在将来切换到 <code>%w</code> 。</li></ul><p>When adding context to returned errors, keep the context succinct by avoiding phrases like “failed to”, which state the obvious and pile up as the error percolates up through the stack:</p><p>​ 在为返回的错误添加上下文时，请避免使用“失败”等短语来保持上下文简洁，这些短语说明了显而易见的事情，并且随着错误在堆栈中渗透而堆积起来：</p><div class=highlight><div style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">16
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Bad
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#aa89ea>s</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>err</span> <span style=color:#54b1c7>:=</span> <span style=color:#aa89ea>store</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>New</span><span style=color:#abb2bf>()</span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>if</span> <span style=color:#aa89ea>err</span> <span style=color:#54b1c7>!=</span> <span style=color:#e5c07b>nil</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#76a9f9>return</span> <span style=color:#aa89ea>fmt</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Errorf</span><span style=color:#abb2bf>(</span>
</span></span><span style=display:flex><span>        <span style=color:#98c379>&#34;failed to create new store: %w&#34;</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>err</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// failed to x: failed to y: failed to create new store: the error
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Good
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#aa89ea>s</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>err</span> <span style=color:#54b1c7>:=</span> <span style=color:#aa89ea>store</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>New</span><span style=color:#abb2bf>()</span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>if</span> <span style=color:#aa89ea>err</span> <span style=color:#54b1c7>!=</span> <span style=color:#e5c07b>nil</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#76a9f9>return</span> <span style=color:#aa89ea>fmt</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Errorf</span><span style=color:#abb2bf>(</span>
</span></span><span style=display:flex><span>        <span style=color:#98c379>&#34;new store: %w&#34;</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>err</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// x: y: new store: the error
</span></span></span></code></pre></td></tr></table></div></div><p>However once the error is sent to another system, it should be clear the message is an error (e.g. an <code>err</code> tag or “Failed” prefix in logs).</p><p>​ 但是，一旦错误被发送到另一个系统，就应该清楚消息是一个错误（例如，日志中的 <code>err</code> 标记或“失败”前缀）。</p><p>See also <a href=https://dave.cheney.net/2016/04/27/dont-just-check-errors-handle-them-gracefully>Don’t just check errors, handle them gracefully</a>.</p><p>​ 另请参阅不要仅仅检查错误，还要妥善处理它们。</p><h4 id=error-naming-错误命名>Error Naming 错误命名</h4><p>For error values stored as global variables, use the prefix <code>Err</code> or <code>err</code> depending on whether they’re exported. This guidance supersedes the <a href=https://github.com/uber-go/guide/blob/master/style.md#prefix-unexported-globals-with-_>Prefix Unexported Globals with _</a>.</p><p>​ 对于存储为全局变量的错误值，请使用前缀 <code>Err</code> 或 <code>err</code> ，具体取决于它们是否已导出。此指南取代了使用 _ 为未导出的全局变量添加前缀。</p><div class=highlight><div style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">15
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#76a9f9>var</span> <span style=color:#abb2bf>(</span>
</span></span><span style=display:flex><span>  <span style=color:#8a93a5;font-style:italic>// The following two errors are exported
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>  <span style=color:#8a93a5;font-style:italic>// so that users of this package can match them
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>  <span style=color:#8a93a5;font-style:italic>// with errors.Is.
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>ErrBrokenLink</span> <span style=color:#abb2bf>=</span> <span style=color:#aa89ea>errors</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>New</span><span style=color:#abb2bf>(</span><span style=color:#98c379>&#34;link is broken&#34;</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>ErrCouldNotOpen</span> <span style=color:#abb2bf>=</span> <span style=color:#aa89ea>errors</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>New</span><span style=color:#abb2bf>(</span><span style=color:#98c379>&#34;could not open&#34;</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8a93a5;font-style:italic>// This error is not exported because
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>  <span style=color:#8a93a5;font-style:italic>// we don&#39;t want to make it part of our public API.
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>  <span style=color:#8a93a5;font-style:italic>// We may still use it inside the package
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>  <span style=color:#8a93a5;font-style:italic>// with errors.Is.
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>errNotFound</span> <span style=color:#abb2bf>=</span> <span style=color:#aa89ea>errors</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>New</span><span style=color:#abb2bf>(</span><span style=color:#98c379>&#34;not found&#34;</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>)</span>
</span></span></code></pre></td></tr></table></div></div><p>For custom error types, use the suffix <code>Error</code> instead.</p><p>​ 对于自定义错误类型，请改用后缀 <code>Error</code> 。</p><pre tabindex=0><code>// Similarly, this error is exported
// so that users of this package can match it
// with errors.As.

type NotFoundError struct {
  File string
}

func (e *NotFoundError) Error() string {
  return fmt.Sprintf(&#34;file %q not found&#34;, e.File)
}

// And this error is not exported because
// we don&#39;t want to make it part of the public API.
// We can still use it inside the package
// with errors.As.

type resolveError struct {
  Path string
}

func (e *resolveError) Error() string {
  return fmt.Sprintf(&#34;resolve %q&#34;, e.Path)
}
</code></pre><h4 id=handle-errors-once-一次处理错误>Handle Errors Once 一次处理错误</h4><p>When a caller receives an error from a callee, it can handle it in a variety of different ways depending on what it knows about the error.</p><p>​ 当调用方从被调用方收到错误时，它可以根据对错误的了解以各种不同的方式处理错误。</p><p>These include, but not are limited to:</p><p>​ 这些包括但不限于：</p><ul><li>if the callee contract defines specific errors, matching the error with <code>errors.Is</code> or <code>errors.As</code> and handling the branches differently
如果被调用方合约定义了特定错误，则使用 <code>errors.Is</code> 或 <code>errors.As</code> 匹配错误并以不同的方式处理分支</li><li>if the error is recoverable, logging the error and degrading gracefully
如果错误是可恢复的，则记录错误并优雅地降级</li><li>if the error represents a domain-specific failure condition, returning a well-defined error
如果错误表示特定于域的故障条件，则返回定义明确的错误</li><li>returning the error, either <a href=https://github.com/uber-go/guide/blob/master/style.md#error-wrapping>wrapped</a> or verbatim
返回错误，无论是包装的还是逐字的</li></ul><p>Regardless of how the caller handles the error, it should typically handle each error only once. The caller should not, for example, log the error and then return it, because <em>its</em> callers may handle the error as well.</p><p>​ 无论调用者如何处理错误，通常都应该只处理一次每个错误。例如，调用者不应记录错误然后返回错误，因为其调用者也可能处理错误。</p><p>For example, consider the following cases:</p><p>​ 例如，考虑以下情况：</p><p><strong>Bad</strong>: Log the error and return it. Callers further up the stack will likely take a similar action with the error. Doing so causing a lot of noise in the application logs for little value.</p><p>​ 错误：记录错误并返回错误。堆栈上方的调用者可能会对错误采取类似的操作。这样做会导致应用程序日志中产生大量噪音，而价值却很小。</p><div class=highlight><div style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Bad
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#aa89ea>u</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>err</span> <span style=color:#54b1c7>:=</span> <span style=color:#00b1f7>getUser</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>id</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>if</span> <span style=color:#aa89ea>err</span> <span style=color:#54b1c7>!=</span> <span style=color:#e5c07b>nil</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#8a93a5;font-style:italic>// BAD: See description
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>  <span style=color:#aa89ea>log</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Printf</span><span style=color:#abb2bf>(</span><span style=color:#98c379>&#34;Could not get user %q: %v&#34;</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>id</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>err</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>return</span> <span style=color:#aa89ea>err</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Good</strong>: Wrap the error and return it. Callers further up the stack will handle the error. Use of <code>%w</code> ensures they can match the error with <code>errors.Is</code> or <code>errors.As</code> if relevant.</p><p>​ 正确：包装错误并返回错误。堆栈上方的调用者将处理错误。使用 <code>%w</code> 确保它们可以将错误与 <code>errors.Is</code> 或 <code>errors.As</code> （如果相关）匹配。</p><div class=highlight><div style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Good
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#aa89ea>u</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>err</span> <span style=color:#54b1c7>:=</span> <span style=color:#00b1f7>getUser</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>id</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>if</span> <span style=color:#aa89ea>err</span> <span style=color:#54b1c7>!=</span> <span style=color:#e5c07b>nil</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>return</span> <span style=color:#aa89ea>fmt</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Errorf</span><span style=color:#abb2bf>(</span><span style=color:#98c379>&#34;get user %q: %w&#34;</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>id</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>err</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Good</strong>: Log the error and degrade gracefully. If the operation isn’t strictly necessary, we can provide a degraded but unbroken experience by recovering from it.</p><p>​ 正确：记录错误并优雅地降级。如果操作不是严格必需的，我们可以通过从中恢复来提供降级但未中断的体验。</p><div class=highlight><div style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">6
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Good
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>if</span> <span style=color:#aa89ea>err</span> <span style=color:#54b1c7>:=</span> <span style=color:#00b1f7>emitMetrics</span><span style=color:#abb2bf>();</span> <span style=color:#aa89ea>err</span> <span style=color:#54b1c7>!=</span> <span style=color:#e5c07b>nil</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#8a93a5;font-style:italic>// Failure to write metrics should not
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>  <span style=color:#8a93a5;font-style:italic>// break the application.
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>  <span style=color:#aa89ea>log</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Printf</span><span style=color:#abb2bf>(</span><span style=color:#98c379>&#34;Could not emit metrics: %v&#34;</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>err</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Good</strong>: Match the error and degrade gracefully. If the callee defines a specific error in its contract, and the failure is recoverable, match on that error case and degrade gracefully. For all other cases, wrap the error and return it. Callers further up the stack will handle other errors.</p><p>​ 正确：匹配错误并优雅地降级。如果被调用者在其契约中定义了特定错误，并且该故障是可恢复的，则匹配该错误情况并优雅地降级。对于所有其他情况，请包装错误并返回错误。堆栈上方的调用者将处理其他错误。</p><div class=highlight><div style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">10
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Good
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#aa89ea>tz</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>err</span> <span style=color:#54b1c7>:=</span> <span style=color:#00b1f7>getUserTimeZone</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>id</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>if</span> <span style=color:#aa89ea>err</span> <span style=color:#54b1c7>!=</span> <span style=color:#e5c07b>nil</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>if</span> <span style=color:#aa89ea>errors</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Is</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>err</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>ErrUserNotFound</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#8a93a5;font-style:italic>// User doesn&#39;t exist. Use UTC.
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>    <span style=color:#aa89ea>tz</span> <span style=color:#abb2bf>=</span> <span style=color:#aa89ea>time</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>UTC</span>
</span></span><span style=display:flex><span>  <span style=color:#abb2bf>}</span> <span style=color:#76a9f9>else</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#76a9f9>return</span> <span style=color:#aa89ea>fmt</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Errorf</span><span style=color:#abb2bf>(</span><span style=color:#98c379>&#34;get user %q: %w&#34;</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>id</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>err</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>  <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=handle-type-assertion-failures-处理类型断言失败>Handle Type Assertion Failures 处理类型断言失败</h3><p>The single return value form of a <a href=https://golang.org/ref/spec#Type_assertions>type assertion</a> will panic on an incorrect type. Therefore, always use the “comma ok” idiom.</p><p>​ 类型断言的单一返回值形式会在类型不正确时引发恐慌。因此，始终使用“逗号 ok”习惯用法。</p><div class=highlight><div style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Bad
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#aa89ea>t</span> <span style=color:#54b1c7>:=</span> <span style=color:#aa89ea>i</span><span style=color:#abb2bf>.(</span><span style=color:#e5c07b>string</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Good
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#aa89ea>t</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>ok</span> <span style=color:#54b1c7>:=</span> <span style=color:#aa89ea>i</span><span style=color:#abb2bf>.(</span><span style=color:#e5c07b>string</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>if</span> <span style=color:#abb2bf>!</span><span style=color:#aa89ea>ok</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#8a93a5;font-style:italic>// handle the error gracefully
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#abb2bf>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=dont-panic-不要恐慌>Don’t Panic 不要恐慌</h3><p>Code running in production must avoid panics. Panics are a major source of <a href=https://en.wikipedia.org/wiki/Cascading_failure>cascading failures</a>. If an error occurs, the function must return an error and allow the caller to decide how to handle it.</p><p>​ 在生产环境中运行的代码必须避免恐慌。恐慌是级联故障的主要来源。如果发生错误，函数必须返回错误并允许调用者决定如何处理它。</p><div class=highlight><div style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">26
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Bad
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>func</span> <span style=color:#00b1f7>run</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>args</span> <span style=color:#abb2bf>[]</span><span style=color:#e5c07b>string</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>if</span> <span style=color:#e5c07b>len</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>args</span><span style=color:#abb2bf>)</span> <span style=color:#54b1c7>==</span> <span style=color:#d19a66>0</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#e5c07b>panic</span><span style=color:#abb2bf>(</span><span style=color:#98c379>&#34;an argument is required&#34;</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>  <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>  <span style=color:#8a93a5;font-style:italic>// ...
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>func</span> <span style=color:#00b1f7>main</span><span style=color:#abb2bf>()</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#00b1f7>run</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>os</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>Args</span><span style=color:#abb2bf>[</span><span style=color:#d19a66>1</span><span style=color:#abb2bf>:])</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Good
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>func</span> <span style=color:#00b1f7>run</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>args</span> <span style=color:#abb2bf>[]</span><span style=color:#e5c07b>string</span><span style=color:#abb2bf>)</span> <span style=color:#e5c07b>error</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>if</span> <span style=color:#e5c07b>len</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>args</span><span style=color:#abb2bf>)</span> <span style=color:#54b1c7>==</span> <span style=color:#d19a66>0</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#76a9f9>return</span> <span style=color:#aa89ea>errors</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>New</span><span style=color:#abb2bf>(</span><span style=color:#98c379>&#34;an argument is required&#34;</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>  <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>  <span style=color:#8a93a5;font-style:italic>// ...
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>  <span style=color:#76a9f9>return</span> <span style=color:#e5c07b>nil</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>func</span> <span style=color:#00b1f7>main</span><span style=color:#abb2bf>()</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>if</span> <span style=color:#aa89ea>err</span> <span style=color:#54b1c7>:=</span> <span style=color:#00b1f7>run</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>os</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>Args</span><span style=color:#abb2bf>[</span><span style=color:#d19a66>1</span><span style=color:#abb2bf>:]);</span> <span style=color:#aa89ea>err</span> <span style=color:#54b1c7>!=</span> <span style=color:#e5c07b>nil</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>fmt</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Fprintln</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>os</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>Stderr</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>err</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>os</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Exit</span><span style=color:#abb2bf>(</span><span style=color:#d19a66>1</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>  <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span></code></pre></td></tr></table></div></div><p>Panic/recover is not an error handling strategy. A program must panic only when something irrecoverable happens such as a nil dereference. An exception to this is program initialization: bad things at program startup that should abort the program may cause panic.</p><p>​ 恐慌/恢复不是错误处理策略。程序仅在发生无法恢复的情况（例如 nil 解引用）时才应恐慌。对此的一个例外是程序初始化：程序启动时应中止程序的错误可能会导致恐慌。</p><div class=highlight><div style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#76a9f9>var</span> <span style=color:#aa89ea>_statusTemplate</span> <span style=color:#abb2bf>=</span> <span style=color:#aa89ea>template</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Must</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>template</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>New</span><span style=color:#abb2bf>(</span><span style=color:#98c379>&#34;name&#34;</span><span style=color:#abb2bf>).</span><span style=color:#00b1f7>Parse</span><span style=color:#abb2bf>(</span><span style=color:#98c379>&#34;_statusHTML&#34;</span><span style=color:#abb2bf>))</span>
</span></span></code></pre></td></tr></table></div></div><p>Even in tests, prefer <code>t.Fatal</code> or <code>t.FailNow</code> over panics to ensure that the test is marked as failed.</p><p>​ 即使在测试中，也更喜欢 <code>t.Fatal</code> 或 <code>t.FailNow</code> ，而不是恐慌，以确保将测试标记为失败。</p><div class=highlight><div style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">14
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Bad
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// func TestFoo(t *testing.T)
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>f</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>err</span> <span style=color:#54b1c7>:=</span> <span style=color:#aa89ea>os</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>CreateTemp</span><span style=color:#abb2bf>(</span><span style=color:#98c379>&#34;&#34;</span><span style=color:#abb2bf>,</span> <span style=color:#98c379>&#34;test&#34;</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>if</span> <span style=color:#aa89ea>err</span> <span style=color:#54b1c7>!=</span> <span style=color:#e5c07b>nil</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#e5c07b>panic</span><span style=color:#abb2bf>(</span><span style=color:#98c379>&#34;failed to set up test&#34;</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Good
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// func TestFoo(t *testing.T)
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>f</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>err</span> <span style=color:#54b1c7>:=</span> <span style=color:#aa89ea>os</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>CreateTemp</span><span style=color:#abb2bf>(</span><span style=color:#98c379>&#34;&#34;</span><span style=color:#abb2bf>,</span> <span style=color:#98c379>&#34;test&#34;</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>if</span> <span style=color:#aa89ea>err</span> <span style=color:#54b1c7>!=</span> <span style=color:#e5c07b>nil</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>t</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Fatal</span><span style=color:#abb2bf>(</span><span style=color:#98c379>&#34;failed to set up test&#34;</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=use-gouberorgatomic-使用-gouberorgatomic>Use go.uber.org/atomic 使用 go.uber.org/atomic</h3><p>Atomic operations with the <a href=https://golang.org/pkg/sync/atomic/>sync/atomic</a> package operate on the raw types (<code>int32</code>, <code>int64</code>, etc.) so it is easy to forget to use the atomic operation to read or modify the variables.</p><p>​ 使用 sync/atomic 包进行原子操作时，操作的是原始类型（ <code>int32</code> 、 <code>int64</code> 等），因此很容易忘记使用原子操作来读取或修改变量。</p><p><a href=https://godoc.org/go.uber.org/atomic>go.uber.org/atomic</a> adds type safety to these operations by hiding the underlying type. Additionally, it includes a convenient <code>atomic.Bool</code> type.</p><p>​ go.uber.org/atomic 通过隐藏底层类型，为这些操作添加了类型安全性。此外，它还包括一个方便的 <code>atomic.Bool</code> 类型。</p><div class=highlight><div style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">32
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Bad
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>type</span> <span style=color:#aa89ea>foo</span> <span style=color:#76a9f9>struct</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>running</span> <span style=color:#e5c07b>int32</span>  <span style=color:#8a93a5;font-style:italic>// atomic
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>func</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>f</span><span style=color:#54b1c7>*</span> <span style=color:#aa89ea>foo</span><span style=color:#abb2bf>)</span> <span style=color:#00b1f7>start</span><span style=color:#abb2bf>()</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>if</span> <span style=color:#aa89ea>atomic</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>SwapInt32</span><span style=color:#abb2bf>(</span><span style=color:#54b1c7>&amp;</span><span style=color:#aa89ea>f</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>running</span><span style=color:#abb2bf>,</span> <span style=color:#d19a66>1</span><span style=color:#abb2bf>)</span> <span style=color:#54b1c7>==</span> <span style=color:#d19a66>1</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>     <span style=color:#8a93a5;font-style:italic>// already running…
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>     <span style=color:#76a9f9>return</span>
</span></span><span style=display:flex><span>  <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>  <span style=color:#8a93a5;font-style:italic>// start the Foo
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>func</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>f</span> <span style=color:#54b1c7>*</span><span style=color:#aa89ea>foo</span><span style=color:#abb2bf>)</span> <span style=color:#00b1f7>isRunning</span><span style=color:#abb2bf>()</span> <span style=color:#e5c07b>bool</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>return</span> <span style=color:#aa89ea>f</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>running</span> <span style=color:#54b1c7>==</span> <span style=color:#d19a66>1</span>  <span style=color:#8a93a5;font-style:italic>// race!
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Good
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>type</span> <span style=color:#aa89ea>foo</span> <span style=color:#76a9f9>struct</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>running</span> <span style=color:#aa89ea>atomic</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>Bool</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>func</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>f</span> <span style=color:#54b1c7>*</span><span style=color:#aa89ea>foo</span><span style=color:#abb2bf>)</span> <span style=color:#00b1f7>start</span><span style=color:#abb2bf>()</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>if</span> <span style=color:#aa89ea>f</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>running</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Swap</span><span style=color:#abb2bf>(</span><span style=color:#e5c07b>true</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>     <span style=color:#8a93a5;font-style:italic>// already running…
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>     <span style=color:#76a9f9>return</span>
</span></span><span style=display:flex><span>  <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>  <span style=color:#8a93a5;font-style:italic>// start the Foo
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>func</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>f</span> <span style=color:#54b1c7>*</span><span style=color:#aa89ea>foo</span><span style=color:#abb2bf>)</span> <span style=color:#00b1f7>isRunning</span><span style=color:#abb2bf>()</span> <span style=color:#e5c07b>bool</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>return</span> <span style=color:#aa89ea>f</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>running</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Load</span><span style=color:#abb2bf>()</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=avoid-mutable-globals-避免可变全局变量>Avoid Mutable Globals 避免可变全局变量</h3><p>Avoid mutating global variables, instead opting for dependency injection. This applies to function pointers as well as other kinds of values.</p><p>​ 避免改变全局变量，而选择依赖注入。这适用于函数指针以及其他类型的值。</p><div class=highlight><div style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">49
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Bad
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// sign.go
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>var</span> <span style=color:#aa89ea>_timeNow</span> <span style=color:#abb2bf>=</span> <span style=color:#aa89ea>time</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>Now</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>func</span> <span style=color:#00b1f7>sign</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>msg</span> <span style=color:#e5c07b>string</span><span style=color:#abb2bf>)</span> <span style=color:#e5c07b>string</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>now</span> <span style=color:#54b1c7>:=</span> <span style=color:#00b1f7>_timeNow</span><span style=color:#abb2bf>()</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>return</span> <span style=color:#00b1f7>signWithTime</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>msg</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>now</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// sign_test.go
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>func</span> <span style=color:#00b1f7>TestSign</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>t</span> <span style=color:#54b1c7>*</span><span style=color:#aa89ea>testing</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>T</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>oldTimeNow</span> <span style=color:#54b1c7>:=</span> <span style=color:#aa89ea>_timeNow</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>_timeNow</span> <span style=color:#abb2bf>=</span> <span style=color:#76a9f9>func</span><span style=color:#abb2bf>()</span> <span style=color:#aa89ea>time</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>Time</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#76a9f9>return</span> <span style=color:#aa89ea>someFixedTime</span>
</span></span><span style=display:flex><span>  <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>defer</span> <span style=color:#76a9f9>func</span><span style=color:#abb2bf>()</span> <span style=color:#abb2bf>{</span> <span style=color:#aa89ea>_timeNow</span> <span style=color:#abb2bf>=</span> <span style=color:#aa89ea>oldTimeNow</span> <span style=color:#abb2bf>}()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>assert</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Equal</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>t</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>want</span><span style=color:#abb2bf>,</span> <span style=color:#00b1f7>sign</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>give</span><span style=color:#abb2bf>))</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Good
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// sign.go
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>type</span> <span style=color:#aa89ea>signer</span> <span style=color:#76a9f9>struct</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>now</span> <span style=color:#76a9f9>func</span><span style=color:#abb2bf>()</span> <span style=color:#aa89ea>time</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>Time</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>func</span> <span style=color:#00b1f7>newSigner</span><span style=color:#abb2bf>()</span> <span style=color:#54b1c7>*</span><span style=color:#aa89ea>signer</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>return</span> <span style=color:#54b1c7>&amp;</span><span style=color:#aa89ea>signer</span><span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>now</span><span style=color:#abb2bf>:</span> <span style=color:#aa89ea>time</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>Now</span><span style=color:#abb2bf>,</span>
</span></span><span style=display:flex><span>  <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>func</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>s</span> <span style=color:#54b1c7>*</span><span style=color:#aa89ea>signer</span><span style=color:#abb2bf>)</span> <span style=color:#00b1f7>Sign</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>msg</span> <span style=color:#e5c07b>string</span><span style=color:#abb2bf>)</span> <span style=color:#e5c07b>string</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>now</span> <span style=color:#54b1c7>:=</span> <span style=color:#aa89ea>s</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>now</span><span style=color:#abb2bf>()</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>return</span> <span style=color:#00b1f7>signWithTime</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>msg</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>now</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// sign_test.go
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>func</span> <span style=color:#00b1f7>TestSigner</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>t</span> <span style=color:#54b1c7>*</span><span style=color:#aa89ea>testing</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>T</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>s</span> <span style=color:#54b1c7>:=</span> <span style=color:#00b1f7>newSigner</span><span style=color:#abb2bf>()</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>s</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>now</span> <span style=color:#abb2bf>=</span> <span style=color:#76a9f9>func</span><span style=color:#abb2bf>()</span> <span style=color:#aa89ea>time</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>Time</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#76a9f9>return</span> <span style=color:#aa89ea>someFixedTime</span>
</span></span><span style=display:flex><span>  <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>assert</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Equal</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>t</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>want</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>s</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Sign</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>give</span><span style=color:#abb2bf>))</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=avoid-embedding-types-in-public-structs-避免在公共结构中嵌入类型>Avoid Embedding Types in Public Structs 避免在公共结构中嵌入类型</h3><p>These embedded types leak implementation details, inhibit type evolution, and obscure documentation.</p><p>​ 这些嵌入的类型会泄露实现细节，抑制类型演化，并模糊文档。</p><p>Assuming you have implemented a variety of list types using a shared <code>AbstractList</code>, avoid embedding the <code>AbstractList</code> in your concrete list implementations. Instead, hand-write only the methods to your concrete list that will delegate to the abstract list.</p><p>​ 假设您使用共享的 <code>AbstractList</code> 实现各种列表类型，请避免在具体列表实现中嵌入 <code>AbstractList</code> 。相反，只手写将委托给抽象列表的具体列表的方法。</p><div class=highlight><div style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">31
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#76a9f9>type</span> <span style=color:#aa89ea>AbstractList</span> <span style=color:#76a9f9>struct</span> <span style=color:#abb2bf>{}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Add adds an entity to the list.
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>func</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>l</span> <span style=color:#54b1c7>*</span><span style=color:#aa89ea>AbstractList</span><span style=color:#abb2bf>)</span> <span style=color:#00b1f7>Add</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>e</span> <span style=color:#aa89ea>Entity</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#8a93a5;font-style:italic>// ...
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Remove removes an entity from the list.
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>func</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>l</span> <span style=color:#54b1c7>*</span><span style=color:#aa89ea>AbstractList</span><span style=color:#abb2bf>)</span> <span style=color:#00b1f7>Remove</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>e</span> <span style=color:#aa89ea>Entity</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#8a93a5;font-style:italic>// ...
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Bad
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// ConcreteList is a list of entities.
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>type</span> <span style=color:#aa89ea>ConcreteList</span> <span style=color:#76a9f9>struct</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#54b1c7>*</span><span style=color:#aa89ea>AbstractList</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Good
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// ConcreteList is a list of entities.
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>type</span> <span style=color:#aa89ea>ConcreteList</span> <span style=color:#76a9f9>struct</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>list</span> <span style=color:#54b1c7>*</span><span style=color:#aa89ea>AbstractList</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Add adds an entity to the list.
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>func</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>l</span> <span style=color:#54b1c7>*</span><span style=color:#aa89ea>ConcreteList</span><span style=color:#abb2bf>)</span> <span style=color:#00b1f7>Add</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>e</span> <span style=color:#aa89ea>Entity</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>l</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>list</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Add</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>e</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Remove removes an entity from the list.
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>func</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>l</span> <span style=color:#54b1c7>*</span><span style=color:#aa89ea>ConcreteList</span><span style=color:#abb2bf>)</span> <span style=color:#00b1f7>Remove</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>e</span> <span style=color:#aa89ea>Entity</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>l</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>list</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Remove</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>e</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span></code></pre></td></tr></table></div></div><p>Go allows <a href=https://golang.org/doc/effective_go.html#embedding>type embedding</a> as a compromise between inheritance and composition. The outer type gets implicit copies of the embedded type’s methods. These methods, by default, delegate to the same method of the embedded instance.</p><p>​ Go 允许类型嵌入作为继承和组合之间的折衷方案。外部类型会隐式获取嵌入类型方法的副本。默认情况下，这些方法委托给嵌入实例的相同方法。</p><p>The struct also gains a field by the same name as the type. So, if the embedded type is public, the field is public. To maintain backward compatibility, every future version of the outer type must keep the embedded type.</p><p>​ 该结构还获得一个与类型同名的字段。因此，如果嵌入类型是公共的，则该字段是公共的。为了保持向后兼容性，外部类型的每个未来版本都必须保留嵌入类型。</p><p>An embedded type is rarely necessary. It is a convenience that helps you avoid writing tedious delegate methods.</p><p>​ 嵌入类型很少有必要。这是一种帮助您避免编写繁琐的委托方法的便利。</p><p>Even embedding a compatible AbstractList <em>interface</em>, instead of the struct, would offer the developer more flexibility to change in the future, but still leak the detail that the concrete lists use an abstract implementation.</p><p>​ 即使嵌入兼容的 AbstractList 接口（而不是结构体），也会为开发人员提供更大的灵活性以在将来进行更改，但仍然会泄露具体列表使用抽象实现的细节。</p><div class=highlight><div style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">27
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Bad
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// AbstractList is a generalized implementation
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// for various kinds of lists of entities.
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>type</span> <span style=color:#aa89ea>AbstractList</span> <span style=color:#76a9f9>interface</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#00b1f7>Add</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>Entity</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>  <span style=color:#00b1f7>Remove</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>Entity</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// ConcreteList is a list of entities.
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>type</span> <span style=color:#aa89ea>ConcreteList</span> <span style=color:#76a9f9>struct</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>AbstractList</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Good
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// ConcreteList is a list of entities.
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>type</span> <span style=color:#aa89ea>ConcreteList</span> <span style=color:#76a9f9>struct</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>list</span> <span style=color:#aa89ea>AbstractList</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Add adds an entity to the list.
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>func</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>l</span> <span style=color:#54b1c7>*</span><span style=color:#aa89ea>ConcreteList</span><span style=color:#abb2bf>)</span> <span style=color:#00b1f7>Add</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>e</span> <span style=color:#aa89ea>Entity</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>l</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>list</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Add</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>e</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Remove removes an entity from the list.
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>func</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>l</span> <span style=color:#54b1c7>*</span><span style=color:#aa89ea>ConcreteList</span><span style=color:#abb2bf>)</span> <span style=color:#00b1f7>Remove</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>e</span> <span style=color:#aa89ea>Entity</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>l</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>list</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Remove</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>e</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span></code></pre></td></tr></table></div></div><p>Either with an embedded struct or an embedded interface, the embedded type places limits on the evolution of the type.</p><p>​ 无论使用嵌入式结构体还是嵌入式接口，嵌入式类型都会限制类型的演变。</p><ul><li>Adding methods to an embedded interface is a breaking change.
向嵌入式接口添加方法是一种重大更改。</li><li>Removing methods from an embedded struct is a breaking change.
从嵌入式结构体中删除方法是一种重大更改。</li><li>Removing the embedded type is a breaking change.
删除嵌入式类型是一种重大更改。</li><li>Replacing the embedded type, even with an alternative that satisfies the same interface, is a breaking change.
替换嵌入式类型（即使使用满足相同接口的替代类型）也是一种重大更改。</li></ul><p>Although writing these delegate methods is tedious, the additional effort hides an implementation detail, leaves more opportunities for change, and also eliminates indirection for discovering the full List interface in documentation.</p><p>​ 尽管编写这些委托方法很繁琐，但额外的努力隐藏了实现细节，留出了更多更改机会，还消除了在文档中发现完整 List 接口的间接性。</p><h3 id=avoid-using-built-in-names-避免使用内置名称>Avoid Using Built-In Names 避免使用内置名称</h3><p>The Go <a href=https://golang.org/ref/spec>language specification</a> outlines several built-in, <a href=https://golang.org/ref/spec#Predeclared_identifiers>predeclared identifiers</a> that should not be used as names within Go programs.</p><p>​ Go 语言规范概述了几个内置的、预声明的标识符，这些标识符不应在 Go 程序中用作名称。</p><p>Depending on context, reusing these identifiers as names will either shadow the original within the current lexical scope (and any nested scopes) or make affected code confusing. In the best case, the compiler will complain; in the worst case, such code may introduce latent, hard-to-grep bugs.</p><p>​ 根据上下文，将这些标识符重新用作名称，要么在当前词法作用域（和任何嵌套作用域）内隐藏原始标识符，要么使受影响的代码令人困惑。在最好的情况下，编译器会发出警告；在最坏的情况下，此类代码可能会引入潜在的、难以 grep 的错误。</p><div class=highlight><div style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">58
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Bad
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>var</span> <span style=color:#e5c07b>error</span> <span style=color:#e5c07b>string</span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// `error` shadows the builtin
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// or
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>func</span> <span style=color:#00b1f7>handleErrorMessage</span><span style=color:#abb2bf>(</span><span style=color:#e5c07b>error</span> <span style=color:#e5c07b>string</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#8a93a5;font-style:italic>// `error` shadows the builtin
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>type</span> <span style=color:#aa89ea>Foo</span> <span style=color:#76a9f9>struct</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#8a93a5;font-style:italic>// While these fields technically don&#39;t
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>    <span style=color:#8a93a5;font-style:italic>// constitute shadowing, grepping for
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>    <span style=color:#8a93a5;font-style:italic>// `error` or `string` strings is now
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>    <span style=color:#8a93a5;font-style:italic>// ambiguous.
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>    <span style=color:#e5c07b>error</span>  <span style=color:#e5c07b>error</span>
</span></span><span style=display:flex><span>    <span style=color:#e5c07b>string</span> <span style=color:#e5c07b>string</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>func</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>f</span> <span style=color:#aa89ea>Foo</span><span style=color:#abb2bf>)</span> <span style=color:#00b1f7>Error</span><span style=color:#abb2bf>()</span> <span style=color:#e5c07b>error</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#8a93a5;font-style:italic>// `error` and `f.error` are
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>    <span style=color:#8a93a5;font-style:italic>// visually similar
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>    <span style=color:#76a9f9>return</span> <span style=color:#aa89ea>f</span><span style=color:#abb2bf>.</span><span style=color:#e5c07b>error</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>func</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>f</span> <span style=color:#aa89ea>Foo</span><span style=color:#abb2bf>)</span> <span style=color:#00b1f7>String</span><span style=color:#abb2bf>()</span> <span style=color:#e5c07b>string</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#8a93a5;font-style:italic>// `string` and `f.string` are
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>    <span style=color:#8a93a5;font-style:italic>// visually similar
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>    <span style=color:#76a9f9>return</span> <span style=color:#aa89ea>f</span><span style=color:#abb2bf>.</span><span style=color:#e5c07b>string</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Good
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>var</span> <span style=color:#aa89ea>errorMessage</span> <span style=color:#e5c07b>string</span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// `error` refers to the builtin
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// or
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>func</span> <span style=color:#00b1f7>handleErrorMessage</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>msg</span> <span style=color:#e5c07b>string</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#8a93a5;font-style:italic>// `error` refers to the builtin
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>type</span> <span style=color:#aa89ea>Foo</span> <span style=color:#76a9f9>struct</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#8a93a5;font-style:italic>// `error` and `string` strings are
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>    <span style=color:#8a93a5;font-style:italic>// now unambiguous.
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>    <span style=color:#aa89ea>err</span> <span style=color:#e5c07b>error</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>str</span> <span style=color:#e5c07b>string</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>func</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>f</span> <span style=color:#aa89ea>Foo</span><span style=color:#abb2bf>)</span> <span style=color:#00b1f7>Error</span><span style=color:#abb2bf>()</span> <span style=color:#e5c07b>error</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#76a9f9>return</span> <span style=color:#aa89ea>f</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>err</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>func</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>f</span> <span style=color:#aa89ea>Foo</span><span style=color:#abb2bf>)</span> <span style=color:#00b1f7>String</span><span style=color:#abb2bf>()</span> <span style=color:#e5c07b>string</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#76a9f9>return</span> <span style=color:#aa89ea>f</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>str</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span></code></pre></td></tr></table></div></div><p>Note that the compiler will not generate errors when using predeclared identifiers, but tools such as <code>go vet</code> should correctly point out these and other cases of shadowing.</p><p>​ 请注意，在使用预声明标识符时，编译器不会生成错误，但诸如 <code>go vet</code> 之类的工具应正确指出这些和其他隐藏情况。</p><h3 id=avoid-init-避免-init>Avoid <code>init()</code> 避免 <code>init()</code></h3><p>Avoid <code>init()</code> where possible. When <code>init()</code> is unavoidable or desirable, code should attempt to:</p><p>​ 尽可能避免 <code>init()</code> 。当 <code>init()</code> 不可避免或合乎需要时，代码应尝试：</p><ol><li>Be completely deterministic, regardless of program environment or invocation.
完全确定性，无论程序环境或调用如何。</li><li>Avoid depending on the ordering or side-effects of other <code>init()</code> functions. While <code>init()</code> ordering is well-known, code can change, and thus relationships between <code>init()</code> functions can make code brittle and error-prone.
避免依赖其他 <code>init()</code> 函数的顺序或副作用。虽然 <code>init()</code> 顺序是众所周知的，但代码可能会发生变化，因此 <code>init()</code> 函数之间的关系可能会使代码变得脆弱且容易出错。</li><li>Avoid accessing or manipulating global or environment state, such as machine information, environment variables, working directory, program arguments/inputs, etc.
避免访问或操作全局或环境状态，例如机器信息、环境变量、工作目录、程序参数/输入等。</li><li>Avoid I/O, including both filesystem, network, and system calls.
避免 I/O，包括文件系统、网络和系统调用。</li></ol><p>Code that cannot satisfy these requirements likely belongs as a helper to be called as part of <code>main()</code> (or elsewhere in a program’s lifecycle), or be written as part of <code>main()</code> itself. In particular, libraries that are intended to be used by other programs should take special care to be completely deterministic and not perform “init magic”.</p><p>​ 无法满足这些要求的代码可能属于作为 <code>main()</code> （或程序生命周期中的其他位置）的一部分被调用的帮助程序，或者作为 <code>main()</code> 本身的一部分编写。特别是，旨在供其他程序使用的库应特别注意完全确定性，并且不执行“init magic”。</p><div class=highlight><div style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">66
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Bad
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>type</span> <span style=color:#aa89ea>Foo</span> <span style=color:#76a9f9>struct</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#8a93a5;font-style:italic>// ...
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>var</span> <span style=color:#aa89ea>_defaultFoo</span> <span style=color:#aa89ea>Foo</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>func</span> <span style=color:#00b1f7>init</span><span style=color:#abb2bf>()</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>_defaultFoo</span> <span style=color:#abb2bf>=</span> <span style=color:#aa89ea>Foo</span><span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>        <span style=color:#8a93a5;font-style:italic>// ...
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>    <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>type</span> <span style=color:#aa89ea>Config</span> <span style=color:#76a9f9>struct</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#8a93a5;font-style:italic>// ...
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>var</span> <span style=color:#aa89ea>_config</span> <span style=color:#aa89ea>Config</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>func</span> <span style=color:#00b1f7>init</span><span style=color:#abb2bf>()</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#8a93a5;font-style:italic>// Bad: based on current directory
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>    <span style=color:#aa89ea>cwd</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>_</span> <span style=color:#54b1c7>:=</span> <span style=color:#aa89ea>os</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Getwd</span><span style=color:#abb2bf>()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8a93a5;font-style:italic>// Bad: I/O
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>    <span style=color:#aa89ea>raw</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>_</span> <span style=color:#54b1c7>:=</span> <span style=color:#aa89ea>os</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>ReadFile</span><span style=color:#abb2bf>(</span>
</span></span><span style=display:flex><span>        <span style=color:#aa89ea>path</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Join</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>cwd</span><span style=color:#abb2bf>,</span> <span style=color:#98c379>&#34;config&#34;</span><span style=color:#abb2bf>,</span> <span style=color:#98c379>&#34;config.yaml&#34;</span><span style=color:#abb2bf>),</span>
</span></span><span style=display:flex><span>    <span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>yaml</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Unmarshal</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>raw</span><span style=color:#abb2bf>,</span> <span style=color:#54b1c7>&amp;</span><span style=color:#aa89ea>_config</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Good
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>var</span> <span style=color:#aa89ea>_defaultFoo</span> <span style=color:#abb2bf>=</span> <span style=color:#aa89ea>Foo</span><span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#8a93a5;font-style:italic>// ...
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// or, better, for testability:
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>var</span> <span style=color:#aa89ea>_defaultFoo</span> <span style=color:#abb2bf>=</span> <span style=color:#00b1f7>defaultFoo</span><span style=color:#abb2bf>()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>func</span> <span style=color:#00b1f7>defaultFoo</span><span style=color:#abb2bf>()</span> <span style=color:#aa89ea>Foo</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#76a9f9>return</span> <span style=color:#aa89ea>Foo</span><span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>        <span style=color:#8a93a5;font-style:italic>// ...
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>    <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>type</span> <span style=color:#aa89ea>Config</span> <span style=color:#76a9f9>struct</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#8a93a5;font-style:italic>// ...
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>func</span> <span style=color:#00b1f7>loadConfig</span><span style=color:#abb2bf>()</span> <span style=color:#aa89ea>Config</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>cwd</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>err</span> <span style=color:#54b1c7>:=</span> <span style=color:#aa89ea>os</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Getwd</span><span style=color:#abb2bf>()</span>
</span></span><span style=display:flex><span>    <span style=color:#8a93a5;font-style:italic>// handle err
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>raw</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>err</span> <span style=color:#54b1c7>:=</span> <span style=color:#aa89ea>os</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>ReadFile</span><span style=color:#abb2bf>(</span>
</span></span><span style=display:flex><span>        <span style=color:#aa89ea>path</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Join</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>cwd</span><span style=color:#abb2bf>,</span> <span style=color:#98c379>&#34;config&#34;</span><span style=color:#abb2bf>,</span> <span style=color:#98c379>&#34;config.yaml&#34;</span><span style=color:#abb2bf>),</span>
</span></span><span style=display:flex><span>    <span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>    <span style=color:#8a93a5;font-style:italic>// handle err
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>
</span></span><span style=display:flex><span>    <span style=color:#76a9f9>var</span> <span style=color:#aa89ea>config</span> <span style=color:#aa89ea>Config</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>yaml</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Unmarshal</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>raw</span><span style=color:#abb2bf>,</span> <span style=color:#54b1c7>&amp;</span><span style=color:#aa89ea>config</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#76a9f9>return</span> <span style=color:#aa89ea>config</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span></code></pre></td></tr></table></div></div><p>Considering the above, some situations in which <code>init()</code> may be preferable or necessary might include:</p><p>​ 考虑到上述情况，可能更可取或必要使用 <code>init()</code> 的一些情况可能包括：</p><ul><li>Complex expressions that cannot be represented as single assignments.
无法表示为单个赋值的复杂表达式。</li><li>Pluggable hooks, such as <code>database/sql</code> dialects, encoding type registries, etc.
可插入的挂钩，例如 <code>database/sql</code> 方言、编码类型注册表等。</li><li>Optimizations to <a href=https://cloud.google.com/functions/docs/bestpractices/tips#use_global_variables_to_reuse_objects_in_future_invocations>Google Cloud Functions</a> and other forms of deterministic precomputation.
对 Google Cloud Functions 和其他形式的确定性预计算的优化。</li></ul><h3 id=exit-in-main-在-main-中退出>Exit in Main 在 Main 中退出</h3><p>Go programs use <a href=https://golang.org/pkg/os/#Exit><code>os.Exit</code></a> or <a href=https://golang.org/pkg/log/#Fatal><code>log.Fatal*</code></a> to exit immediately. (Panicking is not a good way to exit programs, please <a href=https://github.com/uber-go/guide/blob/master/style.md#dont-panic>don’t panic</a>.)</p><p>​ Go 程序使用 <code>os.Exit</code> 或 <code>log.Fatal*</code> 立即退出。（引发恐慌不是退出程序的好方法，请不要惊慌。）</p><p>Call one of <code>os.Exit</code> or <code>log.Fatal*</code> <strong>only in <code>main()</code></strong>. All other functions should return errors to signal failure.</p><p>​ 仅在 <code>main()</code> 中调用 <code>os.Exit</code> 或 <code>log.Fatal*</code> 之一。所有其他函数都应返回错误以发出失败信号。</p><div class=highlight><div style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">41
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Bad
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>func</span> <span style=color:#00b1f7>main</span><span style=color:#abb2bf>()</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>body</span> <span style=color:#54b1c7>:=</span> <span style=color:#00b1f7>readFile</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>path</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>fmt</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Println</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>body</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>func</span> <span style=color:#00b1f7>readFile</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>path</span> <span style=color:#e5c07b>string</span><span style=color:#abb2bf>)</span> <span style=color:#e5c07b>string</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>f</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>err</span> <span style=color:#54b1c7>:=</span> <span style=color:#aa89ea>os</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Open</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>path</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>if</span> <span style=color:#aa89ea>err</span> <span style=color:#54b1c7>!=</span> <span style=color:#e5c07b>nil</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>log</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Fatal</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>err</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>  <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>b</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>err</span> <span style=color:#54b1c7>:=</span> <span style=color:#aa89ea>io</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>ReadAll</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>f</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>if</span> <span style=color:#aa89ea>err</span> <span style=color:#54b1c7>!=</span> <span style=color:#e5c07b>nil</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>log</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Fatal</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>err</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>  <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>return</span> <span style=color:#e5c07b>string</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>b</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Good
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>func</span> <span style=color:#00b1f7>main</span><span style=color:#abb2bf>()</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>body</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>err</span> <span style=color:#54b1c7>:=</span> <span style=color:#00b1f7>readFile</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>path</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>if</span> <span style=color:#aa89ea>err</span> <span style=color:#54b1c7>!=</span> <span style=color:#e5c07b>nil</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>log</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Fatal</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>err</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>  <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>fmt</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Println</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>body</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>func</span> <span style=color:#00b1f7>readFile</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>path</span> <span style=color:#e5c07b>string</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>(</span><span style=color:#e5c07b>string</span><span style=color:#abb2bf>,</span> <span style=color:#e5c07b>error</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>f</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>err</span> <span style=color:#54b1c7>:=</span> <span style=color:#aa89ea>os</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Open</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>path</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>if</span> <span style=color:#aa89ea>err</span> <span style=color:#54b1c7>!=</span> <span style=color:#e5c07b>nil</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#76a9f9>return</span> <span style=color:#98c379>&#34;&#34;</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>err</span>
</span></span><span style=display:flex><span>  <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>b</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>err</span> <span style=color:#54b1c7>:=</span> <span style=color:#aa89ea>io</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>ReadAll</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>f</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>if</span> <span style=color:#aa89ea>err</span> <span style=color:#54b1c7>!=</span> <span style=color:#e5c07b>nil</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#76a9f9>return</span> <span style=color:#98c379>&#34;&#34;</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>err</span>
</span></span><span style=display:flex><span>  <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>return</span> <span style=color:#e5c07b>string</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>b</span><span style=color:#abb2bf>),</span> <span style=color:#e5c07b>nil</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span></code></pre></td></tr></table></div></div><p>Rationale: Programs with multiple functions that exit present a few issues:</p><p>​ 基本原理：具有多个退出函数的程序会带来一些问题：</p><ul><li>Non-obvious control flow: Any function can exit the program so it becomes difficult to reason about the control flow.
不明显的控制流：任何函数都可以退出程序，因此很难推理控制流。</li><li>Difficult to test: A function that exits the program will also exit the test calling it. This makes the function difficult to test and introduces risk of skipping other tests that have not yet been run by <code>go test</code>.
难以测试：退出程序的函数也会退出调用它的测试。这使得函数难以测试，并引入跳过尚未由 <code>go test</code> 运行的其他测试的风险。</li><li>Skipped cleanup: When a function exits the program, it skips function calls enqueued with <code>defer</code> statements. This adds risk of skipping important cleanup tasks.
跳过的清理：当函数退出程序时，它会跳过使用 <code>defer</code> 语句排队的函数调用。这会增加跳过重要清理任务的风险。</li></ul><h4 id=exit-once-退出一次>Exit Once 退出一次</h4><p>If possible, prefer to call <code>os.Exit</code> or <code>log.Fatal</code> <strong>at most once</strong> in your <code>main()</code>. If there are multiple error scenarios that halt program execution, put that logic under a separate function and return errors from it.</p><p>​ 如果可能，最好在 <code>main()</code> 中最多调用 <code>os.Exit</code> 或 <code>log.Fatal</code> 一次。如果有多个导致程序执行停止的错误场景，请将该逻辑放在单独的函数中，并从中返回错误。</p><p>This has the effect of shortening your <code>main()</code> function and putting all key business logic into a separate, testable function.</p><p>​ 这会缩短 <code>main()</code> 函数，并将所有关键业务逻辑放入单独的可测试函数中。</p><div class=highlight><div style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">55
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Bad
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>package</span> <span style=color:#aa89ea>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>func</span> <span style=color:#00b1f7>main</span><span style=color:#abb2bf>()</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>args</span> <span style=color:#54b1c7>:=</span> <span style=color:#aa89ea>os</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>Args</span><span style=color:#abb2bf>[</span><span style=color:#d19a66>1</span><span style=color:#abb2bf>:]</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>if</span> <span style=color:#e5c07b>len</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>args</span><span style=color:#abb2bf>)</span> <span style=color:#54b1c7>!=</span> <span style=color:#d19a66>1</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>log</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Fatal</span><span style=color:#abb2bf>(</span><span style=color:#98c379>&#34;missing file&#34;</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>  <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>name</span> <span style=color:#54b1c7>:=</span> <span style=color:#aa89ea>args</span><span style=color:#abb2bf>[</span><span style=color:#d19a66>0</span><span style=color:#abb2bf>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>f</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>err</span> <span style=color:#54b1c7>:=</span> <span style=color:#aa89ea>os</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Open</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>name</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>if</span> <span style=color:#aa89ea>err</span> <span style=color:#54b1c7>!=</span> <span style=color:#e5c07b>nil</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>log</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Fatal</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>err</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>  <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>defer</span> <span style=color:#aa89ea>f</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Close</span><span style=color:#abb2bf>()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8a93a5;font-style:italic>// If we call log.Fatal after this line,
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>  <span style=color:#8a93a5;font-style:italic>// f.Close will not be called.
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>b</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>err</span> <span style=color:#54b1c7>:=</span> <span style=color:#aa89ea>io</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>ReadAll</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>f</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>if</span> <span style=color:#aa89ea>err</span> <span style=color:#54b1c7>!=</span> <span style=color:#e5c07b>nil</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>log</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Fatal</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>err</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>  <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8a93a5;font-style:italic>// ...
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Good
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>package</span> <span style=color:#aa89ea>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>func</span> <span style=color:#00b1f7>main</span><span style=color:#abb2bf>()</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>if</span> <span style=color:#aa89ea>err</span> <span style=color:#54b1c7>:=</span> <span style=color:#00b1f7>run</span><span style=color:#abb2bf>();</span> <span style=color:#aa89ea>err</span> <span style=color:#54b1c7>!=</span> <span style=color:#e5c07b>nil</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>log</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Fatal</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>err</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>  <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>func</span> <span style=color:#00b1f7>run</span><span style=color:#abb2bf>()</span> <span style=color:#e5c07b>error</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>args</span> <span style=color:#54b1c7>:=</span> <span style=color:#aa89ea>os</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>Args</span><span style=color:#abb2bf>[</span><span style=color:#d19a66>1</span><span style=color:#abb2bf>:]</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>if</span> <span style=color:#e5c07b>len</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>args</span><span style=color:#abb2bf>)</span> <span style=color:#54b1c7>!=</span> <span style=color:#d19a66>1</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#76a9f9>return</span> <span style=color:#aa89ea>errors</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>New</span><span style=color:#abb2bf>(</span><span style=color:#98c379>&#34;missing file&#34;</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>  <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>name</span> <span style=color:#54b1c7>:=</span> <span style=color:#aa89ea>args</span><span style=color:#abb2bf>[</span><span style=color:#d19a66>0</span><span style=color:#abb2bf>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>f</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>err</span> <span style=color:#54b1c7>:=</span> <span style=color:#aa89ea>os</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Open</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>name</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>if</span> <span style=color:#aa89ea>err</span> <span style=color:#54b1c7>!=</span> <span style=color:#e5c07b>nil</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#76a9f9>return</span> <span style=color:#aa89ea>err</span>
</span></span><span style=display:flex><span>  <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>defer</span> <span style=color:#aa89ea>f</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Close</span><span style=color:#abb2bf>()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>b</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>err</span> <span style=color:#54b1c7>:=</span> <span style=color:#aa89ea>io</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>ReadAll</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>f</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>if</span> <span style=color:#aa89ea>err</span> <span style=color:#54b1c7>!=</span> <span style=color:#e5c07b>nil</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#76a9f9>return</span> <span style=color:#aa89ea>err</span>
</span></span><span style=display:flex><span>  <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8a93a5;font-style:italic>// ...
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#abb2bf>}</span>
</span></span></code></pre></td></tr></table></div></div><p>The example above uses <code>log.Fatal</code>, but the guidance also applies to <code>os.Exit</code> or any library code that calls <code>os.Exit</code>.</p><p>​ 上面的示例使用 <code>log.Fatal</code> ，但该指南也适用于 <code>os.Exit</code> 或任何调用 <code>os.Exit</code> 的库代码。</p><div class=highlight><div style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">6
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#76a9f9>func</span> <span style=color:#00b1f7>main</span><span style=color:#abb2bf>()</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>if</span> <span style=color:#aa89ea>err</span> <span style=color:#54b1c7>:=</span> <span style=color:#00b1f7>run</span><span style=color:#abb2bf>();</span> <span style=color:#aa89ea>err</span> <span style=color:#54b1c7>!=</span> <span style=color:#e5c07b>nil</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>fmt</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Fprintln</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>os</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>Stderr</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>err</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>os</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Exit</span><span style=color:#abb2bf>(</span><span style=color:#d19a66>1</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>  <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span></code></pre></td></tr></table></div></div><p>You may alter the signature of <code>run()</code> to fit your needs. For example, if your program must exit with specific exit codes for failures, <code>run()</code> may return the exit code instead of an error. This allows unit tests to verify this behavior directly as well.</p><p>​ 您可以更改 <code>run()</code> 的签名以满足您的需求。例如，如果您的程序必须使用特定的退出代码退出以表示失败，则 <code>run()</code> 可以返回退出代码而不是错误。这也允许单元测试直接验证此行为。</p><div class=highlight><div style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#76a9f9>func</span> <span style=color:#00b1f7>main</span><span style=color:#abb2bf>()</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>os</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Exit</span><span style=color:#abb2bf>(</span><span style=color:#00b1f7>run</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>args</span><span style=color:#abb2bf>))</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>func</span> <span style=color:#00b1f7>run</span><span style=color:#abb2bf>()</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>exitCode</span> <span style=color:#e5c07b>int</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#8a93a5;font-style:italic>// ...
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#abb2bf>}</span>
</span></span></code></pre></td></tr></table></div></div><p>More generally, note that the <code>run()</code> function used in these examples is not intended to be prescriptive. There’s flexibility in the name, signature, and setup of the <code>run()</code> function. Among other things, you may:</p><p>​ 更一般地说，请注意，这些示例中使用的 <code>run()</code> 函数并非旨在具有规定性。在 <code>run()</code> 函数的名称、签名和设置中存在灵活性。除其他事项外，您可能：</p><ul><li>accept unparsed command line arguments (e.g., <code>run(os.Args[1:])</code>)
接受未解析的命令行参数（例如， <code>run(os.Args[1:])</code> ）</li><li>parse command line arguments in <code>main()</code> and pass them onto <code>run</code>
在 <code>main()</code> 中解析命令行参数并将其传递给 <code>run</code></li><li>use a custom error type to carry the exit code back to <code>main()</code>
使用自定义错误类型将退出代码传回 <code>main()</code></li><li>put business logic in a different layer of abstraction from <code>package main</code>
将业务逻辑放在与 <code>package main</code> 不同的抽象层中</li></ul><p>This guidance only requires that there’s a single place in your <code>main()</code> responsible for actually exiting the process.</p><p>​ 此指南仅要求在您的 <code>main()</code> 中有一个负责实际退出进程的位置。</p><h3 id=use-field-tags-in-marshaled-structs-在编组结构中使用字段标记>Use field tags in marshaled structs 在编组结构中使用字段标记</h3><p>Any struct field that is marshaled into JSON, YAML, or other formats that support tag-based field naming should be annotated with the relevant tag.</p><p>​ 任何编组到 JSON、YAML 或其他支持基于标记的字段命名的格式的结构字段都应使用相关标记进行注释。</p><div class=highlight><div style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">21
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Bad
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>type</span> <span style=color:#aa89ea>Stock</span> <span style=color:#76a9f9>struct</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>Price</span> <span style=color:#e5c07b>int</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>Name</span>  <span style=color:#e5c07b>string</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>bytes</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>err</span> <span style=color:#54b1c7>:=</span> <span style=color:#aa89ea>json</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Marshal</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>Stock</span><span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>Price</span><span style=color:#abb2bf>:</span> <span style=color:#d19a66>137</span><span style=color:#abb2bf>,</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>Name</span><span style=color:#abb2bf>:</span>  <span style=color:#98c379>&#34;UBER&#34;</span><span style=color:#abb2bf>,</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>})</span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Good
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>type</span> <span style=color:#aa89ea>Stock</span> <span style=color:#76a9f9>struct</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>Price</span> <span style=color:#e5c07b>int</span>    <span style=color:#98c379>`json:&#34;price&#34;`</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>Name</span>  <span style=color:#e5c07b>string</span> <span style=color:#98c379>`json:&#34;name&#34;`</span>
</span></span><span style=display:flex><span>  <span style=color:#8a93a5;font-style:italic>// Safe to rename Name to Symbol.
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>bytes</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>err</span> <span style=color:#54b1c7>:=</span> <span style=color:#aa89ea>json</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Marshal</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>Stock</span><span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>Price</span><span style=color:#abb2bf>:</span> <span style=color:#d19a66>137</span><span style=color:#abb2bf>,</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>Name</span><span style=color:#abb2bf>:</span>  <span style=color:#98c379>&#34;UBER&#34;</span><span style=color:#abb2bf>,</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>})</span>
</span></span></code></pre></td></tr></table></div></div><p>Rationale: The serialized form of the structure is a contract between different systems. Changes to the structure of the serialized form–including field names–break this contract. Specifying field names inside tags makes the contract explicit, and it guards against accidentally breaking the contract by refactoring or renaming fields.</p><p>​ 基本原理：结构的序列化形式是不同系统之间的契约。对序列化形式的结构（包括字段名称）进行更改会破坏此契约。在标记内指定字段名称使契约显式化，并且它可以防止通过重构或重命名字段来意外破坏契约。</p><h3 id=dont-fire-and-forget-goroutines-不要使用即用即弃的-goroutine>Don’t fire-and-forget goroutines 不要使用即用即弃的 goroutine</h3><p>Goroutines are lightweight, but they’re not free: at minimum, they cost memory for their stack and CPU to be scheduled. While these costs are small for typical uses of goroutines, they can cause significant performance issues when spawned in large numbers without controlled lifetimes. Goroutines with unmanaged lifetimes can also cause other issues like preventing unused objects from being garbage collected and holding onto resources that are otherwise no longer used.</p><p>​ Goroutine 很轻量，但它们不是免费的：至少，它们需要内存来存储它们的堆栈和 CPU 来进行调度。虽然对于 Goroutine 的典型用途来说这些成本很小，但当大量生成 Goroutine 且没有受控的生命周期时，它们可能会导致严重的性能问题。具有不受管理的生命周期的 Goroutine 还会导致其他问题，例如阻止未使用的对象被垃圾回收，以及持有不再使用的资源。</p><p>Therefore, do not leak goroutines in production code. Use <a href=https://pkg.go.dev/go.uber.org/goleak>go.uber.org/goleak</a> to test for goroutine leaks inside packages that may spawn goroutines.</p><p>​ 因此，不要在生产代码中泄漏 Goroutine。使用 go.uber.org/goleak 来测试可能生成 Goroutine 的包中的 Goroutine 泄漏。</p><p>In general, every goroutine:</p><p>​ 通常，每个 Goroutine：</p><ul><li>must have a predictable time at which it will stop running; or
必须具有可预测的停止运行时间；或者</li><li>there must be a way to signal to the goroutine that it should stop
必须有一种方法向 Goroutine 发出信号，指示它应该停止</li></ul><p>In both cases, there must be a way code to block and wait for the goroutine to finish.</p><p>​ 在这两种情况下，都必须有一种方法来阻塞代码并等待 Goroutine 完成。</p><p>For example:</p><p>​ 例如：</p><div class=highlight><div style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Bad
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>go</span> <span style=color:#76a9f9>func</span><span style=color:#abb2bf>()</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>for</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#00b1f7>flush</span><span style=color:#abb2bf>()</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>time</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Sleep</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>delay</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>  <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}()</span>
</span></span></code></pre></td></tr></table></div></div><p>There’s no way to stop this goroutine. This will run until the application exits.</p><p>​ 没有办法停止此 Goroutine。这将一直运行，直到应用程序退出。</p><div class=highlight><div style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">23
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Good
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>var</span> <span style=color:#abb2bf>(</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>stop</span> <span style=color:#abb2bf>=</span> <span style=color:#e5c07b>make</span><span style=color:#abb2bf>(</span><span style=color:#76a9f9>chan</span> <span style=color:#76a9f9>struct</span><span style=color:#abb2bf>{})</span> <span style=color:#8a93a5;font-style:italic>// tells the goroutine to stop
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>  <span style=color:#aa89ea>done</span> <span style=color:#abb2bf>=</span> <span style=color:#e5c07b>make</span><span style=color:#abb2bf>(</span><span style=color:#76a9f9>chan</span> <span style=color:#76a9f9>struct</span><span style=color:#abb2bf>{})</span> <span style=color:#8a93a5;font-style:italic>// tells us that the goroutine exited
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>go</span> <span style=color:#76a9f9>func</span><span style=color:#abb2bf>()</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>defer</span> <span style=color:#e5c07b>close</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>done</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>ticker</span> <span style=color:#54b1c7>:=</span> <span style=color:#aa89ea>time</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>NewTicker</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>delay</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>defer</span> <span style=color:#aa89ea>ticker</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Stop</span><span style=color:#abb2bf>()</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>for</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#76a9f9>select</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#76a9f9>case</span> <span style=color:#54b1c7>&lt;-</span><span style=color:#aa89ea>ticker</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>C</span><span style=color:#abb2bf>:</span>
</span></span><span style=display:flex><span>      <span style=color:#00b1f7>flush</span><span style=color:#abb2bf>()</span>
</span></span><span style=display:flex><span>    <span style=color:#76a9f9>case</span> <span style=color:#54b1c7>&lt;-</span><span style=color:#aa89ea>stop</span><span style=color:#abb2bf>:</span>
</span></span><span style=display:flex><span>      <span style=color:#76a9f9>return</span>
</span></span><span style=display:flex><span>    <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>  <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Elsewhere...
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#e5c07b>close</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>stop</span><span style=color:#abb2bf>)</span>  <span style=color:#8a93a5;font-style:italic>// signal the goroutine to stop
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#54b1c7>&lt;-</span><span style=color:#aa89ea>done</span>       <span style=color:#8a93a5;font-style:italic>// and wait for it to exit
</span></span></span></code></pre></td></tr></table></div></div><p>This goroutine can be stopped with close(stop), and we can wait for it to exit with &lt;-done.</p><p>​ 可以使用 close(stop) 停止此 Goroutine，我们可以使用 &lt;-done 等待它退出。</p><h4 id=wait-for-goroutines-to-exit-等待-goroutine-退出>Wait for goroutines to exit 等待 Goroutine 退出</h4><p>Given a goroutine spawned by the system, there must be a way to wait for the goroutine to exit. There are two popular ways to do this:</p><p>​ 如果系统生成一个协程，那么肯定有办法等待协程退出。有两种流行的方法可以做到这一点：</p><ul><li><p>Use a <code>sync.WaitGroup</code>. Do this if there are multiple goroutines that you want to wait for</p><p>​ 使用 <code>sync.WaitGroup</code> 。如果要等待多个协程，请执行此操作</p><pre tabindex=0><code>var wg sync.WaitGroup
for i := 0; i &lt; N; i++ {
  wg.Add(1)
  go func() {
    defer wg.Done()
    // ...
  }()
}

// To wait for all to finish:
wg.Wait()
</code></pre></li><li><p>Add another <code>chan struct{}</code> that the goroutine closes when it’s done. Do this if there’s only one goroutine.</p><p>​ 添加另一个 <code>chan struct{}</code> ，协程完成后将其关闭。如果只有一个协程，请执行此操作。</p><pre tabindex=0><code>done := make(chan struct{})
go func() {
  defer close(done)
  // ...
}()

// To wait for the goroutine to finish:
&lt;-done
</code></pre></li></ul><h4 id=no-goroutines-in-init-init-中没有协程>No goroutines in <code>init()</code> <code>init()</code> 中没有协程</h4><p><code>init()</code> functions should not spawn goroutines. See also <a href=https://github.com/uber-go/guide/blob/master/style.md#avoid-init>Avoid init()</a>.</p><p>​ <code>init()</code> 函数不应生成协程。另请参阅避免使用 init()。</p><p>If a package has need of a background goroutine, it must expose an object that is responsible for managing a goroutine’s lifetime. The object must provide a method (<code>Close</code>, <code>Stop</code>, <code>Shutdown</code>, etc) that signals the background goroutine to stop, and waits for it to exit.</p><p>​ 如果某个包需要后台协程，则它必须公开一个负责管理协程生命周期的对象。该对象必须提供一个方法（ <code>Close</code> 、 <code>Stop</code> 、 <code>Shutdown</code> 等）来指示后台协程停止，并等待其退出。</p><div class=highlight><div style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">10
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Bad
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>func</span> <span style=color:#00b1f7>init</span><span style=color:#abb2bf>()</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>go</span> <span style=color:#00b1f7>doWork</span><span style=color:#abb2bf>()</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>func</span> <span style=color:#00b1f7>doWork</span><span style=color:#abb2bf>()</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>for</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#8a93a5;font-style:italic>// ...
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>  <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span></code></pre></td></tr></table></div></div><p>Spawns a background goroutine unconditionally when the user exports this package. The user has no control over the goroutine or a means of stopping it.</p><p>​ 当用户导出此包时，无条件生成后台协程。用户无法控制协程或停止协程的方法。</p><div class=highlight><div style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">27
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Good
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>type</span> <span style=color:#aa89ea>Worker</span> <span style=color:#76a9f9>struct</span><span style=color:#abb2bf>{</span> <span style=color:#8a93a5;font-style:italic>/* ... */</span> <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>func</span> <span style=color:#00b1f7>NewWorker</span><span style=color:#abb2bf>(</span><span style=color:#54b1c7>...</span><span style=color:#abb2bf>)</span> <span style=color:#54b1c7>*</span><span style=color:#aa89ea>Worker</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>w</span> <span style=color:#54b1c7>:=</span> <span style=color:#54b1c7>&amp;</span><span style=color:#aa89ea>Worker</span><span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>stop</span><span style=color:#abb2bf>:</span> <span style=color:#e5c07b>make</span><span style=color:#abb2bf>(</span><span style=color:#76a9f9>chan</span> <span style=color:#76a9f9>struct</span><span style=color:#abb2bf>{}),</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>done</span><span style=color:#abb2bf>:</span> <span style=color:#e5c07b>make</span><span style=color:#abb2bf>(</span><span style=color:#76a9f9>chan</span> <span style=color:#76a9f9>struct</span><span style=color:#abb2bf>{}),</span>
</span></span><span style=display:flex><span>    <span style=color:#8a93a5;font-style:italic>// ...
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>  <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>go</span> <span style=color:#aa89ea>w</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>doWork</span><span style=color:#abb2bf>()</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>func</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>w</span> <span style=color:#54b1c7>*</span><span style=color:#aa89ea>Worker</span><span style=color:#abb2bf>)</span> <span style=color:#00b1f7>doWork</span><span style=color:#abb2bf>()</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>defer</span> <span style=color:#e5c07b>close</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>w</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>done</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>for</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#8a93a5;font-style:italic>// ...
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>    <span style=color:#76a9f9>case</span> <span style=color:#54b1c7>&lt;-</span><span style=color:#aa89ea>w</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>stop</span><span style=color:#abb2bf>:</span>
</span></span><span style=display:flex><span>      <span style=color:#76a9f9>return</span>
</span></span><span style=display:flex><span>  <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Shutdown tells the worker to stop
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// and waits until it has finished.
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>func</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>w</span> <span style=color:#54b1c7>*</span><span style=color:#aa89ea>Worker</span><span style=color:#abb2bf>)</span> <span style=color:#00b1f7>Shutdown</span><span style=color:#abb2bf>()</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#e5c07b>close</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>w</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>stop</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>  <span style=color:#54b1c7>&lt;-</span><span style=color:#aa89ea>w</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>done</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span></code></pre></td></tr></table></div></div><p>Spawns the worker only if the user requests it. Provides a means of shutting down the worker so that the user can free up resources used by the worker.</p><p>​ 仅在用户请求时生成工作进程。提供关闭工作进程的方法，以便用户可以释放工作进程使用的资源。</p><p>Note that you should use <code>WaitGroup</code>s if the worker manages multiple goroutines. See <a href=https://github.com/uber-go/guide/blob/master/style.md#wait-for-goroutines-to-exit>Wait for goroutines to exit</a>.</p><p>​ 请注意，如果工作进程管理多个协程，则应使用 <code>WaitGroup</code> 。请参阅等待协程退出。</p><h2 id=performance-性能>Performance 性能</h2><p>Performance-specific guidelines apply only to the hot path.</p><p>​ 性能特定准则仅适用于热路径。</p><h3 id=prefer-strconv-over-fmt-优先使用-strconv-而非-fmt>Prefer strconv over fmt 优先使用 strconv 而非 fmt</h3><p>When converting primitives to/from strings, <code>strconv</code> is faster than <code>fmt</code>.</p><p>​ 将基本类型转换为字符串或从字符串转换基本类型时， <code>strconv</code> 比 <code>fmt</code> 更快。</p><div class=highlight><div style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">12
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Bad
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>for</span> <span style=color:#aa89ea>i</span> <span style=color:#54b1c7>:=</span> <span style=color:#d19a66>0</span><span style=color:#abb2bf>;</span> <span style=color:#aa89ea>i</span> <span style=color:#abb2bf>&lt;</span> <span style=color:#aa89ea>b</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>N</span><span style=color:#abb2bf>;</span> <span style=color:#aa89ea>i</span><span style=color:#54b1c7>++</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>s</span> <span style=color:#54b1c7>:=</span> <span style=color:#aa89ea>fmt</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Sprint</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>rand</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Int</span><span style=color:#abb2bf>())</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// BenchmarkFmtSprint-4    143 ns/op    2 allocs/op
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Good
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>for</span> <span style=color:#aa89ea>i</span> <span style=color:#54b1c7>:=</span> <span style=color:#d19a66>0</span><span style=color:#abb2bf>;</span> <span style=color:#aa89ea>i</span> <span style=color:#abb2bf>&lt;</span> <span style=color:#aa89ea>b</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>N</span><span style=color:#abb2bf>;</span> <span style=color:#aa89ea>i</span><span style=color:#54b1c7>++</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>s</span> <span style=color:#54b1c7>:=</span> <span style=color:#aa89ea>strconv</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Itoa</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>rand</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Int</span><span style=color:#abb2bf>())</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// BenchmarkStrconv-4    64.2 ns/op    1 allocs/op
</span></span></span></code></pre></td></tr></table></div></div><h3 id=avoid-repeated-string-to-byte-conversions-避免重复的字符串到字节的转换>Avoid repeated string-to-byte conversions 避免重复的字符串到字节的转换</h3><p>Do not create byte slices from a fixed string repeatedly. Instead, perform the conversion once and capture the result.</p><p>​ 不要反复从固定字符串创建字节切片。相反，执行一次转换并捕获结果。</p><div class=highlight><div style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">13
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Bad
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>for</span> <span style=color:#aa89ea>i</span> <span style=color:#54b1c7>:=</span> <span style=color:#d19a66>0</span><span style=color:#abb2bf>;</span> <span style=color:#aa89ea>i</span> <span style=color:#abb2bf>&lt;</span> <span style=color:#aa89ea>b</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>N</span><span style=color:#abb2bf>;</span> <span style=color:#aa89ea>i</span><span style=color:#54b1c7>++</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>w</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Write</span><span style=color:#abb2bf>([]</span><span style=color:#e5c07b>byte</span><span style=color:#abb2bf>(</span><span style=color:#98c379>&#34;Hello world&#34;</span><span style=color:#abb2bf>))</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// BenchmarkBad-4   50000000   22.2 ns/op
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Good
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#aa89ea>data</span> <span style=color:#54b1c7>:=</span> <span style=color:#abb2bf>[]</span><span style=color:#e5c07b>byte</span><span style=color:#abb2bf>(</span><span style=color:#98c379>&#34;Hello world&#34;</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>for</span> <span style=color:#aa89ea>i</span> <span style=color:#54b1c7>:=</span> <span style=color:#d19a66>0</span><span style=color:#abb2bf>;</span> <span style=color:#aa89ea>i</span> <span style=color:#abb2bf>&lt;</span> <span style=color:#aa89ea>b</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>N</span><span style=color:#abb2bf>;</span> <span style=color:#aa89ea>i</span><span style=color:#54b1c7>++</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>w</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Write</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>data</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// BenchmarkGood-4  500000000   3.25 ns/op
</span></span></span></code></pre></td></tr></table></div></div><h3 id=prefer-specifying-container-capacity-优先指定容器容量>Prefer Specifying Container Capacity 优先指定容器容量</h3><p>Specify container capacity where possible in order to allocate memory for the container up front. This minimizes subsequent allocations (by copying and resizing of the container) as elements are added.</p><p>​ 尽可能指定容器容量，以便预先为容器分配内存。随着元素的添加，这可以最大程度地减少后续分配（通过复制和调整容器大小）。</p><h4 id=specifying-map-capacity-hints-指定映射容量提示>Specifying Map Capacity Hints 指定映射容量提示</h4><p>Where possible, provide capacity hints when initializing maps with <code>make()</code>.</p><p>​ 尽可能在使用 <code>make()</code> 初始化映射时提供容量提示。</p><pre tabindex=0><code>make(map[T1]T2, hint)
</code></pre><p>Providing a capacity hint to <code>make()</code> tries to right-size the map at initialization time, which reduces the need for growing the map and allocations as elements are added to the map.</p><p>​ 向 <code>make()</code> 提供容量提示会尝试在初始化时调整映射大小，从而减少随着元素添加到映射中而需要增加映射和分配的情况。</p><p>Note that, unlike slices, map capacity hints do not guarantee complete, preemptive allocation, but are used to approximate the number of hashmap buckets required. Consequently, allocations may still occur when adding elements to the map, even up to the specified capacity.</p><p>​ 请注意，与切片不同，映射容量提示不保证完全的抢占式分配，但用于估算所需的哈希映射存储桶数。因此，即使达到指定容量，在向映射中添加元素时仍可能发生分配。</p><div class=highlight><div style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Bad
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#aa89ea>m</span> <span style=color:#54b1c7>:=</span> <span style=color:#e5c07b>make</span><span style=color:#abb2bf>(</span><span style=color:#76a9f9>map</span><span style=color:#abb2bf>[</span><span style=color:#e5c07b>string</span><span style=color:#abb2bf>]</span><span style=color:#aa89ea>os</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>FileInfo</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>files</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>_</span> <span style=color:#54b1c7>:=</span> <span style=color:#aa89ea>os</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>ReadDir</span><span style=color:#abb2bf>(</span><span style=color:#98c379>&#34;./files&#34;</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>for</span> <span style=color:#aa89ea>_</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>f</span> <span style=color:#54b1c7>:=</span> <span style=color:#76a9f9>range</span> <span style=color:#aa89ea>files</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>m</span><span style=color:#abb2bf>[</span><span style=color:#aa89ea>f</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Name</span><span style=color:#abb2bf>()]</span> <span style=color:#abb2bf>=</span> <span style=color:#aa89ea>f</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span></code></pre></td></tr></table></div></div><p>m is created without a size hint; there may be more allocations at assignment time.</p><p>​ m 在没有大小提示的情况下创建；在分配时可能会有更多分配。</p><div class=highlight><div style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Good
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>files</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>_</span> <span style=color:#54b1c7>:=</span> <span style=color:#aa89ea>os</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>ReadDir</span><span style=color:#abb2bf>(</span><span style=color:#98c379>&#34;./files&#34;</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>m</span> <span style=color:#54b1c7>:=</span> <span style=color:#e5c07b>make</span><span style=color:#abb2bf>(</span><span style=color:#76a9f9>map</span><span style=color:#abb2bf>[</span><span style=color:#e5c07b>string</span><span style=color:#abb2bf>]</span><span style=color:#aa89ea>os</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>DirEntry</span><span style=color:#abb2bf>,</span> <span style=color:#e5c07b>len</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>files</span><span style=color:#abb2bf>))</span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>for</span> <span style=color:#aa89ea>_</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>f</span> <span style=color:#54b1c7>:=</span> <span style=color:#76a9f9>range</span> <span style=color:#aa89ea>files</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>m</span><span style=color:#abb2bf>[</span><span style=color:#aa89ea>f</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Name</span><span style=color:#abb2bf>()]</span> <span style=color:#abb2bf>=</span> <span style=color:#aa89ea>f</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span></code></pre></td></tr></table></div></div><p><code>m</code> is created with a size hint; there may be fewer allocations at assignment time.</p><p>​ <code>m</code> 在具有大小提示的情况下创建；在分配时可能会有更少的分配。</p><h4 id=specifying-slice-capacity-指定切片容量>Specifying Slice Capacity 指定切片容量</h4><p>Where possible, provide capacity hints when initializing slices with <code>make()</code>, particularly when appending.</p><p>​ 在可能的情况下，在使用 <code>make()</code> 初始化切片时提供容量提示，尤其是在追加时。</p><pre tabindex=0><code>make([]T, length, capacity)
</code></pre><p>Unlike maps, slice capacity is not a hint: the compiler will allocate enough memory for the capacity of the slice as provided to <code>make()</code>, which means that subsequent <code>append()</code> operations will incur zero allocations (until the length of the slice matches the capacity, after which any appends will require a resize to hold additional elements).</p><p>​ 与映射不同，切片容量不是提示：编译器将为 <code>make()</code> 提供的切片容量分配足够的内存，这意味着后续 <code>append()</code> 操作将产生零个分配（直到切片长度与容量匹配，之后任何追加都需要调整大小以容纳其他元素）。</p><div class=highlight><div style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">18
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Bad
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>for</span> <span style=color:#aa89ea>n</span> <span style=color:#54b1c7>:=</span> <span style=color:#d19a66>0</span><span style=color:#abb2bf>;</span> <span style=color:#aa89ea>n</span> <span style=color:#abb2bf>&lt;</span> <span style=color:#aa89ea>b</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>N</span><span style=color:#abb2bf>;</span> <span style=color:#aa89ea>n</span><span style=color:#54b1c7>++</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>data</span> <span style=color:#54b1c7>:=</span> <span style=color:#e5c07b>make</span><span style=color:#abb2bf>([]</span><span style=color:#e5c07b>int</span><span style=color:#abb2bf>,</span> <span style=color:#d19a66>0</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>for</span> <span style=color:#aa89ea>k</span> <span style=color:#54b1c7>:=</span> <span style=color:#d19a66>0</span><span style=color:#abb2bf>;</span> <span style=color:#aa89ea>k</span> <span style=color:#abb2bf>&lt;</span> <span style=color:#aa89ea>size</span><span style=color:#abb2bf>;</span> <span style=color:#aa89ea>k</span><span style=color:#54b1c7>++</span><span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>data</span> <span style=color:#abb2bf>=</span> <span style=color:#e5c07b>append</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>data</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>k</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>  <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// BenchmarkBad-4    100000000    2.48s
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Good
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>for</span> <span style=color:#aa89ea>n</span> <span style=color:#54b1c7>:=</span> <span style=color:#d19a66>0</span><span style=color:#abb2bf>;</span> <span style=color:#aa89ea>n</span> <span style=color:#abb2bf>&lt;</span> <span style=color:#aa89ea>b</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>N</span><span style=color:#abb2bf>;</span> <span style=color:#aa89ea>n</span><span style=color:#54b1c7>++</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>data</span> <span style=color:#54b1c7>:=</span> <span style=color:#e5c07b>make</span><span style=color:#abb2bf>([]</span><span style=color:#e5c07b>int</span><span style=color:#abb2bf>,</span> <span style=color:#d19a66>0</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>size</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>for</span> <span style=color:#aa89ea>k</span> <span style=color:#54b1c7>:=</span> <span style=color:#d19a66>0</span><span style=color:#abb2bf>;</span> <span style=color:#aa89ea>k</span> <span style=color:#abb2bf>&lt;</span> <span style=color:#aa89ea>size</span><span style=color:#abb2bf>;</span> <span style=color:#aa89ea>k</span><span style=color:#54b1c7>++</span><span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>data</span> <span style=color:#abb2bf>=</span> <span style=color:#e5c07b>append</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>data</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>k</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>  <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// BenchmarkGood-4   100000000    0.21s
</span></span></span></code></pre></td></tr></table></div></div><h2 id=style-样式>Style 样式</h2><h3 id=avoid-overly-long-lines-避免过长的行>Avoid overly long lines 避免过长的行</h3><p>Avoid lines of code that require readers to scroll horizontally or turn their heads too much.</p><p>​ 避免需要读者水平滚动或过多转动头部才能阅读的代码行。</p><p>We recommend a soft line length limit of <strong>99 characters</strong>. Authors should aim to wrap lines before hitting this limit, but it is not a hard limit. Code is allowed to exceed this limit.</p><p>​ 我们建议将软行长度限制为 99 个字符。作者应在达到此限制之前换行，但这不是硬性限制。代码可以超过此限制。</p><h3 id=be-consistent-保持一致>Be Consistent 保持一致</h3><p>Some of the guidelines outlined in this document can be evaluated objectively; others are situational, contextual, or subjective.</p><p>​ 本文档中概述的一些准则可以客观评估；其他准则则具有情境性、上下文性或主观性。</p><p>Above all else, <strong>be consistent</strong>.</p><p>​ 最重要的是，保持一致。</p><p>Consistent code is easier to maintain, is easier to rationalize, requires less cognitive overhead, and is easier to migrate or update as new conventions emerge or classes of bugs are fixed.</p><p>​ 一致的代码更易于维护、更易于合理化、需要更少的认知开销，并且随着新约定的出现或错误类别的修复，更易于迁移或更新。</p><p>Conversely, having multiple disparate or conflicting styles within a single codebase causes maintenance overhead, uncertainty, and cognitive dissonance, all of which can directly contribute to lower velocity, painful code reviews, and bugs.</p><p>​ 相反，在单个代码库中有多种不同或冲突的样式会导致维护开销、不确定性和认知失调，所有这些都会直接导致速度降低、痛苦的代码审查和错误。</p><p>When applying these guidelines to a codebase, it is recommended that changes are made at a package (or larger) level: application at a sub-package level violates the above concern by introducing multiple styles into the same code.</p><p>​ 将这些准则应用于代码库时，建议在包（或更大）级别进行更改：在子包级别进行应用会违反上述关注点，因为会在同一代码中引入多种样式。</p><h3 id=group-similar-declarations-对类似声明进行分组>Group Similar Declarations 对类似声明进行分组</h3><p>Go supports grouping similar declarations.</p><p>​ Go 支持对类似声明进行分组。</p><div class=highlight><div style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Bad
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>import</span> <span style=color:#98c379>&#34;a&#34;</span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>import</span> <span style=color:#98c379>&#34;b&#34;</span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Good
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>import</span> <span style=color:#abb2bf>(</span>
</span></span><span style=display:flex><span>  <span style=color:#98c379>&#34;a&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#98c379>&#34;b&#34;</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>)</span>
</span></span></code></pre></td></tr></table></div></div><p>This also applies to constants, variables, and type declarations.</p><p>​ 这也适用于常量、变量和类型声明。</p><div class=highlight><div style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">29
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Bad
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>const</span> <span style=color:#aa89ea>a</span> <span style=color:#abb2bf>=</span> <span style=color:#d19a66>1</span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>const</span> <span style=color:#aa89ea>b</span> <span style=color:#abb2bf>=</span> <span style=color:#d19a66>2</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>var</span> <span style=color:#aa89ea>a</span> <span style=color:#abb2bf>=</span> <span style=color:#d19a66>1</span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>var</span> <span style=color:#aa89ea>b</span> <span style=color:#abb2bf>=</span> <span style=color:#d19a66>2</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>type</span> <span style=color:#aa89ea>Area</span> <span style=color:#e5c07b>float64</span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>type</span> <span style=color:#aa89ea>Volume</span> <span style=color:#e5c07b>float64</span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Good
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>const</span> <span style=color:#abb2bf>(</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>a</span> <span style=color:#abb2bf>=</span> <span style=color:#d19a66>1</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>b</span> <span style=color:#abb2bf>=</span> <span style=color:#d19a66>2</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>var</span> <span style=color:#abb2bf>(</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>a</span> <span style=color:#abb2bf>=</span> <span style=color:#d19a66>1</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>b</span> <span style=color:#abb2bf>=</span> <span style=color:#d19a66>2</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>type</span> <span style=color:#abb2bf>(</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>Area</span> <span style=color:#e5c07b>float64</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>Volume</span> <span style=color:#e5c07b>float64</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>)</span>
</span></span></code></pre></td></tr></table></div></div><p>Only group related declarations. Do not group declarations that are unrelated.</p><p>​ 仅对相关的声明进行分组。不要对不相关的声明进行分组。</p><div class=highlight><div style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">19
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Bad
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>type</span> <span style=color:#aa89ea>Operation</span> <span style=color:#e5c07b>int</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>const</span> <span style=color:#abb2bf>(</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>Add</span> <span style=color:#aa89ea>Operation</span> <span style=color:#abb2bf>=</span> <span style=color:#e5c07b>iota</span> <span style=color:#54b1c7>+</span> <span style=color:#d19a66>1</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>Subtract</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>Multiply</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>EnvVar</span> <span style=color:#abb2bf>=</span> <span style=color:#98c379>&#34;MY_ENV&#34;</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Good
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>type</span> <span style=color:#aa89ea>Operation</span> <span style=color:#e5c07b>int</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>const</span> <span style=color:#abb2bf>(</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>Add</span> <span style=color:#aa89ea>Operation</span> <span style=color:#abb2bf>=</span> <span style=color:#e5c07b>iota</span> <span style=color:#54b1c7>+</span> <span style=color:#d19a66>1</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>Subtract</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>Multiply</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>const</span> <span style=color:#aa89ea>EnvVar</span> <span style=color:#abb2bf>=</span> <span style=color:#98c379>&#34;MY_ENV&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>Groups are not limited in where they can be used. For example, you can use them inside of functions.</p><p>​ 组的使用位置不受限制。例如，您可以在函数内部使用它们。</p><div class=highlight><div style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">18
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Bad
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>func</span> <span style=color:#00b1f7>f</span><span style=color:#abb2bf>()</span> <span style=color:#e5c07b>string</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>red</span> <span style=color:#54b1c7>:=</span> <span style=color:#aa89ea>color</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>New</span><span style=color:#abb2bf>(</span><span style=color:#d19a66>0xff0000</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>green</span> <span style=color:#54b1c7>:=</span> <span style=color:#aa89ea>color</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>New</span><span style=color:#abb2bf>(</span><span style=color:#d19a66>0x00ff00</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>blue</span> <span style=color:#54b1c7>:=</span> <span style=color:#aa89ea>color</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>New</span><span style=color:#abb2bf>(</span><span style=color:#d19a66>0x0000ff</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8a93a5;font-style:italic>// ...
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Good
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>func</span> <span style=color:#00b1f7>f</span><span style=color:#abb2bf>()</span> <span style=color:#e5c07b>string</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>var</span> <span style=color:#abb2bf>(</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>red</span>   <span style=color:#abb2bf>=</span> <span style=color:#aa89ea>color</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>New</span><span style=color:#abb2bf>(</span><span style=color:#d19a66>0xff0000</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>green</span> <span style=color:#abb2bf>=</span> <span style=color:#aa89ea>color</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>New</span><span style=color:#abb2bf>(</span><span style=color:#d19a66>0x00ff00</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>blue</span>  <span style=color:#abb2bf>=</span> <span style=color:#aa89ea>color</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>New</span><span style=color:#abb2bf>(</span><span style=color:#d19a66>0x0000ff</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>  <span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8a93a5;font-style:italic>// ...
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#abb2bf>}</span>
</span></span></code></pre></td></tr></table></div></div><p>Exception: Variable declarations, particularly inside functions, should be grouped together if declared adjacent to other variables. Do this for variables declared together even if they are unrelated.</p><p>​ 异常：变量声明，尤其是在函数内部，如果与其他变量相邻声明，则应将其分组在一起。即使变量不相关，也要对一起声明的变量执行此操作。</p><div class=highlight><div style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">20
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Bad
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>func</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>c</span> <span style=color:#54b1c7>*</span><span style=color:#aa89ea>client</span><span style=color:#abb2bf>)</span> <span style=color:#00b1f7>request</span><span style=color:#abb2bf>()</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>caller</span> <span style=color:#54b1c7>:=</span> <span style=color:#aa89ea>c</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>name</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>format</span> <span style=color:#54b1c7>:=</span> <span style=color:#98c379>&#34;json&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>timeout</span> <span style=color:#54b1c7>:=</span> <span style=color:#d19a66>5</span><span style=color:#54b1c7>*</span><span style=color:#aa89ea>time</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>Second</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>var</span> <span style=color:#aa89ea>err</span> <span style=color:#e5c07b>error</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8a93a5;font-style:italic>// ...
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Good
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>func</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>c</span> <span style=color:#54b1c7>*</span><span style=color:#aa89ea>client</span><span style=color:#abb2bf>)</span> <span style=color:#00b1f7>request</span><span style=color:#abb2bf>()</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>var</span> <span style=color:#abb2bf>(</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>caller</span>  <span style=color:#abb2bf>=</span> <span style=color:#aa89ea>c</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>name</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>format</span>  <span style=color:#abb2bf>=</span> <span style=color:#98c379>&#34;json&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>timeout</span> <span style=color:#abb2bf>=</span> <span style=color:#d19a66>5</span><span style=color:#54b1c7>*</span><span style=color:#aa89ea>time</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>Second</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>err</span> <span style=color:#e5c07b>error</span>
</span></span><span style=display:flex><span>  <span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8a93a5;font-style:italic>// ...
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#abb2bf>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=import-group-ordering-导入组排序>Import Group Ordering 导入组排序</h3><p>There should be two import groups:</p><p>​ 应有两个导入组：</p><ul><li>Standard library
标准库</li><li>Everything else
其他所有内容</li></ul><p>This is the grouping applied by goimports by default.</p><p>​ 这是 goimports 默认应用的分组。</p><div class=highlight><div style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">15
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Bad
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>import</span> <span style=color:#abb2bf>(</span>
</span></span><span style=display:flex><span>  <span style=color:#98c379>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#98c379>&#34;os&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#98c379>&#34;go.uber.org/atomic&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#98c379>&#34;golang.org/x/sync/errgroup&#34;</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Good
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>import</span> <span style=color:#abb2bf>(</span>
</span></span><span style=display:flex><span>  <span style=color:#98c379>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#98c379>&#34;os&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#98c379>&#34;go.uber.org/atomic&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#98c379>&#34;golang.org/x/sync/errgroup&#34;</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=package-names-包名称>Package Names 包名称</h3><p>When naming packages, choose a name that is:</p><p>​ 在命名包时，请选择一个名称：</p><ul><li>All lower-case. No capitals or underscores.
全部小写。没有大写字母或下划线。</li><li>Does not need to be renamed using named imports at most call sites.
在大多数调用站点无需使用命名导入重命名。</li><li>Short and succinct. Remember that the name is identified in full at every call site.
简短精炼。请记住，名称在每个调用站点都以完整形式标识。</li><li>Not plural. For example, <code>net/url</code>, not <code>net/urls</code>.
不是复数。例如， <code>net/url</code> ，而不是 <code>net/urls</code> 。</li><li>Not “common”, “util”, “shared”, or “lib”. These are bad, uninformative names.
不是“common”、“util”、“shared”或“lib”。这些都是糟糕的、没有信息量的名称。</li></ul><p>See also <a href=https://blog.golang.org/package-names>Package Names</a> and <a href=https://rakyll.org/style-packages/>Style guideline for Go packages</a>.</p><p>​ 另请参阅 Go 包的包名称和样式指南。</p><h3 id=function-names-函数名称>Function Names 函数名称</h3><p>We follow the Go community’s convention of using <a href=https://golang.org/doc/effective_go.html#mixed-caps>MixedCaps for function names</a>. An exception is made for test functions, which may contain underscores for the purpose of grouping related test cases, e.g., <code>TestMyFunction_WhatIsBeingTested</code>.</p><p>​ 我们遵循 Go 社区的惯例，对函数名称使用 MixedCaps。测试函数除外，测试函数可能包含下划线，以便对相关的测试用例进行分组，例如， <code>TestMyFunction_WhatIsBeingTested</code> 。</p><h3 id=import-aliasing-导入别名>Import Aliasing 导入别名</h3><p>Import aliasing must be used if the package name does not match the last element of the import path.</p><p>​ 如果包名称与导入路径的最后一个元素不匹配，则必须使用导入别名。</p><pre tabindex=0><code>import (
  &#34;net/http&#34;

  client &#34;example.com/client-go&#34;
  trace &#34;example.com/trace/v2&#34;
)
</code></pre><p>In all other scenarios, import aliases should be avoided unless there is a direct conflict between imports.</p><p>​ 在所有其他情况下，应避免导入别名，除非导入之间存在直接冲突。</p><div class=highlight><div style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">16
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Bad
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>import</span> <span style=color:#abb2bf>(</span>
</span></span><span style=display:flex><span>  <span style=color:#98c379>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#98c379>&#34;os&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>nettrace</span> <span style=color:#98c379>&#34;golang.net/x/trace&#34;</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Good
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>import</span> <span style=color:#abb2bf>(</span>
</span></span><span style=display:flex><span>  <span style=color:#98c379>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#98c379>&#34;os&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#98c379>&#34;runtime/trace&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>nettrace</span> <span style=color:#98c379>&#34;golang.net/x/trace&#34;</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=function-grouping-and-ordering-函数分组和排序>Function Grouping and Ordering 函数分组和排序</h3><ul><li>Functions should be sorted in rough call order.
应按大致调用顺序对函数进行排序。</li><li>Functions in a file should be grouped by receiver.
文件中应按接收者对函数进行分组。</li></ul><p>Therefore, exported functions should appear first in a file, after <code>struct</code>, <code>const</code>, <code>var</code> definitions.</p><p>​ 因此，导出的函数应首先出现在文件中，位于 <code>struct</code> 、 <code>const</code> 、 <code>var</code> 定义之后。</p><p>A <code>newXYZ()</code>/<code>NewXYZ()</code> may appear after the type is defined, but before the rest of the methods on the receiver.</p><p>​ <code>newXYZ()</code> / <code>NewXYZ()</code> 可能会在定义类型之后但接收者上的其他方法之前出现。</p><p>Since functions are grouped by receiver, plain utility functions should appear towards the end of the file.</p><p>​ 由于函数按接收者分组，因此普通实用函数应出现在文件的末尾。</p><div class=highlight><div style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">28
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Bad
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>func</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>s</span> <span style=color:#54b1c7>*</span><span style=color:#aa89ea>something</span><span style=color:#abb2bf>)</span> <span style=color:#00b1f7>Cost</span><span style=color:#abb2bf>()</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>return</span> <span style=color:#00b1f7>calcCost</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>s</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>weights</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>type</span> <span style=color:#aa89ea>something</span> <span style=color:#76a9f9>struct</span><span style=color:#abb2bf>{</span> <span style=color:#54b1c7>...</span> <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>func</span> <span style=color:#00b1f7>calcCost</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>n</span> <span style=color:#abb2bf>[]</span><span style=color:#e5c07b>int</span><span style=color:#abb2bf>)</span> <span style=color:#e5c07b>int</span> <span style=color:#abb2bf>{</span><span style=color:#54b1c7>...</span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>func</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>s</span> <span style=color:#54b1c7>*</span><span style=color:#aa89ea>something</span><span style=color:#abb2bf>)</span> <span style=color:#00b1f7>Stop</span><span style=color:#abb2bf>()</span> <span style=color:#abb2bf>{</span><span style=color:#54b1c7>...</span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>func</span> <span style=color:#00b1f7>newSomething</span><span style=color:#abb2bf>()</span> <span style=color:#54b1c7>*</span><span style=color:#aa89ea>something</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#76a9f9>return</span> <span style=color:#54b1c7>&amp;</span><span style=color:#aa89ea>something</span><span style=color:#abb2bf>{}</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Good
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>type</span> <span style=color:#aa89ea>something</span> <span style=color:#76a9f9>struct</span><span style=color:#abb2bf>{</span> <span style=color:#54b1c7>...</span> <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>func</span> <span style=color:#00b1f7>newSomething</span><span style=color:#abb2bf>()</span> <span style=color:#54b1c7>*</span><span style=color:#aa89ea>something</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#76a9f9>return</span> <span style=color:#54b1c7>&amp;</span><span style=color:#aa89ea>something</span><span style=color:#abb2bf>{}</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>func</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>s</span> <span style=color:#54b1c7>*</span><span style=color:#aa89ea>something</span><span style=color:#abb2bf>)</span> <span style=color:#00b1f7>Cost</span><span style=color:#abb2bf>()</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>return</span> <span style=color:#00b1f7>calcCost</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>s</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>weights</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>func</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>s</span> <span style=color:#54b1c7>*</span><span style=color:#aa89ea>something</span><span style=color:#abb2bf>)</span> <span style=color:#00b1f7>Stop</span><span style=color:#abb2bf>()</span> <span style=color:#abb2bf>{</span><span style=color:#54b1c7>...</span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>func</span> <span style=color:#00b1f7>calcCost</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>n</span> <span style=color:#abb2bf>[]</span><span style=color:#e5c07b>int</span><span style=color:#abb2bf>)</span> <span style=color:#e5c07b>int</span> <span style=color:#abb2bf>{</span><span style=color:#54b1c7>...</span><span style=color:#abb2bf>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=reduce-nesting-减少嵌套>Reduce Nesting 减少嵌套</h3><p>Code should reduce nesting where possible by handling error cases/special conditions first and returning early or continuing the loop. Reduce the amount of code that is nested multiple levels.</p><p>​ 代码应尽可能通过首先处理错误情况/特殊情况并尽早返回或继续循环来减少嵌套。减少嵌套多层的代码量。</p><div class=highlight><div style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">26
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Bad
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>for</span> <span style=color:#aa89ea>_</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>v</span> <span style=color:#54b1c7>:=</span> <span style=color:#76a9f9>range</span> <span style=color:#aa89ea>data</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>if</span> <span style=color:#aa89ea>v</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>F1</span> <span style=color:#54b1c7>==</span> <span style=color:#d19a66>1</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>v</span> <span style=color:#abb2bf>=</span> <span style=color:#00b1f7>process</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>v</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>    <span style=color:#76a9f9>if</span> <span style=color:#aa89ea>err</span> <span style=color:#54b1c7>:=</span> <span style=color:#aa89ea>v</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Call</span><span style=color:#abb2bf>();</span> <span style=color:#aa89ea>err</span> <span style=color:#54b1c7>==</span> <span style=color:#e5c07b>nil</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>      <span style=color:#aa89ea>v</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Send</span><span style=color:#abb2bf>()</span>
</span></span><span style=display:flex><span>    <span style=color:#abb2bf>}</span> <span style=color:#76a9f9>else</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>      <span style=color:#76a9f9>return</span> <span style=color:#aa89ea>err</span>
</span></span><span style=display:flex><span>    <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>  <span style=color:#abb2bf>}</span> <span style=color:#76a9f9>else</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>log</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Printf</span><span style=color:#abb2bf>(</span><span style=color:#98c379>&#34;Invalid v: %v&#34;</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>v</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>  <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Good
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>for</span> <span style=color:#aa89ea>_</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>v</span> <span style=color:#54b1c7>:=</span> <span style=color:#76a9f9>range</span> <span style=color:#aa89ea>data</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>if</span> <span style=color:#aa89ea>v</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>F1</span> <span style=color:#54b1c7>!=</span> <span style=color:#d19a66>1</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>log</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Printf</span><span style=color:#abb2bf>(</span><span style=color:#98c379>&#34;Invalid v: %v&#34;</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>v</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>    <span style=color:#76a9f9>continue</span>
</span></span><span style=display:flex><span>  <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>v</span> <span style=color:#abb2bf>=</span> <span style=color:#00b1f7>process</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>v</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>if</span> <span style=color:#aa89ea>err</span> <span style=color:#54b1c7>:=</span> <span style=color:#aa89ea>v</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Call</span><span style=color:#abb2bf>();</span> <span style=color:#aa89ea>err</span> <span style=color:#54b1c7>!=</span> <span style=color:#e5c07b>nil</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#76a9f9>return</span> <span style=color:#aa89ea>err</span>
</span></span><span style=display:flex><span>  <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>v</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Send</span><span style=color:#abb2bf>()</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=unnecessary-else-不必要的-else>Unnecessary Else 不必要的 Else</h3><p>If a variable is set in both branches of an if, it can be replaced with a single if.</p><p>​ 如果变量在 if 的两个分支中都设置了，则可以用一个 if 替换它。</p><div class=highlight><div style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">12
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Bad
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>var</span> <span style=color:#aa89ea>a</span> <span style=color:#e5c07b>int</span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>if</span> <span style=color:#aa89ea>b</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>a</span> <span style=color:#abb2bf>=</span> <span style=color:#d19a66>100</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span> <span style=color:#76a9f9>else</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>a</span> <span style=color:#abb2bf>=</span> <span style=color:#d19a66>10</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Good
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#aa89ea>a</span> <span style=color:#54b1c7>:=</span> <span style=color:#d19a66>10</span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>if</span> <span style=color:#aa89ea>b</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>a</span> <span style=color:#abb2bf>=</span> <span style=color:#d19a66>100</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=top-level-variable-declarations-顶级变量声明>Top-level Variable Declarations 顶级变量声明</h3><p>At the top level, use the standard <code>var</code> keyword. Do not specify the type, unless it is not the same type as the expression.</p><p>​ 在顶级，使用标准 <code>var</code> 关键字。不要指定类型，除非它与表达式的类型不同。</p><div class=highlight><div style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">10
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Bad
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>var</span> <span style=color:#aa89ea>_s</span> <span style=color:#e5c07b>string</span> <span style=color:#abb2bf>=</span> <span style=color:#00b1f7>F</span><span style=color:#abb2bf>()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>func</span> <span style=color:#00b1f7>F</span><span style=color:#abb2bf>()</span> <span style=color:#e5c07b>string</span> <span style=color:#abb2bf>{</span> <span style=color:#76a9f9>return</span> <span style=color:#98c379>&#34;A&#34;</span> <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Good
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>var</span> <span style=color:#aa89ea>_s</span> <span style=color:#abb2bf>=</span> <span style=color:#00b1f7>F</span><span style=color:#abb2bf>()</span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Since F already states that it returns a string, we don&#39;t need to specify
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// the type again.
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>func</span> <span style=color:#00b1f7>F</span><span style=color:#abb2bf>()</span> <span style=color:#e5c07b>string</span> <span style=color:#abb2bf>{</span> <span style=color:#76a9f9>return</span> <span style=color:#98c379>&#34;A&#34;</span> <span style=color:#abb2bf>}</span>
</span></span></code></pre></td></tr></table></div></div><p>Specify the type if the type of the expression does not match the desired type exactly.</p><p>​ 如果表达式的类型与所需类型不完全匹配，则指定类型。</p><div class=highlight><div style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#76a9f9>type</span> <span style=color:#aa89ea>myError</span> <span style=color:#76a9f9>struct</span><span style=color:#abb2bf>{}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>func</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>myError</span><span style=color:#abb2bf>)</span> <span style=color:#00b1f7>Error</span><span style=color:#abb2bf>()</span> <span style=color:#e5c07b>string</span> <span style=color:#abb2bf>{</span> <span style=color:#76a9f9>return</span> <span style=color:#98c379>&#34;error&#34;</span> <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>func</span> <span style=color:#00b1f7>F</span><span style=color:#abb2bf>()</span> <span style=color:#aa89ea>myError</span> <span style=color:#abb2bf>{</span> <span style=color:#76a9f9>return</span> <span style=color:#aa89ea>myError</span><span style=color:#abb2bf>{}</span> <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>var</span> <span style=color:#aa89ea>_e</span> <span style=color:#e5c07b>error</span> <span style=color:#abb2bf>=</span> <span style=color:#00b1f7>F</span><span style=color:#abb2bf>()</span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// F returns an object of type myError but we want error.
</span></span></span></code></pre></td></tr></table></div></div><h3 id=prefix-unexported-globals-with-_-前缀未导出的全局变量为-_>Prefix Unexported Globals with _ 前缀未导出的全局变量为 _</h3><p>Prefix unexported top-level <code>var</code>s and <code>const</code>s with <code>_</code> to make it clear when they are used that they are global symbols.</p><p>​ 前缀未导出的顶级 <code>var</code> 和 <code>const</code> 为 <code>_</code> ，以便在使用时清楚地表明它们是全局符号。</p><p>Rationale: Top-level variables and constants have a package scope. Using a generic name makes it easy to accidentally use the wrong value in a different file.</p><p>​ 基本原理：顶级变量和常量具有包范围。使用通用名称很容易在不同的文件中意外使用错误的值。</p><div class=highlight><div style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">25
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Bad
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// foo.go
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>const</span> <span style=color:#abb2bf>(</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>defaultPort</span> <span style=color:#abb2bf>=</span> <span style=color:#d19a66>8080</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>defaultUser</span> <span style=color:#abb2bf>=</span> <span style=color:#98c379>&#34;user&#34;</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// bar.go
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>func</span> <span style=color:#00b1f7>Bar</span><span style=color:#abb2bf>()</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>defaultPort</span> <span style=color:#54b1c7>:=</span> <span style=color:#d19a66>9090</span>
</span></span><span style=display:flex><span>  <span style=color:#54b1c7>...</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>fmt</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Println</span><span style=color:#abb2bf>(</span><span style=color:#98c379>&#34;Default port&#34;</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>defaultPort</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8a93a5;font-style:italic>// We will not see a compile error if the first line of
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>  <span style=color:#8a93a5;font-style:italic>// Bar() is deleted.
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Good
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// foo.go
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>const</span> <span style=color:#abb2bf>(</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>_defaultPort</span> <span style=color:#abb2bf>=</span> <span style=color:#d19a66>8080</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>_defaultUser</span> <span style=color:#abb2bf>=</span> <span style=color:#98c379>&#34;user&#34;</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>)</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Exception</strong>: Unexported error values may use the prefix <code>err</code> without the underscore. See <a href=https://github.com/uber-go/guide/blob/master/style.md#error-naming>Error Naming</a>.</p><p>​ 例外：未导出的错误值可以使用前缀 <code>err</code> 而没有下划线。请参阅错误命名。</p><h3 id=embedding-in-structs-嵌入到结构中>Embedding in Structs 嵌入到结构中</h3><p>Embedded types should be at the top of the field list of a struct, and there must be an empty line separating embedded fields from regular fields.</p><p>​ 嵌入式类型应位于结构的字段列表顶部，并且必须有空行将嵌入式字段与常规字段分隔开。</p><div class=highlight><div style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">11
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Bad
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>type</span> <span style=color:#aa89ea>Client</span> <span style=color:#76a9f9>struct</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>version</span> <span style=color:#e5c07b>int</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>http</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>Client</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Good
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>type</span> <span style=color:#aa89ea>Client</span> <span style=color:#76a9f9>struct</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>http</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>Client</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>version</span> <span style=color:#e5c07b>int</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span></code></pre></td></tr></table></div></div><p>Embedding should provide tangible benefit, like adding or augmenting functionality in a semantically-appropriate way. It should do this with zero adverse user-facing effects (see also: <a href=https://github.com/uber-go/guide/blob/master/style.md#avoid-embedding-types-in-public-structs>Avoid Embedding Types in Public Structs</a>).</p><p>​ 嵌入应该提供切实的益处，例如以语义上合适的方式添加或增强功能。它应该做到这一点，而不会对用户产生任何不利影响（另请参阅：避免在公共结构中嵌入类型）。</p><p>Exception: Mutexes should not be embedded, even on unexported types. See also: <a href=https://github.com/uber-go/guide/blob/master/style.md#zero-value-mutexes-are-valid>Zero-value Mutexes are Valid</a>.</p><p>​ 例外：即使在未导出的类型上，也不应嵌入互斥锁。另请参阅：零值互斥锁有效。</p><p>Embedding <strong>should not</strong>:</p><p>​ 嵌入不应：</p><ul><li>Be purely cosmetic or convenience-oriented.
纯粹是装饰性的或以方便为导向。</li><li>Make outer types more difficult to construct or use.
使外部类型更难构造或使用。</li><li>Affect outer types’ zero values. If the outer type has a useful zero value, it should still have a useful zero value after embedding the inner type.
影响外部类型的零值。如果外部类型具有有用的零值，那么在嵌入内部类型后，它仍应具有有用的零值。</li><li>Expose unrelated functions or fields from the outer type as a side-effect of embedding the inner type.
将外部类型中不相关的函数或字段作为嵌入内部类型的副作用暴露出来。</li><li>Expose unexported types.
暴露未导出的类型。</li><li>Affect outer types’ copy semantics.
影响外部类型的复制语义。</li><li>Change the outer type’s API or type semantics.
更改外部类型的 API 或类型语义。</li><li>Embed a non-canonical form of the inner type.
嵌入内部类型的非规范形式。</li><li>Expose implementation details of the outer type.
公开外部类型的实现细节。</li><li>Allow users to observe or control type internals.
允许用户观察或控制类型内部。</li><li>Change the general behavior of inner functions through wrapping in a way that would reasonably surprise users.
通过包装改变内部函数的一般行为，这种方式可能会合理地让用户感到惊讶。</li></ul><p>Simply put, embed consciously and intentionally. A good litmus test is, “would all of these exported inner methods/fields be added directly to the outer type”; if the answer is “some” or “no”, don’t embed the inner type - use a field instead.</p><p>​ 简单来说，有意识地和有意图地嵌入。一个很好的试金石是，“所有这些导出的内部方法/字段是否会直接添加到外部类型”；如果答案是“有些”或“没有”，则不要嵌入内部类型 - 而要使用字段。</p><div class=highlight><div style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">74
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Bad
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>type</span> <span style=color:#aa89ea>A</span> <span style=color:#76a9f9>struct</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#8a93a5;font-style:italic>// Bad: A.Lock() and A.Unlock() are
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>    <span style=color:#8a93a5;font-style:italic>//      now available, provide no
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>    <span style=color:#8a93a5;font-style:italic>//      functional benefit, and allow
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>    <span style=color:#8a93a5;font-style:italic>//      users to control details about
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>    <span style=color:#8a93a5;font-style:italic>//      the internals of A.
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>    <span style=color:#aa89ea>sync</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>Mutex</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// ---------------------------------------
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>type</span> <span style=color:#aa89ea>Book</span> <span style=color:#76a9f9>struct</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#8a93a5;font-style:italic>// Bad: pointer changes zero value usefulness
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>    <span style=color:#aa89ea>io</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>ReadWriter</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8a93a5;font-style:italic>// other fields
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// later
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>var</span> <span style=color:#aa89ea>b</span> <span style=color:#aa89ea>Book</span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>b</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Read</span><span style=color:#abb2bf>(</span><span style=color:#54b1c7>...</span><span style=color:#abb2bf>)</span>  <span style=color:#8a93a5;font-style:italic>// panic: nil pointer
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#aa89ea>b</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>String</span><span style=color:#abb2bf>()</span>   <span style=color:#8a93a5;font-style:italic>// panic: nil pointer
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#aa89ea>b</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Write</span><span style=color:#abb2bf>(</span><span style=color:#54b1c7>...</span><span style=color:#abb2bf>)</span> <span style=color:#8a93a5;font-style:italic>// panic: nil pointer
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// ---------------------------------------
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>type</span> <span style=color:#aa89ea>Client</span> <span style=color:#76a9f9>struct</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>sync</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>Mutex</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>sync</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>WaitGroup</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>bytes</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>Buffer</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>url</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>URL</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Good
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>type</span> <span style=color:#aa89ea>countingWriteCloser</span> <span style=color:#76a9f9>struct</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#8a93a5;font-style:italic>// Good: Write() is provided at this
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>    <span style=color:#8a93a5;font-style:italic>//       outer layer for a specific
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>    <span style=color:#8a93a5;font-style:italic>//       purpose, and delegates work
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>    <span style=color:#8a93a5;font-style:italic>//       to the inner type&#39;s Write().
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>    <span style=color:#aa89ea>io</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>WriteCloser</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>count</span> <span style=color:#e5c07b>int</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>func</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>w</span> <span style=color:#54b1c7>*</span><span style=color:#aa89ea>countingWriteCloser</span><span style=color:#abb2bf>)</span> <span style=color:#00b1f7>Write</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>bs</span> <span style=color:#abb2bf>[]</span><span style=color:#e5c07b>byte</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>(</span><span style=color:#e5c07b>int</span><span style=color:#abb2bf>,</span> <span style=color:#e5c07b>error</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>w</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>count</span> <span style=color:#54b1c7>+=</span> <span style=color:#e5c07b>len</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>bs</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>    <span style=color:#76a9f9>return</span> <span style=color:#aa89ea>w</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>WriteCloser</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Write</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>bs</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// ---------------------------------------
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>type</span> <span style=color:#aa89ea>Book</span> <span style=color:#76a9f9>struct</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#8a93a5;font-style:italic>// Good: has useful zero value
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>    <span style=color:#aa89ea>bytes</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>Buffer</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8a93a5;font-style:italic>// other fields
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// later
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>var</span> <span style=color:#aa89ea>b</span> <span style=color:#aa89ea>Book</span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>b</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Read</span><span style=color:#abb2bf>(</span><span style=color:#54b1c7>...</span><span style=color:#abb2bf>)</span>  <span style=color:#8a93a5;font-style:italic>// ok
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#aa89ea>b</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>String</span><span style=color:#abb2bf>()</span>   <span style=color:#8a93a5;font-style:italic>// ok
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#aa89ea>b</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Write</span><span style=color:#abb2bf>(</span><span style=color:#54b1c7>...</span><span style=color:#abb2bf>)</span> <span style=color:#8a93a5;font-style:italic>// ok
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// ---------------------------------------
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>type</span> <span style=color:#aa89ea>Client</span> <span style=color:#76a9f9>struct</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>mtx</span> <span style=color:#aa89ea>sync</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>Mutex</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>wg</span>  <span style=color:#aa89ea>sync</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>WaitGroup</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>buf</span> <span style=color:#aa89ea>bytes</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>Buffer</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>url</span> <span style=color:#aa89ea>url</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>URL</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=local-variable-declarations-局部变量声明>Local Variable Declarations 局部变量声明</h3><p>Short variable declarations (<code>:=</code>) should be used if a variable is being set to some value explicitly.</p><p>​ 如果变量被明确地设置为某个值，则应使用短变量声明 ( <code>:=</code> )。</p><div class=highlight><div style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Bad
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>var</span> <span style=color:#aa89ea>s</span> <span style=color:#abb2bf>=</span> <span style=color:#98c379>&#34;foo&#34;</span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Good
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#aa89ea>s</span> <span style=color:#54b1c7>:=</span> <span style=color:#98c379>&#34;foo&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>However, there are cases where the default value is clearer when the <code>var</code> keyword is used. <a href=https://github.com/golang/go/wiki/CodeReviewComments#declaring-empty-slices>Declaring Empty Slices</a>, for example.</p><p>​ 但是，在使用 <code>var</code> 关键字时，默认值更清晰的情况也有。例如，声明空切片。</p><div class=highlight><div style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">18
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Bad
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>func</span> <span style=color:#00b1f7>f</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>list</span> <span style=color:#abb2bf>[]</span><span style=color:#e5c07b>int</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>filtered</span> <span style=color:#54b1c7>:=</span> <span style=color:#abb2bf>[]</span><span style=color:#e5c07b>int</span><span style=color:#abb2bf>{}</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>for</span> <span style=color:#aa89ea>_</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>v</span> <span style=color:#54b1c7>:=</span> <span style=color:#76a9f9>range</span> <span style=color:#aa89ea>list</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#76a9f9>if</span> <span style=color:#aa89ea>v</span> <span style=color:#abb2bf>&gt;</span> <span style=color:#d19a66>10</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>      <span style=color:#aa89ea>filtered</span> <span style=color:#abb2bf>=</span> <span style=color:#e5c07b>append</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>filtered</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>v</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>    <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>  <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Good
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>func</span> <span style=color:#00b1f7>f</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>list</span> <span style=color:#abb2bf>[]</span><span style=color:#e5c07b>int</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>var</span> <span style=color:#aa89ea>filtered</span> <span style=color:#abb2bf>[]</span><span style=color:#e5c07b>int</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>for</span> <span style=color:#aa89ea>_</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>v</span> <span style=color:#54b1c7>:=</span> <span style=color:#76a9f9>range</span> <span style=color:#aa89ea>list</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#76a9f9>if</span> <span style=color:#aa89ea>v</span> <span style=color:#abb2bf>&gt;</span> <span style=color:#d19a66>10</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>      <span style=color:#aa89ea>filtered</span> <span style=color:#abb2bf>=</span> <span style=color:#e5c07b>append</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>filtered</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>v</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>    <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>  <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=nil-is-a-valid-slice-nil-是一个有效的切片>nil is a valid slice nil 是一个有效的切片</h3><p><code>nil</code> is a valid slice of length 0. This means that,</p><p>​ <code>nil</code> 是一个长度为 0 的有效切片。这意味着，</p><ul><li><p>You should not return a slice of length zero explicitly. Return <code>nil</code> instead.</p><p>​ 您不应该显式地返回长度为零的切片。相反，返回 <code>nil</code> 。</p><div class=highlight><div style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Bad
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>if</span> <span style=color:#aa89ea>x</span> <span style=color:#54b1c7>==</span> <span style=color:#98c379>&#34;&#34;</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>return</span> <span style=color:#abb2bf>[]</span><span style=color:#e5c07b>int</span><span style=color:#abb2bf>{}</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Good
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>if</span> <span style=color:#aa89ea>x</span> <span style=color:#54b1c7>==</span> <span style=color:#98c379>&#34;&#34;</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>return</span> <span style=color:#e5c07b>nil</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>To check if a slice is empty, always use <code>len(s) == 0</code>. Do not check for <code>nil</code>.</p><p>​ 要检查切片是否为空，请始终使用 <code>len(s) == 0</code> 。不要检查 <code>nil</code> 。</p><div class=highlight><div style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Bad
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>func</span> <span style=color:#00b1f7>isEmpty</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>s</span> <span style=color:#abb2bf>[]</span><span style=color:#e5c07b>string</span><span style=color:#abb2bf>)</span> <span style=color:#e5c07b>bool</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>return</span> <span style=color:#aa89ea>s</span> <span style=color:#54b1c7>==</span> <span style=color:#e5c07b>nil</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Good
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>func</span> <span style=color:#00b1f7>isEmpty</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>s</span> <span style=color:#abb2bf>[]</span><span style=color:#e5c07b>string</span><span style=color:#abb2bf>)</span> <span style=color:#e5c07b>bool</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>return</span> <span style=color:#e5c07b>len</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>s</span><span style=color:#abb2bf>)</span> <span style=color:#54b1c7>==</span> <span style=color:#d19a66>0</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>The zero value (a slice declared with <code>var</code>) is usable immediately without <code>make()</code>.</p><p>​ 零值（使用 <code>var</code> 声明的切片）可以直接使用，而无需 <code>make()</code> 。</p><div class=highlight><div style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">11
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Bad
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#aa89ea>nums</span> <span style=color:#54b1c7>:=</span> <span style=color:#abb2bf>[]</span><span style=color:#e5c07b>int</span><span style=color:#abb2bf>{}</span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// or, nums := make([]int)
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>if</span> <span style=color:#aa89ea>add1</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>nums</span> <span style=color:#abb2bf>=</span> <span style=color:#e5c07b>append</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>nums</span><span style=color:#abb2bf>,</span> <span style=color:#d19a66>1</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>if</span> <span style=color:#aa89ea>add2</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>nums</span> <span style=color:#abb2bf>=</span> <span style=color:#e5c07b>append</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>nums</span><span style=color:#abb2bf>,</span> <span style=color:#d19a66>2</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">10
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Good
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>var</span> <span style=color:#aa89ea>nums</span> <span style=color:#abb2bf>[]</span><span style=color:#e5c07b>int</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>if</span> <span style=color:#aa89ea>add1</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>nums</span> <span style=color:#abb2bf>=</span> <span style=color:#e5c07b>append</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>nums</span><span style=color:#abb2bf>,</span> <span style=color:#d19a66>1</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>if</span> <span style=color:#aa89ea>add2</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>nums</span> <span style=color:#abb2bf>=</span> <span style=color:#e5c07b>append</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>nums</span><span style=color:#abb2bf>,</span> <span style=color:#d19a66>2</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span></code></pre></td></tr></table></div></div></li></ul><p>Remember that, while it is a valid slice, a nil slice is not equivalent to an allocated slice of length 0 - one is nil and the other is not - and the two may be treated differently in different situations (such as serialization).</p><p>​ 请记住，虽然它是有效的切片，但 nil 切片不等于长度为 0 的已分配切片——一个是 nil，另一个不是——并且在不同情况下（例如序列化）可能会对它们进行不同的处理。</p><h3 id=reduce-scope-of-variables-减少变量的作用域>Reduce Scope of Variables 减少变量的作用域</h3><p>Where possible, reduce scope of variables. Do not reduce the scope if it conflicts with <a href=https://github.com/uber-go/guide/blob/master/style.md#reduce-nesting>Reduce Nesting</a>.</p><p>​ 尽可能减少变量的作用域。如果与减少嵌套冲突，请不要减少作用域。</p><div class=highlight><div style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Bad
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#aa89ea>err</span> <span style=color:#54b1c7>:=</span> <span style=color:#aa89ea>os</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>WriteFile</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>name</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>data</span><span style=color:#abb2bf>,</span> <span style=color:#d19a66>0644</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>if</span> <span style=color:#aa89ea>err</span> <span style=color:#54b1c7>!=</span> <span style=color:#e5c07b>nil</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span> <span style=color:#76a9f9>return</span> <span style=color:#aa89ea>err</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Good
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>if</span> <span style=color:#aa89ea>err</span> <span style=color:#54b1c7>:=</span> <span style=color:#aa89ea>os</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>WriteFile</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>name</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>data</span><span style=color:#abb2bf>,</span> <span style=color:#d19a66>0644</span><span style=color:#abb2bf>);</span> <span style=color:#aa89ea>err</span> <span style=color:#54b1c7>!=</span> <span style=color:#e5c07b>nil</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span> <span style=color:#76a9f9>return</span> <span style=color:#aa89ea>err</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span></code></pre></td></tr></table></div></div><p>If you need a result of a function call outside of the if, then you should not try to reduce the scope.</p><p>​ 如果您需要在 if 之外使用函数调用的结果，那么您不应该尝试减少作用域。</p><div class=highlight><div style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">24
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Bad
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>if</span> <span style=color:#aa89ea>data</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>err</span> <span style=color:#54b1c7>:=</span> <span style=color:#aa89ea>os</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>ReadFile</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>name</span><span style=color:#abb2bf>);</span> <span style=color:#aa89ea>err</span> <span style=color:#54b1c7>==</span> <span style=color:#e5c07b>nil</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>err</span> <span style=color:#abb2bf>=</span> <span style=color:#aa89ea>cfg</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Decode</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>data</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>if</span> <span style=color:#aa89ea>err</span> <span style=color:#54b1c7>!=</span> <span style=color:#e5c07b>nil</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#76a9f9>return</span> <span style=color:#aa89ea>err</span>
</span></span><span style=display:flex><span>  <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>fmt</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Println</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>cfg</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>return</span> <span style=color:#e5c07b>nil</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span> <span style=color:#76a9f9>else</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>return</span> <span style=color:#aa89ea>err</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Good
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#aa89ea>data</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>err</span> <span style=color:#54b1c7>:=</span> <span style=color:#aa89ea>os</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>ReadFile</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>name</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>if</span> <span style=color:#aa89ea>err</span> <span style=color:#54b1c7>!=</span> <span style=color:#e5c07b>nil</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>   <span style=color:#76a9f9>return</span> <span style=color:#aa89ea>err</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>if</span> <span style=color:#aa89ea>err</span> <span style=color:#54b1c7>:=</span> <span style=color:#aa89ea>cfg</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Decode</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>data</span><span style=color:#abb2bf>);</span> <span style=color:#aa89ea>err</span> <span style=color:#54b1c7>!=</span> <span style=color:#e5c07b>nil</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>return</span> <span style=color:#aa89ea>err</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>fmt</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Println</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>cfg</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>return</span> <span style=color:#e5c07b>nil</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=avoid-naked-parameters-避免裸参数>Avoid Naked Parameters 避免裸参数</h3><p>Naked parameters in function calls can hurt readability. Add C-style comments (<code>/* ... */</code>) for parameter names when their meaning is not obvious.</p><p>​ 函数调用中的裸参数可能会损害可读性。当参数的含义不明显时，请为参数名称添加 C 样式注释（ <code>/* ... */</code> ）。</p><div class=highlight><div style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Bad
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// func printInfo(name string, isLocal, done bool)
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#00b1f7>printInfo</span><span style=color:#abb2bf>(</span><span style=color:#98c379>&#34;foo&#34;</span><span style=color:#abb2bf>,</span> <span style=color:#e5c07b>true</span><span style=color:#abb2bf>,</span> <span style=color:#e5c07b>true</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Good
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// func printInfo(name string, isLocal, done bool)
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#00b1f7>printInfo</span><span style=color:#abb2bf>(</span><span style=color:#98c379>&#34;foo&#34;</span><span style=color:#abb2bf>,</span> <span style=color:#e5c07b>true</span> <span style=color:#8a93a5;font-style:italic>/* isLocal */</span><span style=color:#abb2bf>,</span> <span style=color:#e5c07b>true</span> <span style=color:#8a93a5;font-style:italic>/* done */</span><span style=color:#abb2bf>)</span>
</span></span></code></pre></td></tr></table></div></div><p>Better yet, replace naked <code>bool</code> types with custom types for more readable and type-safe code. This allows more than just two states (true/false) for that parameter in the future.</p><p>​ 更好的是，用自定义类型替换裸 <code>bool</code> 类型，以获得更具可读性和类型安全性的代码。这允许该参数在未来具有不止两种状态（真/假）。</p><div class=highlight><div style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">16
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#76a9f9>type</span> <span style=color:#aa89ea>Region</span> <span style=color:#e5c07b>int</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>const</span> <span style=color:#abb2bf>(</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>UnknownRegion</span> <span style=color:#aa89ea>Region</span> <span style=color:#abb2bf>=</span> <span style=color:#e5c07b>iota</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>Local</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>type</span> <span style=color:#aa89ea>Status</span> <span style=color:#e5c07b>int</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>const</span> <span style=color:#abb2bf>(</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>StatusReady</span> <span style=color:#aa89ea>Status</span> <span style=color:#abb2bf>=</span> <span style=color:#e5c07b>iota</span> <span style=color:#54b1c7>+</span> <span style=color:#d19a66>1</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>StatusDone</span>
</span></span><span style=display:flex><span>  <span style=color:#8a93a5;font-style:italic>// Maybe we will have a StatusInProgress in the future.
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>func</span> <span style=color:#00b1f7>printInfo</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>name</span> <span style=color:#e5c07b>string</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>region</span> <span style=color:#aa89ea>Region</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>status</span> <span style=color:#aa89ea>Status</span><span style=color:#abb2bf>)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=use-raw-string-literals-to-avoid-escaping-使用原始字符串字面量避免转义>Use Raw String Literals to Avoid Escaping 使用原始字符串字面量避免转义</h3><p>Go supports <a href=https://golang.org/ref/spec#raw_string_lit>raw string literals</a>, which can span multiple lines and include quotes. Use these to avoid hand-escaped strings which are much harder to read.</p><p>​ Go 支持原始字符串字面量，它可以跨越多行并包含引号。使用这些来避免手动转义的字符串，这些字符串更难阅读。</p><div class=highlight><div style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Bad
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#aa89ea>wantError</span> <span style=color:#54b1c7>:=</span> <span style=color:#98c379>&#34;unknown name:\&#34;test\&#34;&#34;</span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Good
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#aa89ea>wantError</span> <span style=color:#54b1c7>:=</span> <span style=color:#98c379>`unknown error:&#34;test&#34;`</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=initializing-structs-初始化结构体>Initializing Structs 初始化结构体</h3><h4 id=use-field-names-to-initialize-structs-使用字段名初始化结构体>Use Field Names to Initialize Structs 使用字段名初始化结构体</h4><p>You should almost always specify field names when initializing structs. This is now enforced by <a href=https://golang.org/cmd/vet/><code>go vet</code></a>.</p><p>​ 初始化结构体时，您几乎应该始终指定字段名。现在由 <code>go vet</code> 强制执行。</p><div class=highlight><div style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Bad
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#aa89ea>k</span> <span style=color:#54b1c7>:=</span> <span style=color:#aa89ea>User</span><span style=color:#abb2bf>{</span><span style=color:#98c379>&#34;John&#34;</span><span style=color:#abb2bf>,</span> <span style=color:#98c379>&#34;Doe&#34;</span><span style=color:#abb2bf>,</span> <span style=color:#e5c07b>true</span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Good
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#aa89ea>k</span> <span style=color:#54b1c7>:=</span> <span style=color:#aa89ea>User</span><span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>FirstName</span><span style=color:#abb2bf>:</span> <span style=color:#98c379>&#34;John&#34;</span><span style=color:#abb2bf>,</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>LastName</span><span style=color:#abb2bf>:</span> <span style=color:#98c379>&#34;Doe&#34;</span><span style=color:#abb2bf>,</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>Admin</span><span style=color:#abb2bf>:</span> <span style=color:#e5c07b>true</span><span style=color:#abb2bf>,</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span></code></pre></td></tr></table></div></div><p>Exception: Field names <em>may</em> be omitted in test tables when there are 3 or fewer fields.</p><p>​ 例外：当字段少于或等于 3 个时，可以在测试表中省略字段名。</p><pre tabindex=0><code>tests := []struct{
  op Operation
  want string
}{
  {Add, &#34;add&#34;},
  {Subtract, &#34;subtract&#34;},
}
</code></pre><h4 id=omit-zero-value-fields-in-structs-在结构体中省略零值字段>Omit Zero Value Fields in Structs 在结构体中省略零值字段</h4><p>When initializing structs with field names, omit fields that have zero values unless they provide meaningful context. Otherwise, let Go set these to zero values automatically.</p><p>​ 使用字段名初始化结构体时，省略具有零值的字段，除非它们提供有意义的上下文。否则，让 Go 自动将这些字段设置为零值。</p><div class=highlight><div style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">12
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Bad
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#aa89ea>user</span> <span style=color:#54b1c7>:=</span> <span style=color:#aa89ea>User</span><span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>FirstName</span><span style=color:#abb2bf>:</span> <span style=color:#98c379>&#34;John&#34;</span><span style=color:#abb2bf>,</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>LastName</span><span style=color:#abb2bf>:</span> <span style=color:#98c379>&#34;Doe&#34;</span><span style=color:#abb2bf>,</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>MiddleName</span><span style=color:#abb2bf>:</span> <span style=color:#98c379>&#34;&#34;</span><span style=color:#abb2bf>,</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>Admin</span><span style=color:#abb2bf>:</span> <span style=color:#e5c07b>false</span><span style=color:#abb2bf>,</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Good
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#aa89ea>user</span> <span style=color:#54b1c7>:=</span> <span style=color:#aa89ea>User</span><span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>FirstName</span><span style=color:#abb2bf>:</span> <span style=color:#98c379>&#34;John&#34;</span><span style=color:#abb2bf>,</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>LastName</span><span style=color:#abb2bf>:</span> <span style=color:#98c379>&#34;Doe&#34;</span><span style=color:#abb2bf>,</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span></code></pre></td></tr></table></div></div><p>This helps reduce noise for readers by omitting values that are default in that context. Only meaningful values are specified.</p><p>​ 这有助于通过省略在该上下文中为默认值的字段来减少阅读者的干扰。只指定有意义的值。</p><p>Include zero values where field names provide meaningful context. For example, test cases in <a href=https://github.com/uber-go/guide/blob/master/style.md#test-tables>Test Tables</a> can benefit from names of fields even when they are zero-valued.</p><p>​ 在字段名提供有意义的上下文时包含零值。例如，测试表中的测试用例即使在为零值时也能从字段名中受益。</p><pre tabindex=0><code>tests := []struct{
  give string
  want int
}{
  {give: &#34;0&#34;, want: 0},
  // ...
}
</code></pre><h4 id=use-var-for-zero-value-structs-使用-var-表示零值结构>Use <code>var</code> for Zero Value Structs 使用 <code>var</code> 表示零值结构</h4><p>When all the fields of a struct are omitted in a declaration, use the <code>var</code> form to declare the struct.</p><p>​ 如果声明中省略了结构的所有字段，请使用 <code>var</code> 形式来声明结构。</p><div class=highlight><div style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Bad
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#aa89ea>user</span> <span style=color:#54b1c7>:=</span> <span style=color:#aa89ea>User</span><span style=color:#abb2bf>{}</span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>var</span> <span style=color:#aa89ea>user</span> <span style=color:#aa89ea>User</span>
</span></span></code></pre></td></tr></table></div></div><p>This differentiates zero valued structs from those with non-zero fields similar to the distinction created for <a href=https://github.com/uber-go/guide/blob/master/style.md#initializing-maps>map initialization</a>, and matches how we prefer to <a href=https://github.com/golang/go/wiki/CodeReviewComments#declaring-empty-slices>declare empty slices</a>.</p><p>​ 这将零值结构与具有非零字段的结构区分开来，类似于为映射初始化创建的区分，并且与我们更喜欢声明空切片的方式相匹配。</p><h4 id=initializing-struct-references-初始化结构引用>Initializing Struct References 初始化结构引用</h4><p>Use <code>&amp;T{}</code> instead of <code>new(T)</code> when initializing struct references so that it is consistent with the struct initialization.</p><p>​ 在初始化结构引用时使用 <code>&amp;T{}</code> 而不是 <code>new(T)</code> ，以便与结构初始化保持一致。</p><div class=highlight><div style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">10
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Bad
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#aa89ea>sval</span> <span style=color:#54b1c7>:=</span> <span style=color:#aa89ea>T</span><span style=color:#abb2bf>{</span><span style=color:#aa89ea>Name</span><span style=color:#abb2bf>:</span> <span style=color:#98c379>&#34;foo&#34;</span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// inconsistent
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#aa89ea>sptr</span> <span style=color:#54b1c7>:=</span> <span style=color:#e5c07b>new</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>T</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>sptr</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>Name</span> <span style=color:#abb2bf>=</span> <span style=color:#98c379>&#34;bar&#34;</span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Good
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#aa89ea>sval</span> <span style=color:#54b1c7>:=</span> <span style=color:#aa89ea>T</span><span style=color:#abb2bf>{</span><span style=color:#aa89ea>Name</span><span style=color:#abb2bf>:</span> <span style=color:#98c379>&#34;foo&#34;</span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>sptr</span> <span style=color:#54b1c7>:=</span> <span style=color:#54b1c7>&amp;</span><span style=color:#aa89ea>T</span><span style=color:#abb2bf>{</span><span style=color:#aa89ea>Name</span><span style=color:#abb2bf>:</span> <span style=color:#98c379>&#34;bar&#34;</span><span style=color:#abb2bf>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=initializing-maps-初始化映射>Initializing Maps 初始化映射</h3><p>Prefer <code>make(..)</code> for empty maps, and maps populated programmatically. This makes map initialization visually distinct from declaration, and it makes it easy to add size hints later if available.</p><p>​ 对于空映射和以编程方式填充的映射，更喜欢使用 <code>make(..)</code> 。这使得映射初始化在视觉上与声明不同，并且如果以后有可用的大小提示，则可以轻松添加。</p><ul><li>Declaration and initialization are visually similar.
声明和初始化在视觉上相似。</li></ul><div class=highlight><div style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Bad
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>var</span> <span style=color:#abb2bf>(</span>
</span></span><span style=display:flex><span>  <span style=color:#8a93a5;font-style:italic>// m1 is safe to read and write;
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>  <span style=color:#8a93a5;font-style:italic>// m2 will panic on writes.
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>  <span style=color:#aa89ea>m1</span> <span style=color:#abb2bf>=</span> <span style=color:#76a9f9>map</span><span style=color:#abb2bf>[</span><span style=color:#aa89ea>T1</span><span style=color:#abb2bf>]</span><span style=color:#aa89ea>T2</span><span style=color:#abb2bf>{}</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>m2</span> <span style=color:#76a9f9>map</span><span style=color:#abb2bf>[</span><span style=color:#aa89ea>T1</span><span style=color:#abb2bf>]</span><span style=color:#aa89ea>T2</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>)</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>Declaration and initialization are visually distinct.
声明和初始化在视觉上不同。</li></ul><div class=highlight><div style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Good
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>var</span> <span style=color:#abb2bf>(</span>
</span></span><span style=display:flex><span>  <span style=color:#8a93a5;font-style:italic>// m1 is safe to read and write;
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>  <span style=color:#8a93a5;font-style:italic>// m2 will panic on writes.
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>  <span style=color:#aa89ea>m1</span> <span style=color:#abb2bf>=</span> <span style=color:#e5c07b>make</span><span style=color:#abb2bf>(</span><span style=color:#76a9f9>map</span><span style=color:#abb2bf>[</span><span style=color:#aa89ea>T1</span><span style=color:#abb2bf>]</span><span style=color:#aa89ea>T2</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>m2</span> <span style=color:#76a9f9>map</span><span style=color:#abb2bf>[</span><span style=color:#aa89ea>T1</span><span style=color:#abb2bf>]</span><span style=color:#aa89ea>T2</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>)</span>
</span></span></code></pre></td></tr></table></div></div><p>Where possible, provide capacity hints when initializing maps with <code>make()</code>. See <a href=https://github.com/uber-go/guide/blob/master/style.md#specifying-map-capacity-hints>Specifying Map Capacity Hints</a> for more information.</p><p>​ 如果可能，请在使用 <code>make()</code> 初始化映射时提供容量提示。有关更多信息，请参阅指定映射容量提示。</p><p>On the other hand, if the map holds a fixed list of elements, use map literals to initialize the map.</p><p>​ 另一方面，如果映射包含固定元素列表，请使用映射字面量来初始化映射。</p><div class=highlight><div style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">11
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Bad
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#aa89ea>m</span> <span style=color:#54b1c7>:=</span> <span style=color:#e5c07b>make</span><span style=color:#abb2bf>(</span><span style=color:#76a9f9>map</span><span style=color:#abb2bf>[</span><span style=color:#aa89ea>T1</span><span style=color:#abb2bf>]</span><span style=color:#aa89ea>T2</span><span style=color:#abb2bf>,</span> <span style=color:#d19a66>3</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>m</span><span style=color:#abb2bf>[</span><span style=color:#aa89ea>k1</span><span style=color:#abb2bf>]</span> <span style=color:#abb2bf>=</span> <span style=color:#aa89ea>v1</span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>m</span><span style=color:#abb2bf>[</span><span style=color:#aa89ea>k2</span><span style=color:#abb2bf>]</span> <span style=color:#abb2bf>=</span> <span style=color:#aa89ea>v2</span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>m</span><span style=color:#abb2bf>[</span><span style=color:#aa89ea>k3</span><span style=color:#abb2bf>]</span> <span style=color:#abb2bf>=</span> <span style=color:#aa89ea>v3</span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Good
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#aa89ea>m</span> <span style=color:#54b1c7>:=</span> <span style=color:#76a9f9>map</span><span style=color:#abb2bf>[</span><span style=color:#aa89ea>T1</span><span style=color:#abb2bf>]</span><span style=color:#aa89ea>T2</span><span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>k1</span><span style=color:#abb2bf>:</span> <span style=color:#aa89ea>v1</span><span style=color:#abb2bf>,</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>k2</span><span style=color:#abb2bf>:</span> <span style=color:#aa89ea>v2</span><span style=color:#abb2bf>,</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>k3</span><span style=color:#abb2bf>:</span> <span style=color:#aa89ea>v3</span><span style=color:#abb2bf>,</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span></code></pre></td></tr></table></div></div><p>The basic rule of thumb is to use map literals when adding a fixed set of elements at initialization time, otherwise use <code>make</code> (and specify a size hint if available).</p><p>​ 基本经验法则是，在初始化时添加固定元素集时使用映射字面量，否则使用 <code>make</code> （如果可用，请指定大小提示）。</p><h3 id=format-strings-outside-printf-printf-之外的格式字符串>Format Strings outside Printf Printf 之外的格式字符串</h3><p>If you declare format strings for <code>Printf</code>-style functions outside a string literal, make them <code>const</code> values.</p><p>​ 如果您在字符串字面量之外为 <code>Printf</code> 样式函数声明格式字符串，请使其成为 <code>const</code> 值。</p><p>This helps <code>go vet</code> perform static analysis of the format string.</p><p>​ 这有助于 <code>go vet</code> 对格式字符串执行静态分析。</p><div class=highlight><div style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">6
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Bad
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#aa89ea>msg</span> <span style=color:#54b1c7>:=</span> <span style=color:#98c379>&#34;unexpected values %v, %v\n&#34;</span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>fmt</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Printf</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>msg</span><span style=color:#abb2bf>,</span> <span style=color:#d19a66>1</span><span style=color:#abb2bf>,</span> <span style=color:#d19a66>2</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Good
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>const</span> <span style=color:#aa89ea>msg</span> <span style=color:#abb2bf>=</span> <span style=color:#98c379>&#34;unexpected values %v, %v\n&#34;</span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>fmt</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Printf</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>msg</span><span style=color:#abb2bf>,</span> <span style=color:#d19a66>1</span><span style=color:#abb2bf>,</span> <span style=color:#d19a66>2</span><span style=color:#abb2bf>)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=naming-printf-style-functions-命名-printf-样式函数>Naming Printf-style Functions 命名 Printf 样式函数</h3><p>When you declare a <code>Printf</code>-style function, make sure that <code>go vet</code> can detect it and check the format string.</p><p>​ 当您声明 <code>Printf</code> 样式函数时，请确保 <code>go vet</code> 可以检测到它并检查格式字符串。</p><p>This means that you should use predefined <code>Printf</code>-style function names if possible. <code>go vet</code> will check these by default. See <a href=https://golang.org/cmd/vet/#hdr-Printf_family>Printf family</a> for more information.</p><p>​ 这意味着您应该尽可能使用预定义的 <code>Printf</code> 样式函数名称。 <code>go vet</code> 将默认检查这些名称。有关更多信息，请参阅 Printf 系列。</p><p>If using the predefined names is not an option, end the name you choose with f: <code>Wrapf</code>, not <code>Wrap</code>. <code>go vet</code> can be asked to check specific <code>Printf</code>-style names but they must end with f.</p><p>​ 如果使用预定义名称不是一种选择，请以 f 结尾： <code>Wrapf</code> ，而不是 <code>Wrap</code> 。可以要求 <code>go vet</code> 检查特定的 <code>Printf</code> 样式名称，但它们必须以 f 结尾。</p><pre tabindex=0><code>go vet -printfuncs=wrapf,statusf
</code></pre><p>See also <a href=https://kuzminva.wordpress.com/2017/11/07/go-vet-printf-family-check/>go vet: Printf family check</a>.</p><p>​ 另请参阅 go vet：Printf 系列检查。</p><h2 id=patterns-模式>Patterns 模式</h2><h3 id=test-tables-测试表>Test Tables 测试表</h3><p>Table-driven tests with <a href=https://blog.golang.org/subtests>subtests</a> can be a helpful pattern for writing tests to avoid duplicating code when the core test logic is repetitive.</p><p>​ 具有子测试的表驱动测试可以成为编写测试的有用模式，以避免在核心测试逻辑重复时复制代码。</p><p>If a system under test needs to be tested against <em>multiple conditions</em> where certain parts of the the inputs and outputs change, a table-driven test should be used to reduce redundancy and improve readability.</p><p>​ 如果需要针对某些输入和输出部分发生变化的多种条件对被测系统进行测试，则应使用表驱动测试来减少冗余并提高可读性。</p><div class=highlight><div style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">60
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Bad
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// func TestSplitHostPort(t *testing.T)
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>host</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>port</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>err</span> <span style=color:#54b1c7>:=</span> <span style=color:#aa89ea>net</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>SplitHostPort</span><span style=color:#abb2bf>(</span><span style=color:#98c379>&#34;192.0.2.0:8000&#34;</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>require</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>NoError</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>t</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>err</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>assert</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Equal</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>t</span><span style=color:#abb2bf>,</span> <span style=color:#98c379>&#34;192.0.2.0&#34;</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>host</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>assert</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Equal</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>t</span><span style=color:#abb2bf>,</span> <span style=color:#98c379>&#34;8000&#34;</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>port</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>host</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>port</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>err</span> <span style=color:#abb2bf>=</span> <span style=color:#aa89ea>net</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>SplitHostPort</span><span style=color:#abb2bf>(</span><span style=color:#98c379>&#34;192.0.2.0:http&#34;</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>require</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>NoError</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>t</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>err</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>assert</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Equal</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>t</span><span style=color:#abb2bf>,</span> <span style=color:#98c379>&#34;192.0.2.0&#34;</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>host</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>assert</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Equal</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>t</span><span style=color:#abb2bf>,</span> <span style=color:#98c379>&#34;http&#34;</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>port</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>host</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>port</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>err</span> <span style=color:#abb2bf>=</span> <span style=color:#aa89ea>net</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>SplitHostPort</span><span style=color:#abb2bf>(</span><span style=color:#98c379>&#34;:8000&#34;</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>require</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>NoError</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>t</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>err</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>assert</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Equal</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>t</span><span style=color:#abb2bf>,</span> <span style=color:#98c379>&#34;&#34;</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>host</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>assert</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Equal</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>t</span><span style=color:#abb2bf>,</span> <span style=color:#98c379>&#34;8000&#34;</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>port</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>host</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>port</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>err</span> <span style=color:#abb2bf>=</span> <span style=color:#aa89ea>net</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>SplitHostPort</span><span style=color:#abb2bf>(</span><span style=color:#98c379>&#34;1:8&#34;</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>require</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>NoError</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>t</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>err</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>assert</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Equal</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>t</span><span style=color:#abb2bf>,</span> <span style=color:#98c379>&#34;1&#34;</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>host</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>assert</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Equal</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>t</span><span style=color:#abb2bf>,</span> <span style=color:#98c379>&#34;8&#34;</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>port</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Good
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// func TestSplitHostPort(t *testing.T)
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>tests</span> <span style=color:#54b1c7>:=</span> <span style=color:#abb2bf>[]</span><span style=color:#76a9f9>struct</span><span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>give</span>     <span style=color:#e5c07b>string</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>wantHost</span> <span style=color:#e5c07b>string</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>wantPort</span> <span style=color:#e5c07b>string</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}{</span>
</span></span><span style=display:flex><span>  <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>give</span><span style=color:#abb2bf>:</span>     <span style=color:#98c379>&#34;192.0.2.0:8000&#34;</span><span style=color:#abb2bf>,</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>wantHost</span><span style=color:#abb2bf>:</span> <span style=color:#98c379>&#34;192.0.2.0&#34;</span><span style=color:#abb2bf>,</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>wantPort</span><span style=color:#abb2bf>:</span> <span style=color:#98c379>&#34;8000&#34;</span><span style=color:#abb2bf>,</span>
</span></span><span style=display:flex><span>  <span style=color:#abb2bf>},</span>
</span></span><span style=display:flex><span>  <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>give</span><span style=color:#abb2bf>:</span>     <span style=color:#98c379>&#34;192.0.2.0:http&#34;</span><span style=color:#abb2bf>,</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>wantHost</span><span style=color:#abb2bf>:</span> <span style=color:#98c379>&#34;192.0.2.0&#34;</span><span style=color:#abb2bf>,</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>wantPort</span><span style=color:#abb2bf>:</span> <span style=color:#98c379>&#34;http&#34;</span><span style=color:#abb2bf>,</span>
</span></span><span style=display:flex><span>  <span style=color:#abb2bf>},</span>
</span></span><span style=display:flex><span>  <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>give</span><span style=color:#abb2bf>:</span>     <span style=color:#98c379>&#34;:8000&#34;</span><span style=color:#abb2bf>,</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>wantHost</span><span style=color:#abb2bf>:</span> <span style=color:#98c379>&#34;&#34;</span><span style=color:#abb2bf>,</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>wantPort</span><span style=color:#abb2bf>:</span> <span style=color:#98c379>&#34;8000&#34;</span><span style=color:#abb2bf>,</span>
</span></span><span style=display:flex><span>  <span style=color:#abb2bf>},</span>
</span></span><span style=display:flex><span>  <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>give</span><span style=color:#abb2bf>:</span>     <span style=color:#98c379>&#34;1:8&#34;</span><span style=color:#abb2bf>,</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>wantHost</span><span style=color:#abb2bf>:</span> <span style=color:#98c379>&#34;1&#34;</span><span style=color:#abb2bf>,</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>wantPort</span><span style=color:#abb2bf>:</span> <span style=color:#98c379>&#34;8&#34;</span><span style=color:#abb2bf>,</span>
</span></span><span style=display:flex><span>  <span style=color:#abb2bf>},</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>for</span> <span style=color:#aa89ea>_</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>tt</span> <span style=color:#54b1c7>:=</span> <span style=color:#76a9f9>range</span> <span style=color:#aa89ea>tests</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>t</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Run</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>tt</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>give</span><span style=color:#abb2bf>,</span> <span style=color:#76a9f9>func</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>t</span> <span style=color:#54b1c7>*</span><span style=color:#aa89ea>testing</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>T</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>host</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>port</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>err</span> <span style=color:#54b1c7>:=</span> <span style=color:#aa89ea>net</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>SplitHostPort</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>tt</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>give</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>require</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>NoError</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>t</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>err</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>assert</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Equal</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>t</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>tt</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>wantHost</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>host</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>assert</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Equal</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>t</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>tt</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>wantPort</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>port</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>  <span style=color:#abb2bf>})</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span></code></pre></td></tr></table></div></div><p>Test tables make it easier to add context to error messages, reduce duplicate logic, and add new test cases.</p><p>​ 测试表使添加上下文到错误消息、减少重复逻辑和添加新测试用例变得更加容易。</p><p>We follow the convention that the slice of structs is referred to as <code>tests</code> and each test case <code>tt</code>. Further, we encourage explicating the input and output values for each test case with <code>give</code> and <code>want</code> prefixes.</p><p>​ 我们遵循将结构切片称为 <code>tests</code> 和每个测试用例 <code>tt</code> 的约定。此外，我们鼓励使用 <code>give</code> 和 <code>want</code> 前缀明确说明每个测试用例的输入和输出值。</p><pre tabindex=0><code>tests := []struct{
  give     string
  wantHost string
  wantPort string
}{
  // ...
}

for _, tt := range tests {
  // ...
}
</code></pre><h4 id=avoid-unnecessary-complexity-in-table-tests-避免在表测试中出现不必要的复杂性>Avoid Unnecessary Complexity in Table Tests 避免在表测试中出现不必要的复杂性</h4><p>Table tests can be difficult to read and maintain if the subtests contain conditional assertions or other branching logic. Table tests should <strong>NOT</strong> be used whenever there needs to be complex or conditional logic inside subtests (i.e. complex logic inside the <code>for</code> loop).</p><p>​ 如果子测试包含条件断言或其他分支逻辑，则表测试可能难以阅读和维护。每当子测试中需要复杂或条件逻辑（即 <code>for</code> 循环内的复杂逻辑）时，都不应使用表测试。</p><p>Large, complex table tests harm readability and maintainability because test readers may have difficulty debugging test failures that occur.</p><p>​ 大型、复杂的表测试会损害可读性和可维护性，因为测试阅读器可能难以调试发生的测试失败。</p><p>Table tests like this should be split into either multiple test tables or multiple individual <code>Test...</code> functions.</p><p>​ 像这样的表格测试应该拆分为多个测试表格或多个单独的 <code>Test...</code> 函数。</p><p>Some ideals to aim for are:</p><p>​ 一些要达到的理想目标是：</p><ul><li>Focus on the narrowest unit of behavior
关注最窄的行为单元</li><li>Minimize “test depth”, and avoid conditional assertions (see below)
最小化“测试深度”，并避免条件断言（见下文）</li><li>Ensure that all table fields are used in all tests
确保所有表格字段在所有测试中都使用</li><li>Ensure that all test logic runs for all table cases
确保所有测试逻辑对所有表格用例都运行</li></ul><p>In this context, “test depth” means “within a given test, the number of successive assertions that require previous assertions to hold” (similar to cyclomatic complexity). Having “shallower” tests means that there are fewer relationships between assertions and, more importantly, that those assertions are less likely to be conditional by default.</p><p>​ 在此上下文中，“测试深度”是指“在给定测试中，需要先前的断言成立的连续断言的数量”（类似于圈复杂度）。进行“较浅”的测试意味着断言之间的关系更少，更重要的是，这些断言默认情况下不太可能是有条件的。</p><p>Concretely, table tests can become confusing and difficult to read if they use multiple branching pathways (e.g. <code>shouldError</code>, <code>expectCall</code>, etc.), use many <code>if</code> statements for specific mock expectations (e.g. <code>shouldCallFoo</code>), or place functions inside the table (e.g. <code>setupMocks func(*FooMock)</code>).</p><p>​ 具体来说，如果表格测试使用多个分支路径（例如 <code>shouldError</code> 、 <code>expectCall</code> 等），对特定模拟期望使用许多 <code>if</code> 语句（例如 <code>shouldCallFoo</code> ），或在表格中放置函数（例如 <code>setupMocks func(*FooMock)</code> ），则表格测试可能会变得混乱且难以阅读。</p><p>However, when testing behavior that only changes based on changed input, it may be preferable to group similar cases together in a table test to better illustrate how behavior changes across all inputs, rather than splitting otherwise comparable units into separate tests and making them harder to compare and contrast.</p><p>​ 然而，在测试仅基于更改的输入而更改的行为时，最好将类似的情况组合在一个表测试中，以更好地说明行为如何跨所有输入发生变化，而不是将其他可比较的单元拆分为单独的测试，并使它们更难比较和对比。</p><p>If the test body is short and straightforward, it’s acceptable to have a single branching pathway for success versus failure cases with a table field like <code>shouldErr</code> to specify error expectations.</p><p>​ 如果测试主体简短且直接，则可以接受为成功与失败案例提供一个分支路径，并使用 <code>shouldErr</code> 之类的表字段来指定错误预期。</p><div class=highlight><div style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">71
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Bad
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>func</span> <span style=color:#00b1f7>TestComplicatedTable</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>t</span> <span style=color:#54b1c7>*</span><span style=color:#aa89ea>testing</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>T</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>tests</span> <span style=color:#54b1c7>:=</span> <span style=color:#abb2bf>[]</span><span style=color:#76a9f9>struct</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>give</span>          <span style=color:#e5c07b>string</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>want</span>          <span style=color:#e5c07b>string</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>wantErr</span>       <span style=color:#e5c07b>error</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>shouldCallX</span>   <span style=color:#e5c07b>bool</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>shouldCallY</span>   <span style=color:#e5c07b>bool</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>giveXResponse</span> <span style=color:#e5c07b>string</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>giveXErr</span>      <span style=color:#e5c07b>error</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>giveYResponse</span> <span style=color:#e5c07b>string</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>giveYErr</span>      <span style=color:#e5c07b>error</span>
</span></span><span style=display:flex><span>  <span style=color:#abb2bf>}{</span>
</span></span><span style=display:flex><span>    <span style=color:#8a93a5;font-style:italic>// ...
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>  <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>for</span> <span style=color:#aa89ea>_</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>tt</span> <span style=color:#54b1c7>:=</span> <span style=color:#76a9f9>range</span> <span style=color:#aa89ea>tests</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>t</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Run</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>tt</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>give</span><span style=color:#abb2bf>,</span> <span style=color:#76a9f9>func</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>t</span> <span style=color:#54b1c7>*</span><span style=color:#aa89ea>testing</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>T</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>      <span style=color:#8a93a5;font-style:italic>// setup mocks
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>      <span style=color:#aa89ea>ctrl</span> <span style=color:#54b1c7>:=</span> <span style=color:#aa89ea>gomock</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>NewController</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>t</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>      <span style=color:#aa89ea>xMock</span> <span style=color:#54b1c7>:=</span> <span style=color:#aa89ea>xmock</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>NewMockX</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>ctrl</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>      <span style=color:#76a9f9>if</span> <span style=color:#aa89ea>tt</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>shouldCallX</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>        <span style=color:#aa89ea>xMock</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>EXPECT</span><span style=color:#abb2bf>().</span><span style=color:#00b1f7>Call</span><span style=color:#abb2bf>().</span><span style=color:#00b1f7>Return</span><span style=color:#abb2bf>(</span>
</span></span><span style=display:flex><span>          <span style=color:#aa89ea>tt</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>giveXResponse</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>tt</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>giveXErr</span><span style=color:#abb2bf>,</span>
</span></span><span style=display:flex><span>        <span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>      <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>      <span style=color:#aa89ea>yMock</span> <span style=color:#54b1c7>:=</span> <span style=color:#aa89ea>ymock</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>NewMockY</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>ctrl</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>      <span style=color:#76a9f9>if</span> <span style=color:#aa89ea>tt</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>shouldCallY</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>        <span style=color:#aa89ea>yMock</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>EXPECT</span><span style=color:#abb2bf>().</span><span style=color:#00b1f7>Call</span><span style=color:#abb2bf>().</span><span style=color:#00b1f7>Return</span><span style=color:#abb2bf>(</span>
</span></span><span style=display:flex><span>          <span style=color:#aa89ea>tt</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>giveYResponse</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>tt</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>giveYErr</span><span style=color:#abb2bf>,</span>
</span></span><span style=display:flex><span>        <span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>      <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#aa89ea>got</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>err</span> <span style=color:#54b1c7>:=</span> <span style=color:#00b1f7>DoComplexThing</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>tt</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>give</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>xMock</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>yMock</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#8a93a5;font-style:italic>// verify results
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>      <span style=color:#76a9f9>if</span> <span style=color:#aa89ea>tt</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>wantErr</span> <span style=color:#54b1c7>!=</span> <span style=color:#e5c07b>nil</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>        <span style=color:#aa89ea>require</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>EqualError</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>t</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>err</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>tt</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>wantErr</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>        <span style=color:#76a9f9>return</span>
</span></span><span style=display:flex><span>      <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>      <span style=color:#aa89ea>require</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>NoError</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>t</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>err</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>      <span style=color:#aa89ea>assert</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Equal</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>t</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>want</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>got</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>    <span style=color:#abb2bf>})</span>
</span></span><span style=display:flex><span>  <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Good
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>func</span> <span style=color:#00b1f7>TestShouldCallX</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>t</span> <span style=color:#54b1c7>*</span><span style=color:#aa89ea>testing</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>T</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#8a93a5;font-style:italic>// setup mocks
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>  <span style=color:#aa89ea>ctrl</span> <span style=color:#54b1c7>:=</span> <span style=color:#aa89ea>gomock</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>NewController</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>t</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>xMock</span> <span style=color:#54b1c7>:=</span> <span style=color:#aa89ea>xmock</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>NewMockX</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>ctrl</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>xMock</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>EXPECT</span><span style=color:#abb2bf>().</span><span style=color:#00b1f7>Call</span><span style=color:#abb2bf>().</span><span style=color:#00b1f7>Return</span><span style=color:#abb2bf>(</span><span style=color:#98c379>&#34;XResponse&#34;</span><span style=color:#abb2bf>,</span> <span style=color:#e5c07b>nil</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>yMock</span> <span style=color:#54b1c7>:=</span> <span style=color:#aa89ea>ymock</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>NewMockY</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>ctrl</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>got</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>err</span> <span style=color:#54b1c7>:=</span> <span style=color:#00b1f7>DoComplexThing</span><span style=color:#abb2bf>(</span><span style=color:#98c379>&#34;inputX&#34;</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>xMock</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>yMock</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>require</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>NoError</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>t</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>err</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>assert</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Equal</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>t</span><span style=color:#abb2bf>,</span> <span style=color:#98c379>&#34;want&#34;</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>got</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>func</span> <span style=color:#00b1f7>TestShouldCallYAndFail</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>t</span> <span style=color:#54b1c7>*</span><span style=color:#aa89ea>testing</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>T</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#8a93a5;font-style:italic>// setup mocks
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>  <span style=color:#aa89ea>ctrl</span> <span style=color:#54b1c7>:=</span> <span style=color:#aa89ea>gomock</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>NewController</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>t</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>xMock</span> <span style=color:#54b1c7>:=</span> <span style=color:#aa89ea>xmock</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>NewMockX</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>ctrl</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>yMock</span> <span style=color:#54b1c7>:=</span> <span style=color:#aa89ea>ymock</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>NewMockY</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>ctrl</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>yMock</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>EXPECT</span><span style=color:#abb2bf>().</span><span style=color:#00b1f7>Call</span><span style=color:#abb2bf>().</span><span style=color:#00b1f7>Return</span><span style=color:#abb2bf>(</span><span style=color:#98c379>&#34;YResponse&#34;</span><span style=color:#abb2bf>,</span> <span style=color:#e5c07b>nil</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>_</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>err</span> <span style=color:#54b1c7>:=</span> <span style=color:#00b1f7>DoComplexThing</span><span style=color:#abb2bf>(</span><span style=color:#98c379>&#34;inputY&#34;</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>xMock</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>yMock</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>assert</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>EqualError</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>t</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>err</span><span style=color:#abb2bf>,</span> <span style=color:#98c379>&#34;Y failed&#34;</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span></code></pre></td></tr></table></div></div><p>This complexity makes it more difficult to change, understand, and prove the correctness of the test.</p><p>​ 这种复杂性使得更改、理解和证明测试的正确性变得更加困难。</p><p>While there are no strict guidelines, readability and maintainability should always be top-of-mind when deciding between Table Tests versus separate tests for multiple inputs/outputs to a system.</p><p>​ 虽然没有严格的准则，但在决定针对系统中的多个输入/输出使用表测试还是单独的测试时，可读性和可维护性应始终是首要考虑因素。</p><h4 id=parallel-tests-并行测试>Parallel Tests 并行测试</h4><p>Parallel tests, like some specialized loops (for example, those that spawn goroutines or capture references as part of the loop body), must take care to explicitly assign loop variables within the loop’s scope to ensure that they hold the expected values.</p><p>​ 并行测试（例如某些专门的循环，例如那些在循环体中生成 goroutine 或捕获引用的循环）必须注意在循环范围内显式分配循环变量，以确保它们具有预期值。</p><pre tabindex=0><code>tests := []struct{
  give string
  // ...
}{
  // ...
}

for _, tt := range tests {
  tt := tt // for t.Parallel
  t.Run(tt.give, func(t *testing.T) {
    t.Parallel()
    // ...
  })
}
</code></pre><p>In the example above, we must declare a <code>tt</code> variable scoped to the loop iteration because of the use of <code>t.Parallel()</code> below. If we do not do that, most or all tests will receive an unexpected value for <code>tt</code>, or a value that changes as they’re running.</p><p>​ 在上面的示例中，我们必须声明一个 <code>tt</code> 变量，其作用域为循环迭代，因为下面使用了 <code>t.Parallel()</code> 。如果不这样做，大多数或所有测试都会收到 <code>tt</code> 的意外值，或者在运行时会更改的值。</p><h3 id=functional-options-功能选项>Functional Options 功能选项</h3><p>Functional options is a pattern in which you declare an opaque <code>Option</code> type that records information in some internal struct. You accept a variadic number of these options and act upon the full information recorded by the options on the internal struct.</p><p>​ 功能选项是一种模式，您可以在其中声明一个不透明的 <code>Option</code> 类型，该类型在某些内部结构中记录信息。您可以接受这些选项的可变数量，并根据内部结构上选项记录的完整信息采取行动。</p><p>Use this pattern for optional arguments in constructors and other public APIs that you foresee needing to expand, especially if you already have three or more arguments on those functions.</p><p>​ 在您预见到需要扩展的构造函数和其他公共 API 中使用此模式来获取可选参数，尤其是当这些函数上已经存在三个或更多参数时。</p><div class=highlight><div style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">10
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Bad
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// package db
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>func</span> <span style=color:#00b1f7>Open</span><span style=color:#abb2bf>(</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>addr</span> <span style=color:#e5c07b>string</span><span style=color:#abb2bf>,</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>cache</span> <span style=color:#e5c07b>bool</span><span style=color:#abb2bf>,</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>logger</span> <span style=color:#54b1c7>*</span><span style=color:#aa89ea>zap</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>Logger</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>(</span><span style=color:#54b1c7>*</span><span style=color:#aa89ea>Connection</span><span style=color:#abb2bf>,</span> <span style=color:#e5c07b>error</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#8a93a5;font-style:italic>// ...
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#abb2bf>}</span>
</span></span></code></pre></td></tr></table></div></div><p>The cache and logger parameters must always be provided, even if the user wants to use the default.</p><p>​ 即使用户想要使用默认值，也必须始终提供缓存和记录器参数。</p><div class=highlight><div style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">26
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#aa89ea>db</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Open</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>addr</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>db</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>DefaultCache</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>zap</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>NewNop</span><span style=color:#abb2bf>())</span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>db</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Open</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>addr</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>db</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>DefaultCache</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>log</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>db</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Open</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>addr</span><span style=color:#abb2bf>,</span> <span style=color:#e5c07b>false</span> <span style=color:#8a93a5;font-style:italic>/* cache */</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>zap</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>NewNop</span><span style=color:#abb2bf>())</span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>db</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Open</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>addr</span><span style=color:#abb2bf>,</span> <span style=color:#e5c07b>false</span> <span style=color:#8a93a5;font-style:italic>/* cache */</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>log</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Good
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// package db
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>type</span> <span style=color:#aa89ea>Option</span> <span style=color:#76a9f9>interface</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#8a93a5;font-style:italic>// ...
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>func</span> <span style=color:#00b1f7>WithCache</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>c</span> <span style=color:#e5c07b>bool</span><span style=color:#abb2bf>)</span> <span style=color:#aa89ea>Option</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#8a93a5;font-style:italic>// ...
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>func</span> <span style=color:#00b1f7>WithLogger</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>log</span> <span style=color:#54b1c7>*</span><span style=color:#aa89ea>zap</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>Logger</span><span style=color:#abb2bf>)</span> <span style=color:#aa89ea>Option</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#8a93a5;font-style:italic>// ...
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Open creates a connection.
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>func</span> <span style=color:#00b1f7>Open</span><span style=color:#abb2bf>(</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>addr</span> <span style=color:#e5c07b>string</span><span style=color:#abb2bf>,</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>opts</span> <span style=color:#54b1c7>...</span><span style=color:#aa89ea>Option</span><span style=color:#abb2bf>,</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>(</span><span style=color:#54b1c7>*</span><span style=color:#aa89ea>Connection</span><span style=color:#abb2bf>,</span> <span style=color:#e5c07b>error</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#8a93a5;font-style:italic>// ...
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#abb2bf>}</span>
</span></span></code></pre></td></tr></table></div></div><p>Options are provided only if needed.</p><p>​ 仅在需要时才提供选项。</p><div class=highlight><div style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#aa89ea>db</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Open</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>addr</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>db</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Open</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>addr</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>db</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>WithLogger</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>log</span><span style=color:#abb2bf>))</span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>db</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Open</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>addr</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>db</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>WithCache</span><span style=color:#abb2bf>(</span><span style=color:#e5c07b>false</span><span style=color:#abb2bf>))</span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>db</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>Open</span><span style=color:#abb2bf>(</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>addr</span><span style=color:#abb2bf>,</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>db</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>WithCache</span><span style=color:#abb2bf>(</span><span style=color:#e5c07b>false</span><span style=color:#abb2bf>),</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>db</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>WithLogger</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>log</span><span style=color:#abb2bf>),</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>)</span>
</span></span></code></pre></td></tr></table></div></div><p>Our suggested way of implementing this pattern is with an <code>Option</code> interface that holds an unexported method, recording options on an unexported <code>options</code> struct.</p><p>​ 我们建议使用包含未导出方法的 <code>Option</code> 接口来实现此模式，该方法在未导出的 <code>options</code> 结构上记录选项。</p><div class=highlight><div style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">47
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#76a9f9>type</span> <span style=color:#aa89ea>options</span> <span style=color:#76a9f9>struct</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>cache</span>  <span style=color:#e5c07b>bool</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>logger</span> <span style=color:#54b1c7>*</span><span style=color:#aa89ea>zap</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>Logger</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>type</span> <span style=color:#aa89ea>Option</span> <span style=color:#76a9f9>interface</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#00b1f7>apply</span><span style=color:#abb2bf>(</span><span style=color:#54b1c7>*</span><span style=color:#aa89ea>options</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>type</span> <span style=color:#aa89ea>cacheOption</span> <span style=color:#e5c07b>bool</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>func</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>c</span> <span style=color:#aa89ea>cacheOption</span><span style=color:#abb2bf>)</span> <span style=color:#00b1f7>apply</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>opts</span> <span style=color:#54b1c7>*</span><span style=color:#aa89ea>options</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>opts</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>cache</span> <span style=color:#abb2bf>=</span> <span style=color:#e5c07b>bool</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>c</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>func</span> <span style=color:#00b1f7>WithCache</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>c</span> <span style=color:#e5c07b>bool</span><span style=color:#abb2bf>)</span> <span style=color:#aa89ea>Option</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>return</span> <span style=color:#00b1f7>cacheOption</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>c</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>type</span> <span style=color:#aa89ea>loggerOption</span> <span style=color:#76a9f9>struct</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>Log</span> <span style=color:#54b1c7>*</span><span style=color:#aa89ea>zap</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>Logger</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>func</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>l</span> <span style=color:#aa89ea>loggerOption</span><span style=color:#abb2bf>)</span> <span style=color:#00b1f7>apply</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>opts</span> <span style=color:#54b1c7>*</span><span style=color:#aa89ea>options</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>opts</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>logger</span> <span style=color:#abb2bf>=</span> <span style=color:#aa89ea>l</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>Log</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>func</span> <span style=color:#00b1f7>WithLogger</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>log</span> <span style=color:#54b1c7>*</span><span style=color:#aa89ea>zap</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>Logger</span><span style=color:#abb2bf>)</span> <span style=color:#aa89ea>Option</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>return</span> <span style=color:#aa89ea>loggerOption</span><span style=color:#abb2bf>{</span><span style=color:#aa89ea>Log</span><span style=color:#abb2bf>:</span> <span style=color:#aa89ea>log</span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Open creates a connection.
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#76a9f9>func</span> <span style=color:#00b1f7>Open</span><span style=color:#abb2bf>(</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>addr</span> <span style=color:#e5c07b>string</span><span style=color:#abb2bf>,</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>opts</span> <span style=color:#54b1c7>...</span><span style=color:#aa89ea>Option</span><span style=color:#abb2bf>,</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>(</span><span style=color:#54b1c7>*</span><span style=color:#aa89ea>Connection</span><span style=color:#abb2bf>,</span> <span style=color:#e5c07b>error</span><span style=color:#abb2bf>)</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>  <span style=color:#aa89ea>options</span> <span style=color:#54b1c7>:=</span> <span style=color:#aa89ea>options</span><span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>cache</span><span style=color:#abb2bf>:</span>  <span style=color:#aa89ea>defaultCache</span><span style=color:#abb2bf>,</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>logger</span><span style=color:#abb2bf>:</span> <span style=color:#aa89ea>zap</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>NewNop</span><span style=color:#abb2bf>(),</span>
</span></span><span style=display:flex><span>  <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#76a9f9>for</span> <span style=color:#aa89ea>_</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>o</span> <span style=color:#54b1c7>:=</span> <span style=color:#76a9f9>range</span> <span style=color:#aa89ea>opts</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>o</span><span style=color:#abb2bf>.</span><span style=color:#00b1f7>apply</span><span style=color:#abb2bf>(</span><span style=color:#54b1c7>&amp;</span><span style=color:#aa89ea>options</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>  <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8a93a5;font-style:italic>// ...
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#abb2bf>}</span>
</span></span></code></pre></td></tr></table></div></div><p>Note that there’s a method of implementing this pattern with closures but we believe that the pattern above provides more flexibility for authors and is easier to debug and test for users. In particular, it allows options to be compared against each other in tests and mocks, versus closures where this is impossible. Further, it lets options implement other interfaces, including <code>fmt.Stringer</code> which allows for user-readable string representations of the options.</p><p>​ 请注意，有一种使用闭包实现此模式的方法，但我们认为上述模式为作者提供了更大的灵活性，并且用户更容易调试和测试。特别是，它允许在测试和模拟中相互比较选项，而闭包则无法做到这一点。此外，它允许选项实现其他接口，包括 <code>fmt.Stringer</code> ，这允许用户可读的字符串表示选项。</p><p>See also,</p><p>​ 另请参阅，</p><ul><li><a href=https://commandcenter.blogspot.com/2014/01/self-referential-functions-and-design.html>Self-referential functions and the design of options
自引用函数和选项设计</a></li><li><a href=https://dave.cheney.net/2014/10/17/functional-options-for-friendly-apis>Functional options for friendly APIs
友好 API 的函数选项</a></li></ul><h2 id=linting>Linting</h2><p>More importantly than any “blessed” set of linters, lint consistently across a codebase.</p><p>​ 比任何“推荐”的 linter 集合更重要的是，在整个代码库中一致地进行 lint。</p><p>We recommend using the following linters at a minimum, because we feel that they help to catch the most common issues and also establish a high bar for code quality without being unnecessarily prescriptive:</p><p>​ 我们建议至少使用以下 linter，因为我们认为它们有助于发现最常见的问题，并且在不必要地规定性情况下为代码质量设定了很高的标准：</p><ul><li><a href=https://github.com/kisielk/errcheck>errcheck</a> to ensure that errors are handled
errcheck 确保处理错误</li><li><a href=https://godoc.org/golang.org/x/tools/cmd/goimports>goimports</a> to format code and manage imports
goimports 格式化代码并管理导入</li><li><a href=https://github.com/golang/lint>golint</a> to point out common style mistakes
golint 指出常见的样式错误</li><li><a href=https://golang.org/cmd/vet/>govet</a> to analyze code for common mistakes
govet 分析代码以查找常见错误</li><li><a href=https://staticcheck.io/>staticcheck</a> to do various static analysis checks
staticcheck 执行各种静态分析检查</li></ul><h3 id=lint-runners-lint-运行程序>Lint Runners Lint 运行程序</h3><p>We recommend <a href=https://github.com/golangci/golangci-lint>golangci-lint</a> as the go-to lint runner for Go code, largely due to its performance in larger codebases and ability to configure and use many canonical linters at once. This repo has an example <a href=https://github.com/uber-go/guide/blob/master/.golangci.yml>.golangci.yml</a> config file with recommended linters and settings.</p><p>​ 我们推荐 golangci-lint 作为 Go 代码的首选 lint 运行程序，这在很大程度上是因为它在较大的代码库中的性能以及一次配置和使用许多规范化 linter 的能力。此存储库有一个示例 .golangci.yml 配置文件，其中包含推荐的 linter 和设置。</p><p>golangci-lint has <a href=https://golangci-lint.run/usage/linters/>various linters</a> available for use. The above linters are recommended as a base set, and we encourage teams to add any additional linters that make sense for their projects.</p><p>​ golangci-lint 有各种可供使用的 linter。上述 linter 建议作为基本集，我们鼓励团队添加任何对他们的项目有意义的其他 linter。</p><div class=section-index></div><div class=td-page-meta__lastmod>最后修改 October 10, 2024: <a href=https://github.com/before80/go_docs/commit/a4b8f854f736d720ad19943e1274acc7bb0e3264>更新 (a4b8f854)</a></div></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="td-footer__left col-6 col-sm-4 order-sm-1"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title="User mailing list" aria-label="User mailing list"><a target=_blank rel=noopener href=https://example.org/mail aria-label="User mailing list"><i class="fa fa-envelope"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=Twitter aria-label=Twitter><a target=_blank rel=noopener href=https://example.org/twitter aria-label=Twitter><i class="fab fa-twitter"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="Stack Overflow" aria-label="Stack Overflow"><a target=_blank rel=noopener href=https://example.org/stack aria-label="Stack Overflow"><i class="fab fa-stack-overflow"></i></a></li></ul></div><div class="td-footer__right col-6 col-sm-4 order-sm-3"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=GitHub aria-label=GitHub><a target=_blank rel=noopener href=https://github.com/before80/go_docs aria-label=GitHub><i class="fab fa-github"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=Slack aria-label=Slack><a target=_blank rel=noopener href=https://example.org/slack aria-label=Slack><i class="fab fa-slack"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="Developer mailing list" aria-label="Developer mailing list"><a target=_blank rel=noopener href=https://example.org/mail aria-label="Developer mailing list"><i class="fa fa-envelope"></i></a></li></ul></div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2"><span class=td-footer__copyright>&copy;
2025
<span class=td-footer__authors>作者zlongx</span></span><span class=td-footer__all_rights_reserved>保留所有权利</span><span class=ms-2><a href=https://policies.google.com/privacy target=_blank rel=noopener>隐私政策</a></span><p class="td-footer__about mt-2"><a href=/go_docs/thirdPkg/lua/about/>关于</a></p></div></div></div></footer></div><style>.markmap>svg{width:100%;height:300px}</style><script>window.markmap={autoLoader:{manual:!0,onReady(){const{autoLoader:e,builtInPlugins:t}=window.markmap;e.transformPlugins=t.filter(e=>e.name!=="prism")}}}</script><script src=https://cdn.jsdelivr.net/npm/markmap-autoloader></script>
<script src=/go_docs/js/main.min.4fb55790d81bdab4cd314586e186d385cad5508994c45abe27c6daee34d84160.js integrity="sha256-T7VXkNgb2rTNMUWG4YbThcrVUImUxFq+J8ba7jTYQWA=" crossorigin=anonymous></script>
<script defer src=/go_docs/js/click-to-copy.min.14c7dd84004258325d147b971421f1d4dfd3f28500954f32ef71d1cfd0938f51.js integrity="sha256-FMfdhABCWDJdFHuXFCHx1N/T8oUAlU8y73HRz9CTj1E=" crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/@docsearch/js@3.6.0 integrity="sha512-FtDaTWf3IS29TLuYzTPlytjGqcXkwrzG9ivq7xXElnOZeiYTbcIy/hwXAgrrRNnI0+PfN+WFz4/+4phhJmuS8Q==" crossorigin=anonymous></script>
<script type=text/javascript>const containers=["#docsearch-0","#docsearch-1"];for(let e of containers)docsearch({container:e,appId:"DV76UK9EIH",apiKey:"227dec0ac6cbc8dfad748f27b2974507",indexName:"go-"})</script><script src=/go_docs/js/tabpane-persist.js></script>
<script src=/go_docs/js/tocbot.min.js></script>
<script src=/go_docs/js/markmap-autoloader.js></script>
<script type=text/javascript>window.addEventListener("load",function(){tocbot.init({tocSelector:".td-toc",contentSelector:".td-content",headingSelector:"h2, h3, h4, h5, h6",ignoreHiddenElements:!0,collapseDepth:6});let t=0,e=0,n=document.getElementById("show-timer"),s=document.getElementById("advice-reading-time"),o=s.textContent.trim();function i(){e++,e>=60&&(e=0,t++);let i=e<10?"0"+e:e;s!==null?n.textContent=t+":"+i+" <- "+o:n.textContent=t+":"+i}setInterval(i,1e3)})</script><script src=/go_docs/js/jquery-3.6.3.min.js></script>
<script src=/go_docs/js/deal-zero-width-space.js></script>
<script src=/go_docs/js/tabpane-persist.js></script></body></html>