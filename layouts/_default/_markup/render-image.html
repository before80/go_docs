<!-- layouts/partials/render-image.html -->
<!-- get image URL from Markdown tag -->
{{- $src := (.Destination | safeURL) -}}
{{ $src = replace $src "./" "" }}
{{- $src = index ($fragments) 0 -}}
<!-- get actual filename -->
{{/*- $src = path.Base $src -*/}}
<!-- check if it exists as a page resource -->
{{- with (.Page.Resources.ByType "image").GetMatch (printf "**%s" $src) -}}
{{- if strings.HasSuffix $src ".svg" -}}
    {{ .Content | safeHTML }}
{{- else -}}
    {{ with $.Title }}<figure>{{ end }}
    <img src="{{ $src.RelPermalink }}"
         width="{{ $src.Width }}"
         height="{{ $src.Height }}"
         alt="{{ $.Text }}" {{ with $.Title }} title="{{ . }}" {{ end }}
         loading="lazy" decoding="async" >
    {{ with $.Title }}<figcaption>{{ . | markdownify }}</figcaption></figure>{{ end }}
{{- end -}}
<!-- or otherwise simply load the URL -->
{{- else -}}
    <img src="{{ .Destination | safeURL }}"
         alt="{{ .Text }}" {{ with .Title }} title="{{ . }}" {{ end }}
         {{ with index ($fragments ) 1 }}class="{{ . }}" {{ end }}
         loading="lazy" decoding="async" data-src="external" >
{{- end -}}